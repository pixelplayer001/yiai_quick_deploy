'use strict';const _0x3712b1=_0x12d9;(function(_0x1d2018,_0x13e9fb){const _0x467b3e=_0x12d9,_0x55b0a1=_0x1d2018();while(!![]){try{const _0x39dcc0=parseInt(_0x467b3e(0x167))/0x1+parseInt(_0x467b3e(0xc4))/0x2+parseInt(_0x467b3e(0x12a))/0x3*(-parseInt(_0x467b3e(0x149))/0x4)+-parseInt(_0x467b3e(0xed))/0x5+-parseInt(_0x467b3e(0xf3))/0x6+parseInt(_0x467b3e(0xd1))/0x7*(parseInt(_0x467b3e(0x131))/0x8)+parseInt(_0x467b3e(0x169))/0x9;if(_0x39dcc0===_0x13e9fb)break;else _0x55b0a1['push'](_0x55b0a1['shift']());}catch(_0x2125a0){_0x55b0a1['push'](_0x55b0a1['shift']());}}}(_0x8c55,0xb800d));const _0x468ac4=_0x2cc0;function _0x8c55(){const _0x5d1d52=['1079520LnPELa','放大单张图片请求失败...','enlargeWorking','imagine','1263936QDADZf','function','../globalConfig/globalConfig.service','mjProxy','variationId','549iblSKW','createQueryBuilder','绘画请求失败、当前使用人数过多、请稍后试试吧、排队中...','mjChannelId','有历史信息之间返回:\x20','findCurrentEnlargeImgResult','IsNull','defineProperty','35wdqJFd','3693980rlGOEp','sendDrawInteractions','__param','2IpmTfB','../chatLog/chatLog.entity','now','/messages?limit=50','../userBalance/balance.entity','本次绘图耗时:\x20','开始请求变换图片\x20队列+1:\x20','orderId','秒请求一次、请合理使用！','pollForResult','createRandomUid','checkAuth','default','user','fanyiService','绘图指令完成','findCurrentVariationImgResult','error:\x20','放大custom_id:\x20','substring','绘制图片任务异常中断\x20队列-1:\x20','balanceEntity','9798FLSdrU','../fanyi/fanyi.service','3152930zKXsvg','当前图片没有绘画信息、无法变体!','由于速率限制、当前普通用户限制为','开始请求放大图片\x20队列+1:\x20','getMjDefaultParams','当前图片已经放大过了、请勿重复放大!','8268804YWbCnm','queryMessageList','历史中存在当前图片、直接获取！','prompt','baiduFanyiAppId','upscaleSingleImg','max','FanyiService','变换当前图片失败','3404296abgQSC','log','stringify','21hqLUSJ','Injectable','deductBalance','chatLogEntity','Not','绘画超时，请稍后再试！','mjId','length','shift','mjNotSaveImg','http://172.247.48.137:8000/mj/draw','mjApplicationId','queueCount','mjAuthorization','get','match','179033QVdcEj','3sdIdYK','PAINT_TYPE','object','execute','sendSmInteractions','balance','__decorate','您当前暂无MJ绘画余额！！！','data','typeorm','mjDraw','axios','本次比对的随机ID:\x20','拿到了远程地址:\x20','pollForVariationResult','removeEmoji','MjService','randomId:\x20','@nestjs/common','绘画失败','BAD_REQUEST','getOwnPropertyDescriptor','\x20次开始查询[变换图片]','getConfigs','design:paramtypes','历史记录中不存在当前图片、请确认您需要变换的图片是否存在','15PdfPAn','@nestjs/typeorm','http://172.247.48.137:8000/mj/list?channel_id=','userId\x20=\x20:userId','BalanceEntity','当前提示词已经在任务队列中了、请勿重复提交。。。','freeQueueUsers','1275752xEhFvl','3962920wROKwQ','变化图片任务异常中断\x20队列-1:\x20','120490cgyWag','绘制图片任务结束\x20队列-1:\x20','draw','filter','BadwordsService','findCurrentPromptResult','variationSingleImg','发送绘画指令结果:\x20','../upload/upload.service','使用的次数：','InjectRepository','mjRateLimit','uploadService','baiduFanyiSecret','uploadFileFromUrl','axios:\x20','metadata','badwordsService','2705FFmbxf','开始请求用户','globalConfigService','58544kWaBZc','852180mljKSt','parse','admin','当前绘图任务满载、请排队等候、队列任务完成后即可开始您的任务...','find','ChatLogService','prompt\x20-------->\x20\x20','push','\x20次开始查询\x20=>\x20当前查询结果：','axios\x20get:\x20','HttpException','UploadService','Repository','\x20队列+1:\x20','339596QxDseY','../chatLog/chatLog.service','mjVersion','components','findOne','发送放大指令成功','INTERNAL_SERVER_ERROR','放大图片任务异常中断\x20队列-1:\x20','当前用户\x20','放大当前图片失败','drawWorking','chatLogService','本次放大图片的id:\x20','balance\x20-\x201','5300953zOyOXs','1294169ruCibB','../../common/constants/balance.constant','1008855arzDpG','33556275PyCpLj','https://discord.com/api/v9/interactions','查询绘制结果失败...','map','Like','ChatLogEntity','rateLimits','__esModule','message','变换图片任务结束\x20队列-1:\x20','where','super'];_0x8c55=function(){return _0x5d1d52;};return _0x8c55();}(function(_0x12cbdd,_0x3489b1){const _0x4797f5=_0x12d9,_0x3c3ec7=_0x2cc0,_0x4b86a6=_0x12cbdd();while(!![]){try{const _0x21b453=-parseInt(_0x3c3ec7(0x1ca))/0x1+parseInt(_0x3c3ec7(0x1ae))/0x2*(-parseInt(_0x3c3ec7(0x1b6))/0x3)+parseInt(_0x3c3ec7(0x1b0))/0x4+parseInt(_0x3c3ec7(0x159))/0x5+-parseInt(_0x3c3ec7(0x1d3))/0x6*(-parseInt(_0x3c3ec7(0x160))/0x7)+parseInt(_0x3c3ec7(0x161))/0x8+-parseInt(_0x3c3ec7(0x13c))/0x9*(parseInt(_0x3c3ec7(0x158))/0xa);if(_0x21b453===_0x3489b1)break;else _0x4b86a6[_0x4797f5(0x151)](_0x4b86a6[_0x4797f5(0x107)]());}catch(_0x1409cd){_0x4b86a6[_0x4797f5(0x151)](_0x4b86a6['shift']());}}}(_0x5586,0x74a97));const _0x2ce8cf=_0x3de2;function _0x3de2(_0x24be23,_0x44bc79){const _0x4be57b=_0x4d5c();return _0x3de2=function(_0xeea556,_0xc0d742){_0xeea556=_0xeea556-0x1ce;let _0x1a31aa=_0x4be57b[_0xeea556];return _0x1a31aa;},_0x3de2(_0x24be23,_0x44bc79);}(function(_0x2fc518,_0x37afc6){const _0x249c5a=_0x2cc0,_0x1a20f1=_0x3de2,_0x38d44d=_0x2fc518();while(!![]){try{const _0x174f55=-parseInt(_0x1a20f1(0x1f3))/0x1+-parseInt(_0x1a20f1(0x27c))/0x2+parseInt(_0x1a20f1(0x22c))/0x3*(-parseInt(_0x1a20f1(0x22f))/0x4)+parseInt(_0x1a20f1(0x1e3))/0x5*(-parseInt(_0x1a20f1(0x1d0))/0x6)+-parseInt(_0x1a20f1(0x22d))/0x7+-parseInt(_0x1a20f1(0x226))/0x8+parseInt(_0x1a20f1(0x236))/0x9;if(_0x174f55===_0x37afc6)break;else _0x38d44d[_0x249c5a(0x14a)](_0x38d44d[_0x249c5a(0x12c)]());}catch(_0x3bd99c){_0x38d44d[_0x249c5a(0x14a)](_0x38d44d[_0x249c5a(0x12c)]());}}}(_0x4d5c,0x6cc44));function _0x4d5c(){const _0x1ab6ac=_0x12d9,_0x5374c9=_0x2cc0,_0x36c73d=[_0x5374c9(0x154),_0x1ab6ac(0xea),_0x1ab6ac(0xd8),_0x1ab6ac(0xf8),_0x1ab6ac(0x164),_0x1ab6ac(0xeb),'当前绘图任务满载、请排队等候、队列任务完成后即可开始您的任务...',_0x5374c9(0x1b4),_0x5374c9(0x190),_0x5374c9(0x19b),'开始轮询单张变换图片结果',_0x5374c9(0x171),_0x5374c9(0x1d1),_0x5374c9(0x139),_0x5374c9(0x15c),_0x5374c9(0x1a6),_0x5374c9(0x129),_0x5374c9(0x18c),_0x5374c9(0x148),_0x5374c9(0x1b1),_0x5374c9(0x198),_0x5374c9(0x191),_0x5374c9(0x14f),_0x5374c9(0x197),_0x1ab6ac(0x146),_0x5374c9(0x140),_0x5374c9(0x131),'url',_0x5374c9(0x144),_0x5374c9(0x1a7),_0x5374c9(0x12f),_0x5374c9(0x15d),_0x5374c9(0x17e),_0x1ab6ac(0x160),_0x5374c9(0x163),_0x5374c9(0x1d5),_0x1ab6ac(0x112),_0x5374c9(0x13b),_0x1ab6ac(0x133),_0x5374c9(0x1a2),_0x1ab6ac(0x10f),_0x1ab6ac(0x10a),_0x1ab6ac(0x156),'当前图片没有绘画信息、无法放大!',_0x5374c9(0x180),_0x1ab6ac(0xda),_0x1ab6ac(0x15b),_0x5374c9(0x18b),_0x5374c9(0x149),_0x5374c9(0x179),_0x5374c9(0x194),_0x5374c9(0x156),_0x1ab6ac(0x10c),_0x5374c9(0x16c),_0x5374c9(0x182),_0x5374c9(0x1b5),_0x5374c9(0x152),_0x5374c9(0x16a),_0x1ab6ac(0xd6),_0x1ab6ac(0x136),_0x5374c9(0x16e),_0x5374c9(0x1b8),_0x5374c9(0x133),_0x5374c9(0x1a9),_0x5374c9(0x130),_0x5374c9(0x15a),_0x5374c9(0x19a),_0x1ab6ac(0x104),_0x5374c9(0x135),_0x1ab6ac(0x13c),_0x5374c9(0x18a),'HttpStatus',_0x5374c9(0x196),_0x1ab6ac(0xec),_0x5374c9(0x165),_0x5374c9(0x1af),_0x1ab6ac(0xcf),_0x5374c9(0x1c1),_0x5374c9(0x1a4),_0x5374c9(0x16b),_0x1ab6ac(0x15d),_0x5374c9(0x142),_0x5374c9(0x138),_0x5374c9(0x1aa),_0x5374c9(0x183),_0x5374c9(0x13f),_0x5374c9(0x146),_0x5374c9(0x1a1),_0x5374c9(0x1cd),_0x5374c9(0x189),_0x5374c9(0x1d8),_0x5374c9(0x1cb),_0x5374c9(0x12b),_0x5374c9(0x1d6),_0x5374c9(0x12e),_0x5374c9(0x137),_0x5374c9(0x1d4),_0x1ab6ac(0x110),_0x5374c9(0x167),_0x5374c9(0x1d2),_0x5374c9(0x1ac),_0x5374c9(0x150),_0x5374c9(0x1ab),'decorate',_0x5374c9(0x1cf),_0x5374c9(0x1b9),_0x5374c9(0x141),_0x5374c9(0x136),_0x5374c9(0x153),_0x1ab6ac(0xf0),_0x5374c9(0x12d),_0x5374c9(0x177),_0x5374c9(0x13a),_0x5374c9(0x13e),_0x5374c9(0x1c6),_0x5374c9(0x1b7),_0x5374c9(0x1ce),'__metadata',_0x5374c9(0x15f),_0x5374c9(0x14c),_0x5374c9(0x1c2),_0x5374c9(0x1b2),_0x5374c9(0x143),_0x5374c9(0x16f),_0x5374c9(0x1cc),_0x5374c9(0x17b),_0x1ab6ac(0x15e),_0x1ab6ac(0xde),_0x5374c9(0x1d0),_0x1ab6ac(0x13d),_0x5374c9(0x1a5),_0x1ab6ac(0x163),_0x5374c9(0x145),_0x5374c9(0x18d),_0x5374c9(0x174),'convertToEnglish',_0x5374c9(0x169),_0x5374c9(0x1da),_0x5374c9(0x178),_0x5374c9(0x187),_0x5374c9(0x1a3),_0x5374c9(0x173),_0x5374c9(0x1bd),_0x1ab6ac(0x148),_0x5374c9(0x127),_0x1ab6ac(0xc5),_0x1ab6ac(0x100),_0x5374c9(0x186),_0x5374c9(0x172),_0x5374c9(0x13d),_0x5374c9(0x14e),_0x5374c9(0x17f),_0x5374c9(0x14b),_0x5374c9(0x1bb),_0x5374c9(0x175),_0x5374c9(0x185),_0x5374c9(0x16d),_0x5374c9(0x17c),_0x5374c9(0x1d9),_0x1ab6ac(0x10e),_0x1ab6ac(0xc7),_0x5374c9(0x1a0),_0x5374c9(0x181),_0x1ab6ac(0x120),'mjGuildId',_0x5374c9(0x192),_0x1ab6ac(0xd3),_0x5374c9(0x18e),_0x5374c9(0x1ad),_0x1ab6ac(0xfa),_0x5374c9(0x1be),_0x5374c9(0x19e),_0x5374c9(0x170),_0x5374c9(0x17d),_0x5374c9(0x1c3),_0x5374c9(0x15e),_0x5374c9(0x134),_0x5374c9(0x151),_0x5374c9(0x1c9),_0x5374c9(0x188),_0x5374c9(0x1d7),_0x5374c9(0x19f),_0x5374c9(0x19d)];return _0x4d5c=function(){return _0x36c73d;},_0x4d5c();}var __decorate=this&&this[_0x2ce8cf(0x275)]||function(_0x472de7,_0x2e18ae,_0x2849a9,_0x233d5d){const _0x29d280=_0x2ce8cf;var _0x126ac9=arguments[_0x29d280(0x1d6)],_0x71d591=_0x126ac9<0x3?_0x2e18ae:_0x233d5d===null?_0x233d5d=Object[_0x29d280(0x272)](_0x2e18ae,_0x2849a9):_0x233d5d,_0x43860a;if(typeof Reflect===_0x29d280(0x1ef)&&typeof Reflect[_0x29d280(0x232)]===_0x29d280(0x25c))_0x71d591=Reflect[_0x29d280(0x232)](_0x472de7,_0x2e18ae,_0x2849a9,_0x233d5d);else{for(var _0x355e1c=_0x472de7[_0x29d280(0x1d6)]-0x1;_0x355e1c>=0x0;_0x355e1c--)if(_0x43860a=_0x472de7[_0x355e1c])_0x71d591=(_0x126ac9<0x3?_0x43860a(_0x71d591):_0x126ac9>0x3?_0x43860a(_0x2e18ae,_0x2849a9,_0x71d591):_0x43860a(_0x2e18ae,_0x2849a9))||_0x71d591;}return _0x126ac9>0x3&&_0x71d591&&Object[_0x29d280(0x241)](_0x2e18ae,_0x2849a9,_0x71d591),_0x71d591;},__metadata=this&&this[_0x2ce8cf(0x240)]||function(_0x46c562,_0x14d7eb){const _0x262bd2=_0x2cc0,_0x5e10e1=_0x2ce8cf;if(typeof Reflect===_0x262bd2(0x12a)&&typeof Reflect[_0x5e10e1(0x204)]===_0x5e10e1(0x25c))return Reflect[_0x5e10e1(0x204)](_0x46c562,_0x14d7eb);},__param=this&&this[_0x2ce8cf(0x1f2)]||function(_0x1a4037,_0x208e11){return function(_0x465911,_0x132695){_0x208e11(_0x465911,_0x132695,_0x1a4037);};};function _0x5586(){const _0x5bfb56=_0x12d9,_0x1f5ae8=['saveChatLog',_0x5bfb56(0x153),_0x5bfb56(0x10d),_0x5bfb56(0xdb),'变换当前图片超时！',_0x5bfb56(0x14a),'存入图片完成:\x20',_0x5bfb56(0x121),_0x5bfb56(0xc3),_0x5bfb56(0xde),_0x5bfb56(0xe1),_0x5bfb56(0xc6),_0x5bfb56(0x134),_0x5bfb56(0xc0),_0x5bfb56(0x14f),_0x5bfb56(0xef),'post',_0x5bfb56(0x154),_0x5bfb56(0x16b),_0x5bfb56(0xd0),_0x5bfb56(0xff),_0x5bfb56(0xfc),'floor',_0x5bfb56(0x127),'网络连接失败，请稍后再试！',_0x5bfb56(0x141),_0x5bfb56(0x122),_0x5bfb56(0x166),_0x5bfb56(0x16c),'data',_0x5bfb56(0x144),_0x5bfb56(0xf6),'checkBadWords',_0x5bfb56(0x109),'checkFree',_0x5bfb56(0x152),_0x5bfb56(0x11c),_0x5bfb56(0x106),_0x5bfb56(0x147),_0x5bfb56(0x15c),_0x5bfb56(0xcd),_0x5bfb56(0x157),_0x5bfb56(0x161),_0x5bfb56(0xc1),_0x5bfb56(0x145),_0x5bfb56(0xd9),_0x5bfb56(0x171),_0x5bfb56(0x10b),_0x5bfb56(0xfe),_0x5bfb56(0x11f),_0x5bfb56(0xe8),_0x5bfb56(0x129),_0x5bfb56(0xf1),_0x5bfb56(0x123),'\x20请求过于频繁！',_0x5bfb56(0x117),_0x5bfb56(0xc2),_0x5bfb56(0xe3),_0x5bfb56(0x16f),'sleep',_0x5bfb56(0xe2),'getClientIp',_0x5bfb56(0xcc),_0x5bfb56(0x12d),_0x5bfb56(0x108),_0x5bfb56(0xf9),_0x5bfb56(0x125),_0x5bfb56(0xfb),_0x5bfb56(0xce),_0x5bfb56(0x126),_0x5bfb56(0x101),_0x5bfb56(0xf2),_0x5bfb56(0x14c),_0x5bfb56(0x11b),_0x5bfb56(0x13b),_0x5bfb56(0x11e),'enlarge','update',_0x5bfb56(0x168),'GlobalConfigService',_0x5bfb56(0xe4),'error',_0x5bfb56(0xcb),_0x5bfb56(0x139),_0x5bfb56(0x143),_0x5bfb56(0x13a),_0x5bfb56(0xd4),_0x5bfb56(0x12b),_0x5bfb56(0xdd),_0x5bfb56(0x170),'message_id',_0x5bfb56(0x11a),_0x5bfb56(0x173),_0x5bfb56(0x12f),_0x5bfb56(0x12e),_0x5bfb56(0xca),'2166988olPFxH',_0x5bfb56(0xf4),_0x5bfb56(0xd5),'pollForUpscaleResult',_0x5bfb56(0xd2),'find','\x20次开始查询','set',_0x5bfb56(0x15f),_0x5bfb56(0xe0),'1028961gwnkTd',_0x5bfb56(0xee),_0x5bfb56(0x138),_0x5bfb56(0xdc),_0x5bfb56(0x10a),_0x5bfb56(0x140),'HttpStatus','mjSessionId',_0x5bfb56(0x116),_0x5bfb56(0x174),_0x5bfb56(0xc8),_0x5bfb56(0x105),_0x5bfb56(0xf5),_0x5bfb56(0x172),_0x5bfb56(0xf7),'test',_0x5bfb56(0x114),_0x5bfb56(0x14b),_0x5bfb56(0x135),_0x5bfb56(0x165),_0x5bfb56(0x158),_0x5bfb56(0x132),_0x5bfb56(0x119),_0x5bfb56(0x16d),'https://discord.com/api/v9/channels/',_0x5bfb56(0x103),_0x5bfb56(0x113),_0x5bfb56(0x13f),'历史记录中不存在当前图片、请确认您放大的图片是否存在','660966OCwRpi','extractContent',_0x5bfb56(0x115),_0x5bfb56(0x102),'放大图片任务结束\x20队列-1:\x20',_0x5bfb56(0x150),_0x5bfb56(0x130),'includes','开始查询绘画结果轮询','mjGuildId',_0x5bfb56(0xe7),_0x5bfb56(0x112),_0x5bfb56(0x11d),_0x5bfb56(0x107),'查询期间出现错误：',_0x5bfb56(0x155),'DeductionKey','历史这些id已经被获取过了\x20不能拿了:\x20',_0x5bfb56(0x162),'mjservice','BAD_REQUEST',_0x5bfb56(0xd7),_0x5bfb56(0x159),_0x5bfb56(0x16a),'replace',_0x5bfb56(0x137),_0x5bfb56(0x142),'checkRateLimit',_0x5bfb56(0xdf),_0x5bfb56(0xc9),_0x5bfb56(0xfd),_0x5bfb56(0xe9),_0x5bfb56(0x13e),'../badwords/badwords.service',_0x5bfb56(0x128),'../../common/utils',_0x5bfb56(0x15a),'Like',_0x5bfb56(0x111),'response','绘画任务开始',_0x5bfb56(0x175),_0x5bfb56(0xe6),_0x5bfb56(0x151),_0x5bfb56(0xe5)];return _0x5586=function(){return _0x1f5ae8;},_0x5586();}Object[_0x468ac4(0x15f)](exports,_0x468ac4(0x17a),{'value':!![]}),exports[_0x2ce8cf(0x26e)]=void 0x0;const globalConfig_service_1=require(_0x468ac4(0x157)),upload_service_1=require(_0x2ce8cf(0x210)),common_1=require(_0x468ac4(0x166)),axios_1=require(_0x468ac4(0x195)),chatLog_service_1=require(_0x2ce8cf(0x20f)),balance_constant_1=require(_0x2ce8cf(0x20d)),utils_1=require(_0x2ce8cf(0x21c)),chatLog_entity_1=require(_0x2ce8cf(0x205)),typeorm_1=require(_0x2ce8cf(0x247)),typeorm_2=require(_0x2ce8cf(0x257)),balance_entity_1=require(_0x2ce8cf(0x1fc)),fanyi_service_1=require(_0x2ce8cf(0x214)),badwords_service_1=require(_0x2ce8cf(0x1e4));function _0x12d9(_0x3b5738,_0x1b4ac3){const _0x8c55d4=_0x8c55();return _0x12d9=function(_0x12d9d2,_0x39892d){_0x12d9d2=_0x12d9d2-0xc0;let _0x3f3b2c=_0x8c55d4[_0x12d9d2];return _0x3f3b2c;},_0x12d9(_0x3b5738,_0x1b4ac3);}let MjService=class MjService{constructor(_0x271548,_0x43f628,_0xa36d8e,_0x2389b7,_0xe86f67,_0x49729c,_0x17fe27){const _0x2a0d03=_0x468ac4,_0x4e7411=_0x2ce8cf;this[_0x4e7411(0x228)]=_0x271548,this[_0x4e7411(0x283)]=_0x43f628,this[_0x4e7411(0x264)]=_0xa36d8e,this[_0x4e7411(0x24e)]=_0x2389b7,this[_0x4e7411(0x25a)]=_0xe86f67,this[_0x4e7411(0x266)]=_0x49729c,this[_0x4e7411(0x255)]=_0x17fe27,this[_0x4e7411(0x24d)]={},this[_0x2a0d03(0x131)]=[],this[_0x2a0d03(0x184)]=[],this[_0x4e7411(0x248)]=0x0,this[_0x4e7411(0x269)]={};}async[_0x2ce8cf(0x1e8)](_0x58c78b){const _0x26dece=_0x468ac4,_0x3540a9=_0x2ce8cf,{jobId:_0xd8edd8,prompt:_0x1cbdd4,startTime:_0x3deb0b,userId:_0x490cab}=_0x58c78b;return console[_0x3540a9(0x260)](_0x26dece(0x147),_0x26dece(0x132)),await new Promise(_0x480847=>setTimeout(_0x480847,0x1388)),{'a':0x1,'b':0x2};}async[_0x2ce8cf(0x206)](_0x3300c7,_0x1cd592){const _0x19465d=_0x12d9,_0x47f860=_0x468ac4,_0x272190=_0x2ce8cf;await this[_0x272190(0x202)](_0x1cd592),await this[_0x272190(0x255)][_0x272190(0x200)](_0x3300c7[_0x272190(0x21a)],_0x1cd592[_0x272190(0x27e)]['id']);const _0x48c6cc=_0x3300c7[_0x47f860(0x16b)];let _0x229fb3=_0x3300c7[_0x272190(0x21a)];const {baiduFanyiAppId:_0x502206,baiduFanyiSecret:_0x20b1d8}=await this[_0x19465d(0x148)][_0x272190(0x1ed)]([_0x47f860(0x1c4),_0x272190(0x215)]);_0x502206&&_0x20b1d8&&(_0x229fb3=await this[_0x272190(0x266)][_0x272190(0x252)](_0x48c6cc));const _0x4a8370='['+(0x0,utils_1[_0x272190(0x1f0)])()+']',_0x12c454=_0x4a8370+'\x20'+_0x229fb3;console[_0x47f860(0x13d)](_0x272190(0x237),_0x4a8370),console[_0x272190(0x260)](_0x272190(0x225),_0x12c454);const _0x48461c=this[_0x272190(0x1e5)][_0x272190(0x1de)](_0x420cd8=>_0x420cd8[_0x272190(0x254)](_0x3300c7[_0x272190(0x21a)]));if(_0x48461c)throw new common_1[(_0x272190(0x1ea))](_0x272190(0x20a),common_1[_0x272190(0x212)][_0x272190(0x209)]);if(this[_0x272190(0x248)]>=0x3)throw new common_1[(_0x47f860(0x15d))](_0x272190(0x1d1),common_1[_0x272190(0x212)][_0x47f860(0x133)]);await this[_0x272190(0x23b)](_0x1cd592),this[_0x272190(0x248)]++,console[_0x272190(0x260)](_0x272190(0x25f)+_0x1cd592[_0x272190(0x27e)]['id']+_0x272190(0x265),this[_0x47f860(0x17b)]);try{const _0x3cc571=await this[_0x272190(0x228)][_0x272190(0x1de)]({'where':{'prompt':(0x0,typeorm_1[_0x272190(0x1e7)])('%'+_0x12c454+'%')}}),_0x57cf08=_0x3cc571[_0x272190(0x223)](_0x2b2ead=>_0x2b2ead[_0x47f860(0x1a6)]);this[_0x272190(0x1e5)][_0x47f860(0x14a)](_0x12c454);let _0x1a1bf4;const _0x57d0ad=await this[_0x272190(0x271)](_0x12c454,_0x57cf08,_0x4a8370);_0x57d0ad?(console[_0x272190(0x260)](_0x272190(0x243)),_0x1a1bf4=_0x57d0ad):_0x1a1bf4=await this[_0x47f860(0x155)](_0x12c454,_0x57cf08,_0x4a8370),(this[_0x272190(0x248)]--,this[_0x272190(0x248)]<0x0&&(this[_0x272190(0x248)]=0x0),console[_0x47f860(0x13d)](_0x47f860(0x1c8),this[_0x272190(0x248)]));const {id:_0x68bea6,content:_0x6bffa0,channel_id:_0x1b863c,attachments:attachments=[],timestamp:_0x2c711e}=_0x1a1bf4;if(!attachments[_0x272190(0x1d6)]||!attachments[0x0][_0x272190(0x1e6)])throw new common_1[(_0x272190(0x1ea))](_0x272190(0x26d),common_1[_0x272190(0x212)][_0x272190(0x209)]);const {filename:_0x26f590,url:_0x12785c,width:_0x5637d9,height:_0x2d5ad8,size:_0x1f794f}=attachments[0x0];console[_0x272190(0x260)](_0x272190(0x227),_0x12785c);const _0x41008e=this[_0x272190(0x25a)][_0x272190(0x1ed)]([_0x272190(0x1dc)]);let _0x51a759='';(!Number(_0x41008e)||Number(_0x41008e)===0x0)&&(_0x51a759=await this[_0x272190(0x264)][_0x272190(0x1d8)]({'filename':_0x26f590,'url':_0x12785c}),console[_0x47f860(0x13d)](_0x272190(0x203),_0x51a759));const _0x12ddce={'curIp':(0x0,utils_1[_0x272190(0x224)])(_0x1cd592),'userId':_0x1cd592[_0x47f860(0x188)]['id'],'type':balance_constant_1[_0x272190(0x1e9)][_0x47f860(0x145)],'prompt':_0x12c454,'answer':_0x51a759,'model':'mj','extend':this[_0x272190(0x278)](JSON[_0x272190(0x268)](_0x1a1bf4)),'message_id':_0x68bea6,'variationId':_0x68bea6,'upscaleId':_0x68bea6,'group':0x1,'isSaveImg':!Number(_0x41008e)||Number(_0x41008e)===0x0,'fileInfo':JSON[_0x47f860(0x17c)]({'width':_0x5637d9,'height':_0x2d5ad8,'size':_0x1f794f,'filename':_0x26f590,'cosUrl':_0x51a759})};return await this[_0x272190(0x24e)][_0x272190(0x242)](_0x12ddce),await this[_0x272190(0x270)](_0x1cd592),this[_0x272190(0x1e5)]=this[_0x47f860(0x131)][_0x272190(0x21d)](_0x47e930=>_0x47e930!==_0x3300c7[_0x272190(0x21a)]),_0x51a759;}catch(_0x2b9047){this[_0x272190(0x248)]--,this[_0x272190(0x248)]<0x0&&(this[_0x272190(0x248)]=0x0),console[_0x272190(0x260)](_0x272190(0x23c),this[_0x272190(0x248)]),this[_0x272190(0x1e5)]=this[_0x272190(0x1e5)][_0x272190(0x21d)](_0x5a92d7=>_0x5a92d7!==_0x3300c7[_0x272190(0x21a)]);throw new common_1[(_0x19465d(0x154))](_0x2b9047[_0x272190(0x221)],common_1[_0x47f860(0x1bc)][_0x272190(0x209)]);}}async[_0x2ce8cf(0x1ce)](_0x3bcd20,_0x419335){const _0xfed0bd=_0x12d9,_0x3a248c=_0x468ac4,_0x3dc21b=_0x2ce8cf;if(this[_0x3dc21b(0x248)]>=0x3)throw new common_1[(_0x3dc21b(0x1ea))](_0x3dc21b(0x1d1),common_1[_0x3dc21b(0x212)][_0x3dc21b(0x209)]);this[_0x3dc21b(0x248)]++,console[_0x3dc21b(0x260)]('用户'+_0x419335[_0x3dc21b(0x27e)]['id']+_0x3dc21b(0x238),this[_0x3dc21b(0x248)]);const {message_id:_0x22f754,orderId:_0x21d9d0}=_0x3bcd20;try{const _0x36867d=await this[_0x3dc21b(0x228)][_0x3dc21b(0x258)]({'where':{'message_id':_0x22f754}});if(!_0x36867d)throw new common_1[(_0x3dc21b(0x1ea))](_0x3dc21b(0x22e),common_1[_0x3dc21b(0x212)][_0x3dc21b(0x209)]);const _0x3af0d4=await this[_0x3a248c(0x1d6)][_0x3dc21b(0x258)]({'where':{'upscaleId':_0x22f754,'action':_0x3dc21b(0x1df),'orderId':_0x21d9d0}});if(_0x3af0d4)throw new common_1[(_0x3dc21b(0x1ea))](_0x3a248c(0x193),common_1[_0x3dc21b(0x212)][_0x3dc21b(0x209)]);const {prompt:_0x4dbef1,extend:_0x4e2e71}=_0x36867d;let _0x3d7b7a=null;try{_0x3d7b7a=JSON[_0x3a248c(0x1c7)](_0x4e2e71);}catch(_0x556b71){_0x3d7b7a=[];}const {components:components=[]}=_0x3d7b7a;if(!components[_0x3dc21b(0x1d6)])throw new common_1[(_0x3a248c(0x15d))](_0x3dc21b(0x1f6),common_1[_0x3dc21b(0x212)][_0x3dc21b(0x209)]);const _0x4045da=components[0x0][_0x3dc21b(0x1f9)][_0x21d9d0-0x1],{custom_id:_0x29a88a}=_0x4045da;console[_0x3a248c(0x13d)](_0x3dc21b(0x1db),_0x29a88a);const _0x5a3c9c={'message_id':_0x22f754,'custom_id':_0x29a88a,'prompt':_0x4dbef1,'orderId':_0x21d9d0};await this[_0xfed0bd(0x114)](_0x5a3c9c),console[_0x3dc21b(0x260)](_0x3dc21b(0x21b));const _0x498fba=await this[_0x3dc21b(0x228)][_0x3dc21b(0x1de)]({'where':{'prompt':(0x0,typeorm_1[_0xfed0bd(0x16e)])('%'+_0x4dbef1+'%')}}),_0x3adccf=_0x498fba[_0x3dc21b(0x223)](_0x59e572=>_0x59e572[_0x3dc21b(0x1da)]);console[_0x3dc21b(0x260)](_0x3dc21b(0x20b),_0x3adccf);const _0x3f2ddc=await this[_0x3a248c(0x1af)](_0x5a3c9c,_0x3adccf);this[_0x3dc21b(0x248)]--,this[_0x3dc21b(0x248)]<0x0&&(this[_0x3dc21b(0x248)]=0x0),console[_0x3dc21b(0x260)](_0x3dc21b(0x27f),this[_0x3dc21b(0x248)]);const {id:_0x3c2479,content:_0x14b1ef,channel_id:_0x40010,attachments:attachments=[],timestamp:_0x182275}=_0x3f2ddc;if(!attachments[_0x3dc21b(0x1d6)]||!attachments[0x0][_0x3dc21b(0x1e6)])throw new common_1[(_0x3dc21b(0x1ea))](_0x3a248c(0x176),common_1[_0x3dc21b(0x212)][_0x3dc21b(0x209)]);const {filename:_0x398321,url:_0x2abece,width:_0x1e65f1,height:_0x3ebb65,size:_0x3217ab}=attachments[0x0],_0x33f525=this[_0x3dc21b(0x25a)][_0x3a248c(0x163)]([_0x3dc21b(0x1dc)]);let _0x27611f='';(!Number(_0x33f525)||Number(_0x33f525)===0x0)&&(_0x27611f=await this[_0x3dc21b(0x264)][_0x3dc21b(0x1d8)]({'filename':_0x398321,'url':_0x2abece}),console[_0x3dc21b(0x260)](_0x3dc21b(0x203),_0x27611f));const _0x3cd407={'curIp':(0x0,utils_1[_0x3dc21b(0x224)])(_0x419335),'userId':_0x419335[_0x3dc21b(0x27e)]['id'],'type':balance_constant_1[_0x3dc21b(0x1e9)][_0x3a248c(0x145)],'prompt':_0x4dbef1,'answer':_0x27611f,'model':'mj','extend':this[_0x3dc21b(0x278)](JSON[_0xfed0bd(0xfe)](_0x3f2ddc)),'message_id':_0x22f754,'upscaleId':_0x3c2479,'variationId':_0x3c2479,'action':_0x3dc21b(0x1df),'orderId':_0x5a3c9c[_0x3dc21b(0x234)],'isSaveImg':!Number(_0x33f525)||Number(_0x33f525)===0x0,'fileInfo':JSON[_0x3dc21b(0x268)]({'width':_0x1e65f1,'height':_0x3ebb65,'size':_0x3217ab,'filename':_0x398321,'cosUrl':_0x27611f})};return await this[_0x3dc21b(0x24e)][_0x3dc21b(0x242)](_0x3cd407),_0x27611f;}catch(_0x255e2f){console[_0x3a248c(0x13d)](_0x3dc21b(0x1fb),_0x255e2f),this[_0x3a248c(0x17b)]--,this[_0x3dc21b(0x248)]<0x0&&(this[_0x3a248c(0x17b)]=0x0),console[_0x3dc21b(0x260)](_0x3dc21b(0x1d2),this[_0x3a248c(0x17b)]);throw new common_1[(_0x3dc21b(0x1ea))](_0x255e2f[_0x3dc21b(0x221)],common_1[_0x3dc21b(0x212)][_0x3dc21b(0x209)]);}}async[_0x2ce8cf(0x222)](_0x242e0b,_0x3ac976){const _0x34bc32=_0x12d9,_0x681a1=_0x468ac4,_0x514e82=_0x2ce8cf;if(this[_0x34bc32(0x10b)]>=0x3)throw new common_1[(_0x514e82(0x1ea))](_0x34bc32(0x14d),common_1[_0x514e82(0x212)][_0x514e82(0x209)]);await this[_0x514e82(0x202)](_0x3ac976),await this[_0x514e82(0x23b)](_0x3ac976),this[_0x514e82(0x248)]++,console[_0x514e82(0x260)]('用户'+_0x3ac976[_0x514e82(0x27e)]['id']+_0x514e82(0x1e1),this[_0x514e82(0x248)]);const {message_id:_0x5e1cf7,orderId:_0x3eebcf}=_0x242e0b;try{const _0x14ac39=await this[_0x681a1(0x1d6)][_0x681a1(0x173)]({'where':{'message_id':_0x5e1cf7}});if(!_0x14ac39)throw new common_1[(_0x514e82(0x1ea))](_0x514e82(0x262),common_1[_0x681a1(0x1bc)][_0x514e82(0x209)]);const {prompt:_0x718844,extend:_0x1b282b}=_0x14ac39;let _0x2ff246=null;try{_0x2ff246=JSON[_0x681a1(0x1c7)](_0x1b282b);}catch(_0x434c27){_0x2ff246=[];}const {components:components=[]}=_0x2ff246;if(!components[_0x514e82(0x1d6)])throw new common_1[(_0x514e82(0x1ea))](_0x514e82(0x23e),common_1[_0x514e82(0x212)][_0x681a1(0x133)]);const _0x5e1aa5=components[0x1][_0x514e82(0x1f9)][_0x3eebcf-0x1],{custom_id:_0x36ff6b}=_0x5e1aa5,_0x4afcd9=await this[_0x514e82(0x228)][_0x514e82(0x1de)]({'where':{'variationId':(0x0,typeorm_1[_0x514e82(0x233)])((0x0,typeorm_1[_0x514e82(0x217)])()),'prompt':(0x0,typeorm_1[_0x514e82(0x1e7)])('%'+_0x718844+'%')}}),_0x41753c=_0x4afcd9[_0x514e82(0x223)](_0x55dac3=>_0x55dac3[_0x681a1(0x1c0)]),_0x35b1ad={'message_id':_0x5e1cf7,'custom_id':_0x36ff6b,'prompt':_0x718844,'orderId':_0x3eebcf};await this[_0x514e82(0x23d)](_0x35b1ad);const _0x865061=await this[_0x514e82(0x1e2)](_0x35b1ad,_0x41753c);this[_0x514e82(0x248)]--,this[_0x514e82(0x248)]<0x0&&(this[_0x514e82(0x248)]=0x0),console[_0x34bc32(0xfd)](_0x681a1(0x1a8),this[_0x514e82(0x248)]);const {id:_0x5051ec,content:_0x1fbc21,channel_id:_0x35da97,attachments:attachments=[],timestamp:_0x2a6c74}=_0x865061;if(!attachments[_0x514e82(0x1d6)]||!attachments[0x0][_0x514e82(0x1e6)])throw new common_1[(_0x514e82(0x1ea))](_0x681a1(0x18f),common_1[_0x514e82(0x212)][_0x514e82(0x209)]);const {filename:_0x1b74d5,url:_0x59cab4,width:_0x3e0801,height:_0x245b6d,size:_0x55833d}=attachments[0x0],_0x9153c2=this[_0x514e82(0x25a)][_0x514e82(0x1ed)]([_0x681a1(0x18c)]);let _0x2d0477='';(!Number(_0x9153c2)||Number(_0x9153c2)===0x0)&&(_0x2d0477=await this[_0x514e82(0x264)][_0x514e82(0x1d8)]({'filename':_0x1b74d5,'url':_0x59cab4}),console[_0x514e82(0x260)](_0x514e82(0x203),_0x2d0477));const _0x1d01ac={'curIp':(0x0,utils_1[_0x514e82(0x224)])(_0x3ac976),'userId':_0x3ac976[_0x514e82(0x27e)]['id'],'type':balance_constant_1[_0x681a1(0x12f)][_0x514e82(0x24f)],'prompt':_0x718844,'answer':_0x2d0477,'model':'mj','group':0x1,'extend':this[_0x514e82(0x278)](JSON[_0x514e82(0x268)](_0x865061)),'message_id':_0x5051ec,'upscaleId':_0x5051ec,'variationId':_0x5051ec,'action':_0x681a1(0x198),'orderId':_0x35b1ad[_0x514e82(0x234)],'isSaveImg':!Number(_0x9153c2)||Number(_0x9153c2)===0x0,'fileInfo':JSON[_0x514e82(0x268)]({'width':_0x3e0801,'height':_0x245b6d,'size':_0x55833d,'filename':_0x1b74d5,'cosUrl':_0x2d0477})};return await this[_0x514e82(0x24e)][_0x514e82(0x242)](_0x1d01ac),_0x2d0477;}catch(_0xae80af){console[_0x34bc32(0xfd)](_0x514e82(0x1fb),_0xae80af),this[_0x514e82(0x248)]--,this[_0x514e82(0x248)]<0x0&&(this[_0x34bc32(0x10b)]=0x0),console[_0x514e82(0x260)](_0x514e82(0x1f1),this[_0x514e82(0x248)]);throw new common_1[(_0x514e82(0x1ea))](_0xae80af[_0x681a1(0x146)],common_1[_0x514e82(0x212)][_0x514e82(0x209)]);}}async[_0x2ce8cf(0x23d)](_0xc346b0){const _0x459ba2=_0x468ac4,_0x5729a5=_0x2ce8cf,{message_id:_0x55fdb6,custom_id:_0x486704}=_0xc346b0,{application_id:_0x47593f,guild_id:_0x37083e,channel_id:_0x265d55,session_id:_0x276b67,version:_0x3379d1,id:_0x38f1ba,authorization:_0x569cd0,mjProxy:_0x551b78}=await this[_0x5729a5(0x1f7)](),_0x1e6ba3=_0x551b78==0x1?_0x5729a5(0x267):_0x5729a5(0x27a),_0x100523={'authorization':_0x569cd0},_0x36b250={'type':0x3,'guild_id':_0x37083e,'channel_id':_0x265d55,'message_flags':0x0,'message_id':_0x55fdb6,'application_id':_0x47593f,'session_id':_0x276b67,'data':{'component_type':0x2,'custom_id':_0x486704}};try{await axios_1[_0x5729a5(0x1fe)][_0x5729a5(0x1d9)](_0x1e6ba3,_0x36b250,{'headers':_0x100523}),console[_0x459ba2(0x13d)](_0x459ba2(0x19c));}catch(_0x4f4aca){console[_0x5729a5(0x260)](_0x5729a5(0x1fb),_0x4f4aca);throw new common_1[(_0x5729a5(0x1ea))](_0x5729a5(0x23a),common_1[_0x5729a5(0x212)][_0x5729a5(0x209)]);}}async[_0x2ce8cf(0x216)](_0x145ea2,_0x54ddb9){const _0x5e56fc=_0x468ac4,_0x410b24=_0x2ce8cf,{message_id:_0x48d95c,custom_id:_0x15c9bf,prompt:_0x46e39d,orderId:_0x4335bc}=_0x145ea2;let _0x19e7e5=null,_0x54d2cb=0x0;while(!_0x19e7e5&&_0x54d2cb<0xa){try{const _0x5e7d5f=Date[_0x410b24(0x27b)](),_0x5d19cf=await this[_0x410b24(0x273)]();console[_0x5e56fc(0x13d)]('第\x20'+(_0x54d2cb+0x1)+_0x410b24(0x246)+_0x5d19cf[_0x410b24(0x1d6)]),_0x5d19cf&&_0x5d19cf[_0x410b24(0x1d6)]&&(_0x19e7e5=await this[_0x410b24(0x1d3)](_0x5d19cf,_0x145ea2,_0x54ddb9));const _0x127f58=Date[_0x410b24(0x27b)]()-_0x5e7d5f,_0x2e557b=0xbb8;await this[_0x410b24(0x256)](Math[_0x410b24(0x250)](_0x2e557b-_0x127f58,0x0)),_0x54d2cb++;}catch(_0xc32c4c){console[_0x410b24(0x281)](_0x410b24(0x239)+_0xc32c4c[_0x410b24(0x279)]);}}return _0x19e7e5;}async[_0x2ce8cf(0x1e2)](_0x1990d0,_0x3283a9){const _0x346401=_0x468ac4,_0x492e5e=_0x2ce8cf,{message_id:_0x49a448,custom_id:_0x21d19a,prompt:_0xb0d261,orderId:_0x2ff027}=_0x1990d0;console[_0x346401(0x13d)](_0x492e5e(0x1d5));let _0x13452b=null,_0x383276=0x0;while(!_0x13452b&&_0x383276<0xa){try{console[_0x346401(0x13d)]('第\x20'+(_0x383276+0x1)+_0x492e5e(0x1e0));const _0x243109=Date[_0x492e5e(0x27b)](),_0x5e2205=await this[_0x492e5e(0x273)]();_0x5e2205&&_0x5e2205[_0x492e5e(0x1d6)]&&(_0x13452b=await this[_0x492e5e(0x263)](_0x5e2205,_0x1990d0,_0x3283a9));const _0x16988d=Date[_0x492e5e(0x27b)]()-_0x243109,_0x4ce020=0x1f40;await this[_0x346401(0x187)](Math[_0x492e5e(0x250)](_0x4ce020-_0x16988d,0x0)),_0x383276++;}catch(_0x4755c0){console[_0x346401(0x19d)](_0x492e5e(0x239)+_0x4755c0[_0x492e5e(0x279)]);}}if(!_0x13452b)throw new common_1[(_0x346401(0x15d))](_0x492e5e(0x230),common_1[_0x492e5e(0x212)][_0x346401(0x133)]);return _0x13452b;}async[_0x2ce8cf(0x1d3)](_0xcb8e5b,_0x2a1899,_0x4ecbd6){const _0x2c7bc0=_0x468ac4,_0x28c19a=_0x2ce8cf,{message_id:_0x36e378,custom_id:_0x33dbc3,prompt:_0x4688c1,orderId:_0x2aac3a}=_0x2a1899,_0x3d9e23=_0x4688c1[_0x28c19a(0x1eb)](0x0,0xc);console[_0x28c19a(0x260)](_0x28c19a(0x1cf),_0x3d9e23);const _0x4a49bb=_0xcb8e5b[_0x2c7bc0(0x1b1)](_0xc9cef6=>{const _0x50cb76=_0x2c7bc0,_0x4aa178=_0x28c19a,{content:_0x9bcafa}=_0xc9cef6;if(!this[_0x4aa178(0x22b)](_0x9bcafa))return![];const {prompt:_0x187d1d,order:_0x7eb74f}=this[_0x4aa178(0x22b)](_0x9bcafa);return _0x187d1d[_0x50cb76(0x1da)](_0x3d9e23)&&_0x2a1899[_0x4aa178(0x234)]===_0x7eb74f&&!_0x4ecbd6[_0x4aa178(0x254)](_0xc9cef6['id']);});return _0x4a49bb;}async[_0x2ce8cf(0x263)](_0x1e4fb5,_0x59e2a4,_0x3b3e12){const _0x23702f=_0x12d9,_0xa63b97=_0x2ce8cf,{message_id:_0xd4a80a,custom_id:_0x251e89,prompt:_0x3eb677,orderId:_0x49830c}=_0x59e2a4,_0x2833a7=_0x3eb677[_0xa63b97(0x1eb)](0x0,0xc),_0x1c4e01=_0x1e4fb5[_0x23702f(0x14e)](_0x1e4064=>{const _0x5a2157=_0x23702f,_0x301c5c=_0x2cc0,_0x3036cb=_0xa63b97,{content:_0x237643}=_0x1e4064,_0xd48358=_0x237643[_0x5a2157(0x10e)](/\*\*(.+?)\*\*/),_0x1fb61d=_0xd48358?_0xd48358[0x1]:'';if(!_0x1fb61d)return![];return _0x1fb61d[_0x301c5c(0x1da)](_0x2833a7)&&!_0x3b3e12[_0x3036cb(0x254)](_0x1e4064['id']);});return _0x1c4e01;}async[_0x3712b1(0xd3)](_0x5ac561,_0x36cbbb,_0x48ff60){const _0x34a21f=_0x3712b1,_0x2f9abe=_0x468ac4,_0x9d1201=_0x2ce8cf,_0x545e5e=await this[_0x9d1201(0x273)](),_0x1016b4=await this[_0x9d1201(0x280)](_0x545e5e,_0x48ff60,_0x36cbbb);if(_0x1016b4)return console[_0x9d1201(0x260)](_0x9d1201(0x251),_0x1016b4),_0x1016b4;const {application_id:_0x29cd7f,guild_id:_0x1b97c2,channel_id:_0x52eb42,session_id:_0x48a5d8,version:_0x398b67,id:_0x5264e3,authorization:_0x297cac,mjProxy:_0x2310ff}=await this[_0x2f9abe(0x180)](),_0xaa2d38={'type':0x2,'application_id':_0x29cd7f,'guild_id':_0x1b97c2,'channel_id':_0x52eb42,'session_id':_0x48a5d8,'data':{'version':_0x398b67,'id':_0x5264e3,'name':_0x9d1201(0x282),'type':0x1,'options':[{'type':0x3,'name':_0x9d1201(0x21a),'value':_0x5ac561}],'attachments':[]}};try{const _0x17d1c3=_0x2310ff==0x1?_0x9d1201(0x267):_0x34a21f(0x16b),_0x402007={'authorization':_0x297cac},_0x6dc6e3=await axios_1[_0x9d1201(0x1fe)][_0x9d1201(0x1d9)](_0x17d1c3,_0xaa2d38,{'headers':_0x402007});return console[_0x2f9abe(0x13d)](_0x9d1201(0x213),_0x6dc6e3[_0x34a21f(0x118)]),![];}catch(_0x37b737){console[_0x9d1201(0x260)](_0x9d1201(0x26c),_0x37b737);throw new common_1[(_0x9d1201(0x1ea))](_0x9d1201(0x276),common_1[_0x9d1201(0x212)][_0x9d1201(0x209)]);}}async[_0x2ce8cf(0x24a)](_0x129187,_0x2f2610,_0x22d359){const _0x523bbd=_0x3712b1,_0x5f4c00=_0x468ac4,_0xbba5f4=_0x2ce8cf;console[_0xbba5f4(0x260)](_0xbba5f4(0x25b));const _0x18a1c4=Date[_0xbba5f4(0x27b)]();try{const _0x24a3f9=0xd,_0x2c8c20=0x2ee0,_0x3e93fe=0x1388,_0xc3e2f3=0x3c*0x3e8;let _0x160ef6=0x0,_0x586297=![],_0x463f41=null;while(!_0x463f41&&_0x160ef6<_0x24a3f9){console[_0xbba5f4(0x260)]('第\x20'+(_0x160ef6+0x1)+_0xbba5f4(0x244)),Date[_0xbba5f4(0x27b)]()-_0x18a1c4>=_0xc3e2f3&&(_0x586297=!![]),await this[_0xbba5f4(0x256)](_0x586297?_0x3e93fe:_0x2c8c20);const _0x39d1f1=await this[_0x5f4c00(0x1ad)]();_0x463f41=await this[_0x523bbd(0x139)](_0x39d1f1,_0x22d359,_0x2f2610),_0x160ef6++;}if(!_0x463f41)throw new common_1[(_0xbba5f4(0x1ea))](_0xbba5f4(0x20e),common_1[_0xbba5f4(0x212)][_0x523bbd(0x124)]);const _0x492994=Date[_0xbba5f4(0x27b)]();return console[_0x5f4c00(0x13d)](_0xbba5f4(0x1f8)+Math[_0x5f4c00(0x162)]((_0x492994-_0x18a1c4)/0x3e8)+'\x20S'),_0x463f41;}catch(_0x33a6e7){console[_0xbba5f4(0x281)](_0x33a6e7[_0x5f4c00(0x1c3)]);throw new common_1[(_0xbba5f4(0x1ea))](_0x5f4c00(0x164),common_1[_0x5f4c00(0x1bc)][_0xbba5f4(0x249)]);}}async[_0x468ac4(0x19f)](_0x3e456f,_0x10b418,_0x4b4c89){const _0xed53b8=_0x2ce8cf;if(!_0x3e456f||!_0x3e456f[_0xed53b8(0x1d6)])return;console[_0xed53b8(0x260)](_0xed53b8(0x277),_0x10b418);const _0x3079b4=_0x3e456f[_0xed53b8(0x1de)](_0x27116c=>{const _0x28acc4=_0x2cc0,_0x47bfad=_0xed53b8,{attachments:attachments=[],content:_0x5ef9df,edited_timestamp:_0x2fc2a7}=_0x27116c;return _0x5ef9df[_0x47bfad(0x254)](_0x10b418)&&attachments[_0x47bfad(0x1d6)]>0x0&&!_0x2fc2a7&&!_0x4b4c89[_0x28acc4(0x1da)](_0x27116c['id']);});return _0x3079b4||null;}async[_0x2ce8cf(0x273)](){const _0x3e1703=_0x3712b1,_0x17f445=_0x468ac4,_0x1db330=_0x2ce8cf;try{const {application_id:_0x21047b,guild_id:_0x580641,channel_id:_0x35c81f,session_id:_0x427178,version:_0x54accb,id:_0x73d904,authorization:_0x5933e6,mjProxy:_0x2fb749}=await this[_0x17f445(0x180)](),_0x41cc86=_0x2fb749==0x1?_0x3e1703(0x12c)+_0x35c81f:_0x1db330(0x23f)+_0x35c81f+_0x1db330(0x284),_0x556f1f={'authorization':_0x5933e6},_0x13b3da=await axios_1[_0x1db330(0x1fe)][_0x1db330(0x261)](_0x41cc86,{'headers':_0x556f1f});return _0x13b3da[_0x1db330(0x253)];}catch(_0x2f187f){console[_0x1db330(0x260)](_0x17f445(0x14d),_0x2f187f);throw new common_1[(_0x1db330(0x1ea))](_0x17f445(0x168),common_1[_0x1db330(0x212)][_0x17f445(0x133)]);}}async[_0x2ce8cf(0x256)](_0xbe101c){return new Promise(_0x4e32a9=>setTimeout(_0x4e32a9,_0xbe101c));}[_0x468ac4(0x1d4)](_0x36e461){const _0x19fc4d=_0x2ce8cf,_0x7511f0=_0x36e461[_0x19fc4d(0x26a)](/\*\*(.+?)\*\*/),_0x3d88f1=_0x36e461[_0x19fc4d(0x26a)](/- Image #(\d+)/);if(!_0x7511f0||!_0x3d88f1)return null;const _0x401755=_0x7511f0[0x1],_0x4d4c8d=parseInt(_0x3d88f1[0x1]);return{'prompt':_0x401755,'order':_0x4d4c8d};}async[_0x2ce8cf(0x1f7)](){const _0x537b9e=_0x3712b1,_0x30cf51=_0x468ac4,_0x2a6515=_0x2ce8cf,_0xde0bf1=await this[_0x2a6515(0x25a)][_0x2a6515(0x1ed)]([_0x2a6515(0x218),_0x2a6515(0x1f4),_0x2a6515(0x26f),_0x2a6515(0x211),_0x2a6515(0x259),_0x537b9e(0x15a),_0x2a6515(0x1ff),_0x30cf51(0x1d1),_0x2a6515(0x26b)]),_0x1804ed={'application_id':_0xde0bf1[_0x30cf51(0x1ba)],'guild_id':_0xde0bf1[_0x30cf51(0x128)],'channel_id':_0xde0bf1[_0x2a6515(0x211)],'session_id':_0xde0bf1[_0x2a6515(0x259)],'version':_0xde0bf1[_0x2a6515(0x245)],'id':_0xde0bf1[_0x2a6515(0x218)],'authorization':_0xde0bf1[_0x2a6515(0x1ff)],'mjRateLimit':_0xde0bf1[_0x2a6515(0x1d7)],'mjProxy':_0xde0bf1[_0x2a6515(0x26b)]||0x0};return _0x1804ed;}[_0x468ac4(0x17d)](_0x51be00){const _0x33bd08=_0x2ce8cf,_0x43bb88=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;return _0x51be00[_0x33bd08(0x22a)](_0x43bb88,'');}async[_0x2ce8cf(0x202)](_0x1c2653){const _0x41934d=_0x3712b1,_0xecf73e=_0x468ac4,_0x392876=_0x2ce8cf,_0x1a0386=await this[_0x392876(0x283)][_0x41934d(0x15c)]({'where':{'userId':_0x1c2653[_0x392876(0x27e)]['id']}}),{id:_0xca66a2,balance:_0x5a15bd}=_0x1a0386;if(!_0x5a15bd||(_0x1a0386===null||_0x1a0386===void 0x0?void 0x0:_0x1a0386[_0x392876(0x1ee)])<0x1)throw new common_1[(_0x392876(0x1ea))](_0x392876(0x21f),common_1[_0x392876(0x212)][_0xecf73e(0x133)]);}async[_0x2ce8cf(0x207)](_0x211276){const _0x16f53d=_0x468ac4,_0x37c9f6=_0x2ce8cf,{id:_0x1c105c,role:_0x55a7c3}=_0x211276[_0x37c9f6(0x27e)];!this[_0x37c9f6(0x269)][_0x1c105c]?this[_0x16f53d(0x1d9)][_0x1c105c]=0x1:this[_0x37c9f6(0x269)][_0x1c105c]=this[_0x37c9f6(0x269)][_0x1c105c]+0x1,console[_0x37c9f6(0x260)]('当前用户'+_0x1c105c+_0x37c9f6(0x24c),this[_0x37c9f6(0x269)][_0x1c105c]);}async[_0x2ce8cf(0x23b)](_0x5ddec6){const _0x1ff06b=_0x468ac4,_0xebb0c5=_0x2ce8cf,{id:_0x185c51,role:_0x2bfe7a}=_0x5ddec6[_0xebb0c5(0x27e)];if([_0xebb0c5(0x1fd),_0xebb0c5(0x1dd)][_0x1ff06b(0x1da)](_0x2bfe7a))return!![];const {mjRateLimit:_0x5bd3a6}=await this[_0x1ff06b(0x180)]();if(this[_0xebb0c5(0x24d)][_0x185c51]){const _0x4242ba=this[_0xebb0c5(0x24d)][_0x185c51];if(_0x4242ba>Date[_0xebb0c5(0x27b)]()){console[_0xebb0c5(0x260)](_0xebb0c5(0x1ec)+_0x185c51+_0xebb0c5(0x201));throw new common_1[(_0xebb0c5(0x1ea))](_0x1ff06b(0x15b)+_0x5bd3a6+_0xebb0c5(0x219),common_1[_0x1ff06b(0x1bc)][_0xebb0c5(0x209)]);}else this[_0xebb0c5(0x24d)][_0x185c51]=Date[_0xebb0c5(0x27b)]()+Number(_0x5bd3a6)*0x3e8;}else{const _0x4bd339=Date[_0xebb0c5(0x27b)]();this[_0xebb0c5(0x24d)][_0x185c51]=_0x4bd339+0x3e8*Number(_0x5bd3a6);}}async[_0x2ce8cf(0x270)](_0x29512d){const _0x13d53b=_0x468ac4,_0x400598=_0x2ce8cf;await this[_0x400598(0x283)][_0x400598(0x231)]()[_0x13d53b(0x199)](balance_entity_1[_0x400598(0x21e)])[_0x13d53b(0x1b3)]({'balance':()=>_0x400598(0x27d)})[_0x13d53b(0x1bf)](_0x400598(0x1fa),{'userId':_0x29512d[_0x400598(0x27e)]['id']})[_0x400598(0x24b)]();}async[_0x468ac4(0x1c5)](){return 0x1;}};function _0x2cc0(_0x419fb2,_0x19aa97){const _0x4d4d09=_0x5586();return _0x2cc0=function(_0x338526,_0x3c312d){_0x338526=_0x338526-0x127;let _0x31cc9b=_0x4d4d09[_0x338526];return _0x31cc9b;},_0x2cc0(_0x419fb2,_0x19aa97);}MjService=__decorate([(0x0,common_1[_0x2ce8cf(0x25d)])(),__param(0x0,(0x0,typeorm_2[_0x468ac4(0x13f)])(chatLog_entity_1[_0x2ce8cf(0x25e)])),__param(0x1,(0x0,typeorm_2[_0x2ce8cf(0x220)])(balance_entity_1[_0x2ce8cf(0x21e)])),__metadata(_0x2ce8cf(0x235),[typeorm_1[_0x2ce8cf(0x1f5)],typeorm_1[_0x2ce8cf(0x1f5)],upload_service_1[_0x2ce8cf(0x229)],chatLog_service_1[_0x2ce8cf(0x20c)],globalConfig_service_1[_0x2ce8cf(0x1d4)],fanyi_service_1[_0x2ce8cf(0x274)],badwords_service_1[_0x2ce8cf(0x208)]])],MjService),exports[_0x2ce8cf(0x26e)]=MjService;