'use strict';const _0x468ac4=_0x2cc0;(function(_0x2acb9e,_0x4104e2){const _0x2bf9a8=_0x2cc0,_0x131a56=_0x2acb9e();while(!![]){try{const _0x42c0fe=-parseInt(_0x2bf9a8(0x1ca))/0x1+parseInt(_0x2bf9a8(0x1ae))/0x2*(-parseInt(_0x2bf9a8(0x1b6))/0x3)+parseInt(_0x2bf9a8(0x1b0))/0x4+parseInt(_0x2bf9a8(0x159))/0x5+-parseInt(_0x2bf9a8(0x1d3))/0x6*(-parseInt(_0x2bf9a8(0x160))/0x7)+parseInt(_0x2bf9a8(0x161))/0x8+-parseInt(_0x2bf9a8(0x13c))/0x9*(parseInt(_0x2bf9a8(0x158))/0xa);if(_0x42c0fe===_0x4104e2)break;else _0x131a56['push'](_0x131a56['shift']());}catch(_0x371bc9){_0x131a56['push'](_0x131a56['shift']());}}}(_0x5586,0x74a97));const _0x2ce8cf=_0x3de2;function _0x3de2(_0xf724c6,_0x364ea6){const _0x5385e8=_0x4d5c();return _0x3de2=function(_0x13a5fb,_0x40df1c){_0x13a5fb=_0x13a5fb-0x1ce;let _0x9fba55=_0x5385e8[_0x13a5fb];return _0x9fba55;},_0x3de2(_0xf724c6,_0x364ea6);}(function(_0x261751,_0x5ca905){const _0xeddfff=_0x2cc0,_0x50c3da=_0x3de2,_0x58d3eb=_0x261751();while(!![]){try{const _0x1448de=-parseInt(_0x50c3da(0x1f3))/0x1+-parseInt(_0x50c3da(0x27c))/0x2+parseInt(_0x50c3da(0x22c))/0x3*(-parseInt(_0x50c3da(0x22f))/0x4)+parseInt(_0x50c3da(0x1e3))/0x5*(-parseInt(_0x50c3da(0x1d0))/0x6)+-parseInt(_0x50c3da(0x22d))/0x7+-parseInt(_0x50c3da(0x226))/0x8+parseInt(_0x50c3da(0x236))/0x9;if(_0x1448de===_0x5ca905)break;else _0x58d3eb[_0xeddfff(0x14a)](_0x58d3eb[_0xeddfff(0x12c)]());}catch(_0x2c3fe8){_0x58d3eb[_0xeddfff(0x14a)](_0x58d3eb[_0xeddfff(0x12c)]());}}}(_0x4d5c,0x6cc44));function _0x4d5c(){const _0x2df2c9=_0x2cc0,_0x23190b=[_0x2df2c9(0x154),'balanceEntity','/messages?limit=50','upscaleSingleImg','本次放大图片的id:\x20','9798FLSdrU','当前绘图任务满载、请排队等候、队列任务完成后即可开始您的任务...',_0x2df2c9(0x1b4),_0x2df2c9(0x190),_0x2df2c9(0x19b),'开始轮询单张变换图片结果',_0x2df2c9(0x171),_0x2df2c9(0x1d1),_0x2df2c9(0x139),_0x2df2c9(0x15c),_0x2df2c9(0x1a6),_0x2df2c9(0x129),_0x2df2c9(0x18c),_0x2df2c9(0x148),_0x2df2c9(0x1b1),_0x2df2c9(0x198),_0x2df2c9(0x191),_0x2df2c9(0x14f),_0x2df2c9(0x197),'2705FFmbxf',_0x2df2c9(0x140),_0x2df2c9(0x131),'url',_0x2df2c9(0x144),_0x2df2c9(0x1a7),_0x2df2c9(0x12f),_0x2df2c9(0x15d),_0x2df2c9(0x17e),'当前用户\x20',_0x2df2c9(0x163),_0x2df2c9(0x1d5),'object',_0x2df2c9(0x13b),'变化图片任务异常中断\x20队列-1:\x20',_0x2df2c9(0x1a2),'179033QVdcEj','mjApplicationId','Repository','当前图片没有绘画信息、无法放大!',_0x2df2c9(0x180),'本次绘图耗时:\x20','components',_0x2df2c9(0x18b),_0x2df2c9(0x149),_0x2df2c9(0x179),_0x2df2c9(0x194),_0x2df2c9(0x156),'mjAuthorization',_0x2df2c9(0x16c),_0x2df2c9(0x182),_0x2df2c9(0x1b5),_0x2df2c9(0x152),_0x2df2c9(0x16a),'../chatLog/chatLog.entity','draw',_0x2df2c9(0x16e),_0x2df2c9(0x1b8),_0x2df2c9(0x133),_0x2df2c9(0x1a9),_0x2df2c9(0x130),_0x2df2c9(0x15a),_0x2df2c9(0x19a),'绘画超时，请稍后再试！',_0x2df2c9(0x135),'../upload/upload.service',_0x2df2c9(0x18a),'HttpStatus',_0x2df2c9(0x196),'../fanyi/fanyi.service',_0x2df2c9(0x165),_0x2df2c9(0x1af),'IsNull',_0x2df2c9(0x1c1),_0x2df2c9(0x1a4),_0x2df2c9(0x16b),'发送放大指令成功',_0x2df2c9(0x142),_0x2df2c9(0x138),_0x2df2c9(0x1aa),_0x2df2c9(0x183),_0x2df2c9(0x13f),_0x2df2c9(0x146),_0x2df2c9(0x1a1),_0x2df2c9(0x1cd),_0x2df2c9(0x189),_0x2df2c9(0x1d8),_0x2df2c9(0x1cb),_0x2df2c9(0x12b),_0x2df2c9(0x1d6),_0x2df2c9(0x12e),_0x2df2c9(0x137),_0x2df2c9(0x1d4),'3sdIdYK',_0x2df2c9(0x167),_0x2df2c9(0x1d2),_0x2df2c9(0x1ac),_0x2df2c9(0x150),_0x2df2c9(0x1ab),'decorate',_0x2df2c9(0x1cf),_0x2df2c9(0x1b9),_0x2df2c9(0x141),_0x2df2c9(0x136),_0x2df2c9(0x153),'开始请求放大图片\x20队列+1:\x20',_0x2df2c9(0x12d),_0x2df2c9(0x177),_0x2df2c9(0x13a),_0x2df2c9(0x13e),_0x2df2c9(0x1c6),_0x2df2c9(0x1b7),_0x2df2c9(0x1ce),'__metadata',_0x2df2c9(0x15f),_0x2df2c9(0x14c),_0x2df2c9(0x1c2),_0x2df2c9(0x1b2),_0x2df2c9(0x143),_0x2df2c9(0x16f),_0x2df2c9(0x1cc),_0x2df2c9(0x17b),'INTERNAL_SERVER_ERROR','pollForResult',_0x2df2c9(0x1d0),'使用的次数：',_0x2df2c9(0x1a5),'chatLogService',_0x2df2c9(0x145),_0x2df2c9(0x18d),_0x2df2c9(0x174),'convertToEnglish',_0x2df2c9(0x169),_0x2df2c9(0x1da),_0x2df2c9(0x178),_0x2df2c9(0x187),_0x2df2c9(0x1a3),_0x2df2c9(0x173),_0x2df2c9(0x1bd),'globalConfigService',_0x2df2c9(0x127),'function','Injectable',_0x2df2c9(0x186),_0x2df2c9(0x172),_0x2df2c9(0x13d),_0x2df2c9(0x14e),_0x2df2c9(0x17f),_0x2df2c9(0x14b),_0x2df2c9(0x1bb),_0x2df2c9(0x175),_0x2df2c9(0x185),_0x2df2c9(0x16d),_0x2df2c9(0x17c),_0x2df2c9(0x1d9),'match','mjProxy',_0x2df2c9(0x1a0),_0x2df2c9(0x181),'MjService','mjGuildId',_0x2df2c9(0x192),'sendDrawInteractions',_0x2df2c9(0x18e),_0x2df2c9(0x1ad),'FanyiService',_0x2df2c9(0x1be),_0x2df2c9(0x19e),_0x2df2c9(0x170),_0x2df2c9(0x17d),_0x2df2c9(0x1c3),_0x2df2c9(0x15e),_0x2df2c9(0x134),_0x2df2c9(0x151),_0x2df2c9(0x1c9),_0x2df2c9(0x188),_0x2df2c9(0x1d7),_0x2df2c9(0x19f),_0x2df2c9(0x19d)];return _0x4d5c=function(){return _0x23190b;},_0x4d5c();}var __decorate=this&&this[_0x2ce8cf(0x275)]||function(_0x4b9a4f,_0x5e9a80,_0x43f32d,_0x31a7d7){const _0x41a387=_0x2ce8cf;var _0x10fa93=arguments[_0x41a387(0x1d6)],_0x2fa34a=_0x10fa93<0x3?_0x5e9a80:_0x31a7d7===null?_0x31a7d7=Object[_0x41a387(0x272)](_0x5e9a80,_0x43f32d):_0x31a7d7,_0x54cda7;if(typeof Reflect===_0x41a387(0x1ef)&&typeof Reflect[_0x41a387(0x232)]===_0x41a387(0x25c))_0x2fa34a=Reflect[_0x41a387(0x232)](_0x4b9a4f,_0x5e9a80,_0x43f32d,_0x31a7d7);else{for(var _0x3083bc=_0x4b9a4f[_0x41a387(0x1d6)]-0x1;_0x3083bc>=0x0;_0x3083bc--)if(_0x54cda7=_0x4b9a4f[_0x3083bc])_0x2fa34a=(_0x10fa93<0x3?_0x54cda7(_0x2fa34a):_0x10fa93>0x3?_0x54cda7(_0x5e9a80,_0x43f32d,_0x2fa34a):_0x54cda7(_0x5e9a80,_0x43f32d))||_0x2fa34a;}return _0x10fa93>0x3&&_0x2fa34a&&Object[_0x41a387(0x241)](_0x5e9a80,_0x43f32d,_0x2fa34a),_0x2fa34a;},__metadata=this&&this[_0x2ce8cf(0x240)]||function(_0x3c2afd,_0x42f844){const _0x40670d=_0x2cc0,_0x25dafb=_0x2ce8cf;if(typeof Reflect===_0x40670d(0x12a)&&typeof Reflect[_0x25dafb(0x204)]===_0x25dafb(0x25c))return Reflect[_0x25dafb(0x204)](_0x3c2afd,_0x42f844);},__param=this&&this[_0x2ce8cf(0x1f2)]||function(_0x364d78,_0x322c1f){return function(_0x43308e,_0x204252){_0x322c1f(_0x43308e,_0x204252,_0x364d78);};};function _0x5586(){const _0x32c9c4=['saveChatLog','axios\x20get:\x20','get','开始请求变换图片\x20队列+1:\x20','变换当前图片超时！','852180mljKSt','存入图片完成:\x20','randomId:\x20','imagine','pollForResult','default','../globalConfig/globalConfig.service','120490cgyWag','1079520LnPELa','ChatLogService','由于速率限制、当前普通用户限制为','post','HttpException','https://discord.com/api/v9/interactions','defineProperty','21hqLUSJ','3404296abgQSC','floor','getConfigs','网络连接失败，请稍后再试！','baiduFanyiSecret','@nestjs/common','5300953zOyOXs','查询绘制结果失败...','data','metadata','prompt','checkBadWords','http://172.247.48.137:8000/mj/draw','checkFree','\x20次开始查询\x20=>\x20当前查询结果：','本次比对的随机ID:\x20','length','开始请求用户','findOne','有历史信息之间返回:\x20','\x20队列+1:\x20','放大当前图片失败','放大单张图片请求失败...','badwordsService','../userBalance/balance.entity','__esModule','queueCount','stringify','removeEmoji','substring','历史记录中不存在当前图片、请确认您需要变换的图片是否存在','getMjDefaultParams','绘画失败','\x20请求过于频繁！','您当前暂无MJ绘画余额！！！','enlargeWorking','fanyiService','ChatLogEntity','sleep','user','getClientIp','mjChannelId','userId\x20=\x20:userId','mjNotSaveImg','max','getOwnPropertyDescriptor','变换当前图片失败','findCurrentEnlargeImgResult','\x20次开始查询[变换图片]','deductBalance','当前图片已经放大过了、请勿重复放大!','admin','axios','发送绘画指令结果:\x20','pollForVariationResult','enlarge','update','../../common/constants/balance.constant','GlobalConfigService','绘图指令完成','error','绘画请求失败、当前使用人数过多、请稍后试试吧、排队中...','findCurrentPromptResult','axios:\x20','variationSingleImg','__param','@nestjs/typeorm','秒请求一次、请合理使用！','rateLimits','message_id','mjDraw','变换图片任务结束\x20队列-1:\x20','当前提示词已经在任务队列中了、请勿重复提交。。。','BalanceEntity','createQueryBuilder','2166988olPFxH','queryMessageList','2IpmTfB','pollForUpscaleResult','3693980rlGOEp','find','\x20次开始查询','set','放大图片任务异常中断\x20队列-1:\x20','checkAuth','1028961gwnkTd','当前图片没有绘画信息、无法变体!','BadwordsService','orderId','mjApplicationId','uploadService','HttpStatus','mjSessionId','__decorate','where','variationId','mjId','历史中存在当前图片、直接获取！','message','baiduFanyiAppId','test','sendSmInteractions','parse','绘制图片任务结束\x20队列-1:\x20','balance\x20-\x201','339596QxDseY','3962920wROKwQ','typeorm','map','https://discord.com/api/v9/channels/','Not','execute','mjRateLimit','历史记录中不存在当前图片、请确认您放大的图片是否存在','660966OCwRpi','extractContent','balance','chatLogEntity','放大图片任务结束\x20队列-1:\x20','prompt\x20-------->\x20\x20','freeQueueUsers','includes','开始查询绘画结果轮询','mjGuildId','放大custom_id:\x20','object','拿到了远程地址:\x20','shift','查询期间出现错误：','UploadService','DeductionKey','历史这些id已经被获取过了\x20不能拿了:\x20','drawWorking','mjservice','BAD_REQUEST','now','../chatLog/chatLog.service','33556275PyCpLj','replace','filter','uploadFileFromUrl','checkRateLimit','createRandomUid','549iblSKW','log','绘制图片任务异常中断\x20队列-1:\x20','InjectRepository','../badwords/badwords.service','design:paramtypes','../../common/utils','mjVersion','Like','PAINT_TYPE','response','绘画任务开始','super','error:\x20','push','findCurrentVariationImgResult'];_0x5586=function(){return _0x32c9c4;};return _0x5586();}Object[_0x468ac4(0x15f)](exports,_0x468ac4(0x17a),{'value':!![]}),exports[_0x2ce8cf(0x26e)]=void 0x0;const globalConfig_service_1=require(_0x468ac4(0x157)),upload_service_1=require(_0x2ce8cf(0x210)),common_1=require(_0x468ac4(0x166)),axios_1=require(_0x468ac4(0x195)),chatLog_service_1=require(_0x2ce8cf(0x20f)),balance_constant_1=require(_0x2ce8cf(0x20d)),utils_1=require(_0x2ce8cf(0x21c)),chatLog_entity_1=require(_0x2ce8cf(0x205)),typeorm_1=require(_0x2ce8cf(0x247)),typeorm_2=require(_0x2ce8cf(0x257)),balance_entity_1=require(_0x2ce8cf(0x1fc)),fanyi_service_1=require(_0x2ce8cf(0x214)),badwords_service_1=require(_0x2ce8cf(0x1e4));let MjService=class MjService{constructor(_0x123bc2,_0x38837e,_0x31991d,_0x3288a0,_0x49b275,_0x3e966a,_0x3364ba){const _0x1e95aa=_0x468ac4,_0x4308b4=_0x2ce8cf;this[_0x4308b4(0x228)]=_0x123bc2,this[_0x4308b4(0x283)]=_0x38837e,this[_0x4308b4(0x264)]=_0x31991d,this[_0x4308b4(0x24e)]=_0x3288a0,this[_0x4308b4(0x25a)]=_0x49b275,this[_0x4308b4(0x266)]=_0x3e966a,this[_0x4308b4(0x255)]=_0x3364ba,this[_0x4308b4(0x24d)]={},this[_0x1e95aa(0x131)]=[],this[_0x1e95aa(0x184)]=[],this[_0x4308b4(0x248)]=0x0,this[_0x4308b4(0x269)]={};}async[_0x2ce8cf(0x1e8)](_0x4c587d){const _0xed66f1=_0x468ac4,_0x2d1f30=_0x2ce8cf,{jobId:_0x2aad88,prompt:_0x250a6f,startTime:_0x32a39b,userId:_0x1b2a6b}=_0x4c587d;return console[_0x2d1f30(0x260)](_0xed66f1(0x147),_0xed66f1(0x132)),await new Promise(_0xc0f388=>setTimeout(_0xc0f388,0x1388)),{'a':0x1,'b':0x2};}async[_0x2ce8cf(0x206)](_0x8ae4d0,_0x7b64c6){const _0xcd63d7=_0x468ac4,_0x99b4bf=_0x2ce8cf;await this[_0x99b4bf(0x202)](_0x7b64c6),await this[_0x99b4bf(0x255)][_0x99b4bf(0x200)](_0x8ae4d0[_0x99b4bf(0x21a)],_0x7b64c6[_0x99b4bf(0x27e)]['id']);const _0x4b6f44=_0x8ae4d0[_0xcd63d7(0x16b)];let _0x57028e=_0x8ae4d0[_0x99b4bf(0x21a)];const {baiduFanyiAppId:_0x155d5c,baiduFanyiSecret:_0x3e325a}=await this['globalConfigService'][_0x99b4bf(0x1ed)]([_0xcd63d7(0x1c4),_0x99b4bf(0x215)]);_0x155d5c&&_0x3e325a&&(_0x57028e=await this[_0x99b4bf(0x266)][_0x99b4bf(0x252)](_0x4b6f44));const _0x5a3b3f='['+(0x0,utils_1[_0x99b4bf(0x1f0)])()+']',_0x1a8d3c=_0x5a3b3f+'\x20'+_0x57028e;console[_0xcd63d7(0x13d)](_0x99b4bf(0x237),_0x5a3b3f),console[_0x99b4bf(0x260)](_0x99b4bf(0x225),_0x1a8d3c);const _0x555265=this[_0x99b4bf(0x1e5)][_0x99b4bf(0x1de)](_0x21eed8=>_0x21eed8[_0x99b4bf(0x254)](_0x8ae4d0[_0x99b4bf(0x21a)]));if(_0x555265)throw new common_1[(_0x99b4bf(0x1ea))](_0x99b4bf(0x20a),common_1[_0x99b4bf(0x212)][_0x99b4bf(0x209)]);if(this[_0x99b4bf(0x248)]>=0x3)throw new common_1[(_0xcd63d7(0x15d))](_0x99b4bf(0x1d1),common_1[_0x99b4bf(0x212)][_0xcd63d7(0x133)]);await this[_0x99b4bf(0x23b)](_0x7b64c6),this[_0x99b4bf(0x248)]++,console[_0x99b4bf(0x260)](_0x99b4bf(0x25f)+_0x7b64c6[_0x99b4bf(0x27e)]['id']+_0x99b4bf(0x265),this[_0xcd63d7(0x17b)]);try{const _0xef5687=await this[_0x99b4bf(0x228)][_0x99b4bf(0x1de)]({'where':{'prompt':(0x0,typeorm_1[_0x99b4bf(0x1e7)])('%'+_0x1a8d3c+'%')}}),_0x5c9a6e=_0xef5687[_0x99b4bf(0x223)](_0x1ec1af=>_0x1ec1af[_0xcd63d7(0x1a6)]);this[_0x99b4bf(0x1e5)][_0xcd63d7(0x14a)](_0x1a8d3c);let _0x3679e5;const _0x65826b=await this[_0x99b4bf(0x271)](_0x1a8d3c,_0x5c9a6e,_0x5a3b3f);_0x65826b?(console[_0x99b4bf(0x260)](_0x99b4bf(0x243)),_0x3679e5=_0x65826b):_0x3679e5=await this[_0xcd63d7(0x155)](_0x1a8d3c,_0x5c9a6e,_0x5a3b3f),(this[_0x99b4bf(0x248)]--,this[_0x99b4bf(0x248)]<0x0&&(this[_0x99b4bf(0x248)]=0x0),console[_0xcd63d7(0x13d)](_0xcd63d7(0x1c8),this[_0x99b4bf(0x248)]));const {id:_0x188986,content:_0x2fe35c,channel_id:_0x1549c2,attachments:attachments=[],timestamp:_0x4a9b69}=_0x3679e5;if(!attachments[_0x99b4bf(0x1d6)]||!attachments[0x0][_0x99b4bf(0x1e6)])throw new common_1[(_0x99b4bf(0x1ea))](_0x99b4bf(0x26d),common_1[_0x99b4bf(0x212)][_0x99b4bf(0x209)]);const {filename:_0x3b490d,url:_0x306005,width:_0x3e7f78,height:_0x3f9d16,size:_0x46b4e4}=attachments[0x0];console[_0x99b4bf(0x260)](_0x99b4bf(0x227),_0x306005);const _0x9bb173=this[_0x99b4bf(0x25a)][_0x99b4bf(0x1ed)]([_0x99b4bf(0x1dc)]);let _0x4063b8='';(!Number(_0x9bb173)||Number(_0x9bb173)===0x0)&&(_0x4063b8=await this[_0x99b4bf(0x264)][_0x99b4bf(0x1d8)]({'filename':_0x3b490d,'url':_0x306005}),console[_0xcd63d7(0x13d)](_0x99b4bf(0x203),_0x4063b8));const _0x8fe773={'curIp':(0x0,utils_1[_0x99b4bf(0x224)])(_0x7b64c6),'userId':_0x7b64c6[_0xcd63d7(0x188)]['id'],'type':balance_constant_1[_0x99b4bf(0x1e9)][_0xcd63d7(0x145)],'prompt':_0x1a8d3c,'answer':_0x4063b8,'model':'mj','extend':this[_0x99b4bf(0x278)](JSON[_0x99b4bf(0x268)](_0x3679e5)),'message_id':_0x188986,'variationId':_0x188986,'upscaleId':_0x188986,'group':0x1,'isSaveImg':!Number(_0x9bb173)||Number(_0x9bb173)===0x0,'fileInfo':JSON[_0xcd63d7(0x17c)]({'width':_0x3e7f78,'height':_0x3f9d16,'size':_0x46b4e4,'filename':_0x3b490d,'cosUrl':_0x4063b8})};return await this[_0x99b4bf(0x24e)][_0x99b4bf(0x242)](_0x8fe773),await this[_0x99b4bf(0x270)](_0x7b64c6),this[_0x99b4bf(0x1e5)]=this[_0xcd63d7(0x131)][_0x99b4bf(0x21d)](_0x2e1cef=>_0x2e1cef!==_0x8ae4d0[_0x99b4bf(0x21a)]),_0x4063b8;}catch(_0x13a676){this[_0x99b4bf(0x248)]--,this[_0x99b4bf(0x248)]<0x0&&(this[_0x99b4bf(0x248)]=0x0),console[_0x99b4bf(0x260)](_0x99b4bf(0x23c),this[_0x99b4bf(0x248)]),this[_0x99b4bf(0x1e5)]=this[_0x99b4bf(0x1e5)][_0x99b4bf(0x21d)](_0x592e60=>_0x592e60!==_0x8ae4d0[_0x99b4bf(0x21a)]);throw new common_1['HttpException'](_0x13a676[_0x99b4bf(0x221)],common_1[_0xcd63d7(0x1bc)][_0x99b4bf(0x209)]);}}async[_0x2ce8cf(0x1ce)](_0x29a474,_0x534761){const _0x20c537=_0x468ac4,_0x2ae67e=_0x2ce8cf;if(this[_0x2ae67e(0x248)]>=0x3)throw new common_1[(_0x2ae67e(0x1ea))](_0x2ae67e(0x1d1),common_1[_0x2ae67e(0x212)][_0x2ae67e(0x209)]);this[_0x2ae67e(0x248)]++,console[_0x2ae67e(0x260)]('用户'+_0x534761[_0x2ae67e(0x27e)]['id']+_0x2ae67e(0x238),this[_0x2ae67e(0x248)]);const {message_id:_0x2be5cf,orderId:_0x361398}=_0x29a474;try{const _0xff8b06=await this[_0x2ae67e(0x228)][_0x2ae67e(0x258)]({'where':{'message_id':_0x2be5cf}});if(!_0xff8b06)throw new common_1[(_0x2ae67e(0x1ea))](_0x2ae67e(0x22e),common_1[_0x2ae67e(0x212)][_0x2ae67e(0x209)]);const _0x4cbf37=await this[_0x20c537(0x1d6)][_0x2ae67e(0x258)]({'where':{'upscaleId':_0x2be5cf,'action':_0x2ae67e(0x1df),'orderId':_0x361398}});if(_0x4cbf37)throw new common_1[(_0x2ae67e(0x1ea))](_0x20c537(0x193),common_1[_0x2ae67e(0x212)][_0x2ae67e(0x209)]);const {prompt:_0x4fa3e1,extend:_0x343188}=_0xff8b06;let _0x5a0d86=null;try{_0x5a0d86=JSON[_0x20c537(0x1c7)](_0x343188);}catch(_0x42ba62){_0x5a0d86=[];}const {components:components=[]}=_0x5a0d86;if(!components[_0x2ae67e(0x1d6)])throw new common_1[(_0x20c537(0x15d))](_0x2ae67e(0x1f6),common_1[_0x2ae67e(0x212)][_0x2ae67e(0x209)]);const _0x2bb9d7=components[0x0][_0x2ae67e(0x1f9)][_0x361398-0x1],{custom_id:_0x4f4caa}=_0x2bb9d7;console[_0x20c537(0x13d)](_0x2ae67e(0x1db),_0x4f4caa);const _0x2c4e26={'message_id':_0x2be5cf,'custom_id':_0x4f4caa,'prompt':_0x4fa3e1,'orderId':_0x361398};await this['sendSmInteractions'](_0x2c4e26),console[_0x2ae67e(0x260)](_0x2ae67e(0x21b));const _0x50628f=await this[_0x2ae67e(0x228)][_0x2ae67e(0x1de)]({'where':{'prompt':(0x0,typeorm_1['Like'])('%'+_0x4fa3e1+'%')}}),_0x3d0483=_0x50628f[_0x2ae67e(0x223)](_0x5f4cfc=>_0x5f4cfc[_0x2ae67e(0x1da)]);console[_0x2ae67e(0x260)](_0x2ae67e(0x20b),_0x3d0483);const _0x55de6b=await this[_0x20c537(0x1af)](_0x2c4e26,_0x3d0483);this[_0x2ae67e(0x248)]--,this[_0x2ae67e(0x248)]<0x0&&(this[_0x2ae67e(0x248)]=0x0),console[_0x2ae67e(0x260)](_0x2ae67e(0x27f),this[_0x2ae67e(0x248)]);const {id:_0x5d4e10,content:_0x42f537,channel_id:_0x36d10d,attachments:attachments=[],timestamp:_0x36fe04}=_0x55de6b;if(!attachments[_0x2ae67e(0x1d6)]||!attachments[0x0][_0x2ae67e(0x1e6)])throw new common_1[(_0x2ae67e(0x1ea))](_0x20c537(0x176),common_1[_0x2ae67e(0x212)][_0x2ae67e(0x209)]);const {filename:_0x42baa9,url:_0x476ec1,width:_0x58f5fa,height:_0xd8ffbb,size:_0x5c13f0}=attachments[0x0],_0x41ae23=this[_0x2ae67e(0x25a)][_0x20c537(0x163)]([_0x2ae67e(0x1dc)]);let _0x232b7c='';(!Number(_0x41ae23)||Number(_0x41ae23)===0x0)&&(_0x232b7c=await this[_0x2ae67e(0x264)][_0x2ae67e(0x1d8)]({'filename':_0x42baa9,'url':_0x476ec1}),console[_0x2ae67e(0x260)](_0x2ae67e(0x203),_0x232b7c));const _0x2374e1={'curIp':(0x0,utils_1[_0x2ae67e(0x224)])(_0x534761),'userId':_0x534761[_0x2ae67e(0x27e)]['id'],'type':balance_constant_1[_0x2ae67e(0x1e9)][_0x20c537(0x145)],'prompt':_0x4fa3e1,'answer':_0x232b7c,'model':'mj','extend':this[_0x2ae67e(0x278)](JSON['stringify'](_0x55de6b)),'message_id':_0x2be5cf,'upscaleId':_0x5d4e10,'variationId':_0x5d4e10,'action':_0x2ae67e(0x1df),'orderId':_0x2c4e26[_0x2ae67e(0x234)],'isSaveImg':!Number(_0x41ae23)||Number(_0x41ae23)===0x0,'fileInfo':JSON[_0x2ae67e(0x268)]({'width':_0x58f5fa,'height':_0xd8ffbb,'size':_0x5c13f0,'filename':_0x42baa9,'cosUrl':_0x232b7c})};return await this[_0x2ae67e(0x24e)][_0x2ae67e(0x242)](_0x2374e1),_0x232b7c;}catch(_0x5c5e9d){console[_0x20c537(0x13d)](_0x2ae67e(0x1fb),_0x5c5e9d),this[_0x20c537(0x17b)]--,this[_0x2ae67e(0x248)]<0x0&&(this[_0x20c537(0x17b)]=0x0),console[_0x2ae67e(0x260)](_0x2ae67e(0x1d2),this[_0x20c537(0x17b)]);throw new common_1[(_0x2ae67e(0x1ea))](_0x5c5e9d[_0x2ae67e(0x221)],common_1[_0x2ae67e(0x212)][_0x2ae67e(0x209)]);}}async[_0x2ce8cf(0x222)](_0x3f83a6,_0x3b27b0){const _0xd3f185=_0x468ac4,_0x2b27a2=_0x2ce8cf;if(this['queueCount']>=0x3)throw new common_1[(_0x2b27a2(0x1ea))]('当前绘图任务满载、请排队等候、队列任务完成后即可开始您的任务...',common_1[_0x2b27a2(0x212)][_0x2b27a2(0x209)]);await this[_0x2b27a2(0x202)](_0x3b27b0),await this[_0x2b27a2(0x23b)](_0x3b27b0),this[_0x2b27a2(0x248)]++,console[_0x2b27a2(0x260)]('用户'+_0x3b27b0[_0x2b27a2(0x27e)]['id']+_0x2b27a2(0x1e1),this[_0x2b27a2(0x248)]);const {message_id:_0x12fba3,orderId:_0x36762a}=_0x3f83a6;try{const _0x83dfb4=await this[_0xd3f185(0x1d6)][_0xd3f185(0x173)]({'where':{'message_id':_0x12fba3}});if(!_0x83dfb4)throw new common_1[(_0x2b27a2(0x1ea))](_0x2b27a2(0x262),common_1[_0xd3f185(0x1bc)][_0x2b27a2(0x209)]);const {prompt:_0x583453,extend:_0x5ab3cc}=_0x83dfb4;let _0x871441=null;try{_0x871441=JSON[_0xd3f185(0x1c7)](_0x5ab3cc);}catch(_0x1a5e58){_0x871441=[];}const {components:components=[]}=_0x871441;if(!components[_0x2b27a2(0x1d6)])throw new common_1[(_0x2b27a2(0x1ea))](_0x2b27a2(0x23e),common_1[_0x2b27a2(0x212)][_0xd3f185(0x133)]);const _0x122193=components[0x1][_0x2b27a2(0x1f9)][_0x36762a-0x1],{custom_id:_0x37fbf0}=_0x122193,_0x2804d1=await this[_0x2b27a2(0x228)][_0x2b27a2(0x1de)]({'where':{'variationId':(0x0,typeorm_1[_0x2b27a2(0x233)])((0x0,typeorm_1[_0x2b27a2(0x217)])()),'prompt':(0x0,typeorm_1[_0x2b27a2(0x1e7)])('%'+_0x583453+'%')}}),_0x2f7da1=_0x2804d1[_0x2b27a2(0x223)](_0x1d1c58=>_0x1d1c58[_0xd3f185(0x1c0)]),_0x2c446a={'message_id':_0x12fba3,'custom_id':_0x37fbf0,'prompt':_0x583453,'orderId':_0x36762a};await this[_0x2b27a2(0x23d)](_0x2c446a);const _0x3d0708=await this[_0x2b27a2(0x1e2)](_0x2c446a,_0x2f7da1);this[_0x2b27a2(0x248)]--,this[_0x2b27a2(0x248)]<0x0&&(this[_0x2b27a2(0x248)]=0x0),console['log'](_0xd3f185(0x1a8),this[_0x2b27a2(0x248)]);const {id:_0x2d8bbb,content:_0x42a74b,channel_id:_0x55516d,attachments:attachments=[],timestamp:_0x26d8f3}=_0x3d0708;if(!attachments[_0x2b27a2(0x1d6)]||!attachments[0x0][_0x2b27a2(0x1e6)])throw new common_1[(_0x2b27a2(0x1ea))](_0xd3f185(0x18f),common_1[_0x2b27a2(0x212)][_0x2b27a2(0x209)]);const {filename:_0x19e147,url:_0x1de8d6,width:_0x183aa9,height:_0x27b964,size:_0x85db93}=attachments[0x0],_0x4f319a=this[_0x2b27a2(0x25a)][_0x2b27a2(0x1ed)]([_0xd3f185(0x18c)]);let _0x208d56='';(!Number(_0x4f319a)||Number(_0x4f319a)===0x0)&&(_0x208d56=await this[_0x2b27a2(0x264)][_0x2b27a2(0x1d8)]({'filename':_0x19e147,'url':_0x1de8d6}),console[_0x2b27a2(0x260)](_0x2b27a2(0x203),_0x208d56));const _0x355f72={'curIp':(0x0,utils_1[_0x2b27a2(0x224)])(_0x3b27b0),'userId':_0x3b27b0[_0x2b27a2(0x27e)]['id'],'type':balance_constant_1[_0xd3f185(0x12f)][_0x2b27a2(0x24f)],'prompt':_0x583453,'answer':_0x208d56,'model':'mj','group':0x1,'extend':this[_0x2b27a2(0x278)](JSON[_0x2b27a2(0x268)](_0x3d0708)),'message_id':_0x2d8bbb,'upscaleId':_0x2d8bbb,'variationId':_0x2d8bbb,'action':_0xd3f185(0x198),'orderId':_0x2c446a[_0x2b27a2(0x234)],'isSaveImg':!Number(_0x4f319a)||Number(_0x4f319a)===0x0,'fileInfo':JSON[_0x2b27a2(0x268)]({'width':_0x183aa9,'height':_0x27b964,'size':_0x85db93,'filename':_0x19e147,'cosUrl':_0x208d56})};return await this[_0x2b27a2(0x24e)][_0x2b27a2(0x242)](_0x355f72),_0x208d56;}catch(_0x4dbf38){console['log'](_0x2b27a2(0x1fb),_0x4dbf38),this[_0x2b27a2(0x248)]--,this[_0x2b27a2(0x248)]<0x0&&(this['queueCount']=0x0),console[_0x2b27a2(0x260)](_0x2b27a2(0x1f1),this[_0x2b27a2(0x248)]);throw new common_1[(_0x2b27a2(0x1ea))](_0x4dbf38[_0xd3f185(0x146)],common_1[_0x2b27a2(0x212)][_0x2b27a2(0x209)]);}}async[_0x2ce8cf(0x23d)](_0x1de8fa){const _0x75bfae=_0x468ac4,_0x3d47b6=_0x2ce8cf,{message_id:_0x28ec16,custom_id:_0x16e37e}=_0x1de8fa,{application_id:_0x5948ac,guild_id:_0x24c925,channel_id:_0x58de98,session_id:_0x502364,version:_0x1b715c,id:_0x228776,authorization:_0x372f48,mjProxy:_0x263552}=await this[_0x3d47b6(0x1f7)](),_0x52d57=_0x263552==0x1?_0x3d47b6(0x267):_0x3d47b6(0x27a),_0x4b2dd1={'authorization':_0x372f48},_0x365b43={'type':0x3,'guild_id':_0x24c925,'channel_id':_0x58de98,'message_flags':0x0,'message_id':_0x28ec16,'application_id':_0x5948ac,'session_id':_0x502364,'data':{'component_type':0x2,'custom_id':_0x16e37e}};try{await axios_1[_0x3d47b6(0x1fe)][_0x3d47b6(0x1d9)](_0x52d57,_0x365b43,{'headers':_0x4b2dd1}),console[_0x75bfae(0x13d)](_0x75bfae(0x19c));}catch(_0x99d37f){console[_0x3d47b6(0x260)](_0x3d47b6(0x1fb),_0x99d37f);throw new common_1[(_0x3d47b6(0x1ea))](_0x3d47b6(0x23a),common_1[_0x3d47b6(0x212)][_0x3d47b6(0x209)]);}}async[_0x2ce8cf(0x216)](_0x25d8cf,_0x13fc67){const _0x5b2ae2=_0x468ac4,_0x4f9e53=_0x2ce8cf,{message_id:_0x3a4cc9,custom_id:_0x24f938,prompt:_0x7ea185,orderId:_0xeb82ce}=_0x25d8cf;let _0x156e78=null,_0x144bd4=0x0;while(!_0x156e78&&_0x144bd4<0xa){try{const _0x455e5f=Date[_0x4f9e53(0x27b)](),_0x183083=await this[_0x4f9e53(0x273)]();console[_0x5b2ae2(0x13d)]('第\x20'+(_0x144bd4+0x1)+_0x4f9e53(0x246)+_0x183083[_0x4f9e53(0x1d6)]),_0x183083&&_0x183083[_0x4f9e53(0x1d6)]&&(_0x156e78=await this[_0x4f9e53(0x1d3)](_0x183083,_0x25d8cf,_0x13fc67));const _0x4e9bac=Date[_0x4f9e53(0x27b)]()-_0x455e5f,_0x7a4aa8=0xbb8;await this[_0x4f9e53(0x256)](Math[_0x4f9e53(0x250)](_0x7a4aa8-_0x4e9bac,0x0)),_0x144bd4++;}catch(_0x134f85){console[_0x4f9e53(0x281)](_0x4f9e53(0x239)+_0x134f85[_0x4f9e53(0x279)]);}}return _0x156e78;}async[_0x2ce8cf(0x1e2)](_0x41075d,_0x49ca4c){const _0xfb6224=_0x468ac4,_0x497a8a=_0x2ce8cf,{message_id:_0x4846a6,custom_id:_0x3b566a,prompt:_0x5a4926,orderId:_0xa69580}=_0x41075d;console[_0xfb6224(0x13d)](_0x497a8a(0x1d5));let _0x3e817d=null,_0x2af878=0x0;while(!_0x3e817d&&_0x2af878<0xa){try{console[_0xfb6224(0x13d)]('第\x20'+(_0x2af878+0x1)+_0x497a8a(0x1e0));const _0x1eff57=Date[_0x497a8a(0x27b)](),_0x46ed44=await this[_0x497a8a(0x273)]();_0x46ed44&&_0x46ed44[_0x497a8a(0x1d6)]&&(_0x3e817d=await this[_0x497a8a(0x263)](_0x46ed44,_0x41075d,_0x49ca4c));const _0x4b730a=Date[_0x497a8a(0x27b)]()-_0x1eff57,_0x26edbf=0x1f40;await this[_0xfb6224(0x187)](Math[_0x497a8a(0x250)](_0x26edbf-_0x4b730a,0x0)),_0x2af878++;}catch(_0x162375){console[_0xfb6224(0x19d)](_0x497a8a(0x239)+_0x162375[_0x497a8a(0x279)]);}}if(!_0x3e817d)throw new common_1[(_0xfb6224(0x15d))](_0x497a8a(0x230),common_1[_0x497a8a(0x212)][_0xfb6224(0x133)]);return _0x3e817d;}async[_0x2ce8cf(0x1d3)](_0x518401,_0x229ba4,_0x1df980){const _0x3dc15c=_0x468ac4,_0x108817=_0x2ce8cf,{message_id:_0x41190a,custom_id:_0x555188,prompt:_0x4b83f8,orderId:_0x160f05}=_0x229ba4,_0xfc0beb=_0x4b83f8[_0x108817(0x1eb)](0x0,0xc);console[_0x108817(0x260)](_0x108817(0x1cf),_0xfc0beb);const _0x5a9e29=_0x518401[_0x3dc15c(0x1b1)](_0x59e5d2=>{const _0x3f7e27=_0x3dc15c,_0x3fec56=_0x108817,{content:_0x576d88}=_0x59e5d2;if(!this[_0x3fec56(0x22b)](_0x576d88))return![];const {prompt:_0x36aec4,order:_0x3616ff}=this[_0x3fec56(0x22b)](_0x576d88);return _0x36aec4[_0x3f7e27(0x1da)](_0xfc0beb)&&_0x229ba4[_0x3fec56(0x234)]===_0x3616ff&&!_0x1df980[_0x3fec56(0x254)](_0x59e5d2['id']);});return _0x5a9e29;}async[_0x2ce8cf(0x263)](_0x107ea1,_0xc6a82c,_0x5224e5){const _0xb4041f=_0x2ce8cf,{message_id:_0x528b56,custom_id:_0x172c24,prompt:_0x17842d,orderId:_0x59a52e}=_0xc6a82c,_0xc52cbf=_0x17842d[_0xb4041f(0x1eb)](0x0,0xc),_0x5b080f=_0x107ea1['find'](_0x568a0a=>{const _0x18c559=_0x2cc0,_0x42956e=_0xb4041f,{content:_0x921081}=_0x568a0a,_0x1643a1=_0x921081['match'](/\*\*(.+?)\*\*/),_0xc788cc=_0x1643a1?_0x1643a1[0x1]:'';if(!_0xc788cc)return![];return _0xc788cc[_0x18c559(0x1da)](_0xc52cbf)&&!_0x5224e5[_0x42956e(0x254)](_0x568a0a['id']);});return _0x5b080f;}async['sendDrawInteractions'](_0x3de52e,_0x4ff866,_0x1d1898){const _0x2d4ba7=_0x468ac4,_0x5e56c9=_0x2ce8cf,_0x44b74a=await this[_0x5e56c9(0x273)](),_0x5f3083=await this[_0x5e56c9(0x280)](_0x44b74a,_0x1d1898,_0x4ff866);if(_0x5f3083)return console[_0x5e56c9(0x260)](_0x5e56c9(0x251),_0x5f3083),_0x5f3083;const {application_id:_0x383898,guild_id:_0x17a572,channel_id:_0x1ed58f,session_id:_0x438d46,version:_0xa9e0b,id:_0x5c3fae,authorization:_0x7c0bcc,mjProxy:_0x20432d}=await this[_0x2d4ba7(0x180)](),_0x29c88a={'type':0x2,'application_id':_0x383898,'guild_id':_0x17a572,'channel_id':_0x1ed58f,'session_id':_0x438d46,'data':{'version':_0xa9e0b,'id':_0x5c3fae,'name':_0x5e56c9(0x282),'type':0x1,'options':[{'type':0x3,'name':_0x5e56c9(0x21a),'value':_0x3de52e}],'attachments':[]}};try{const _0xd99d2e=_0x20432d==0x1?_0x5e56c9(0x267):'https://discord.com/api/v9/interactions',_0x4523aa={'authorization':_0x7c0bcc},_0x2f3cc2=await axios_1[_0x5e56c9(0x1fe)][_0x5e56c9(0x1d9)](_0xd99d2e,_0x29c88a,{'headers':_0x4523aa});return console[_0x2d4ba7(0x13d)](_0x5e56c9(0x213),_0x2f3cc2['data']),![];}catch(_0x355177){console[_0x5e56c9(0x260)](_0x5e56c9(0x26c),_0x355177);throw new common_1[(_0x5e56c9(0x1ea))](_0x5e56c9(0x276),common_1[_0x5e56c9(0x212)][_0x5e56c9(0x209)]);}}async[_0x2ce8cf(0x24a)](_0x45c2c3,_0x4fa536,_0x5a5567){const _0x1d16ad=_0x468ac4,_0x378691=_0x2ce8cf;console[_0x378691(0x260)](_0x378691(0x25b));const _0x37f852=Date[_0x378691(0x27b)]();try{const _0x1c84c8=0xd,_0x1b8752=0x2ee0,_0x405788=0x1388,_0x1d24e6=0x3c*0x3e8;let _0xc4c17f=0x0,_0x4f60d4=![],_0x191e65=null;while(!_0x191e65&&_0xc4c17f<_0x1c84c8){console[_0x378691(0x260)]('第\x20'+(_0xc4c17f+0x1)+_0x378691(0x244)),Date[_0x378691(0x27b)]()-_0x37f852>=_0x1d24e6&&(_0x4f60d4=!![]),await this[_0x378691(0x256)](_0x4f60d4?_0x405788:_0x1b8752);const _0x144ded=await this[_0x1d16ad(0x1ad)]();_0x191e65=await this['findCurrentPromptResult'](_0x144ded,_0x5a5567,_0x4fa536),_0xc4c17f++;}if(!_0x191e65)throw new common_1[(_0x378691(0x1ea))](_0x378691(0x20e),common_1[_0x378691(0x212)]['BAD_REQUEST']);const _0x41561e=Date[_0x378691(0x27b)]();return console[_0x1d16ad(0x13d)](_0x378691(0x1f8)+Math[_0x1d16ad(0x162)]((_0x41561e-_0x37f852)/0x3e8)+'\x20S'),_0x191e65;}catch(_0x1d5457){console[_0x378691(0x281)](_0x1d5457[_0x1d16ad(0x1c3)]);throw new common_1[(_0x378691(0x1ea))](_0x1d16ad(0x164),common_1[_0x1d16ad(0x1bc)][_0x378691(0x249)]);}}async[_0x468ac4(0x19f)](_0x371f54,_0x3123d1,_0x900a7e){const _0x442caf=_0x2ce8cf;if(!_0x371f54||!_0x371f54[_0x442caf(0x1d6)])return;console[_0x442caf(0x260)](_0x442caf(0x277),_0x3123d1);const _0x1042d8=_0x371f54[_0x442caf(0x1de)](_0x52974d=>{const _0xdcd6a1=_0x2cc0,_0x271dab=_0x442caf,{attachments:attachments=[],content:_0x42f047,edited_timestamp:_0x2594dc}=_0x52974d;return _0x42f047[_0x271dab(0x254)](_0x3123d1)&&attachments[_0x271dab(0x1d6)]>0x0&&!_0x2594dc&&!_0x900a7e[_0xdcd6a1(0x1da)](_0x52974d['id']);});return _0x1042d8||null;}async[_0x2ce8cf(0x273)](){const _0x8f9977=_0x468ac4,_0x2ae063=_0x2ce8cf;try{const {application_id:_0x26922a,guild_id:_0x170218,channel_id:_0x3efc3a,session_id:_0x5534af,version:_0xbec88d,id:_0x247439,authorization:_0x5df5f9,mjProxy:_0x3608c3}=await this[_0x8f9977(0x180)](),_0xba9fb1=_0x3608c3==0x1?'http://172.247.48.137:8000/mj/list?channel_id='+_0x3efc3a:_0x2ae063(0x23f)+_0x3efc3a+_0x2ae063(0x284),_0x1bf94c={'authorization':_0x5df5f9},_0x1bd7cc=await axios_1[_0x2ae063(0x1fe)][_0x2ae063(0x261)](_0xba9fb1,{'headers':_0x1bf94c});return _0x1bd7cc[_0x2ae063(0x253)];}catch(_0x125685){console[_0x2ae063(0x260)](_0x8f9977(0x14d),_0x125685);throw new common_1[(_0x2ae063(0x1ea))](_0x8f9977(0x168),common_1[_0x2ae063(0x212)][_0x8f9977(0x133)]);}}async[_0x2ce8cf(0x256)](_0xb2d2ae){return new Promise(_0x20f04b=>setTimeout(_0x20f04b,_0xb2d2ae));}[_0x468ac4(0x1d4)](_0x24b660){const _0xd07779=_0x2ce8cf,_0x4d28ea=_0x24b660[_0xd07779(0x26a)](/\*\*(.+?)\*\*/),_0x61b0de=_0x24b660[_0xd07779(0x26a)](/- Image #(\d+)/);if(!_0x4d28ea||!_0x61b0de)return null;const _0x36673e=_0x4d28ea[0x1],_0x31a805=parseInt(_0x61b0de[0x1]);return{'prompt':_0x36673e,'order':_0x31a805};}async[_0x2ce8cf(0x1f7)](){const _0x1dd8f3=_0x468ac4,_0x104126=_0x2ce8cf,_0x5d1053=await this[_0x104126(0x25a)][_0x104126(0x1ed)]([_0x104126(0x218),_0x104126(0x1f4),_0x104126(0x26f),_0x104126(0x211),_0x104126(0x259),'mjVersion',_0x104126(0x1ff),_0x1dd8f3(0x1d1),_0x104126(0x26b)]),_0x224aab={'application_id':_0x5d1053[_0x1dd8f3(0x1ba)],'guild_id':_0x5d1053[_0x1dd8f3(0x128)],'channel_id':_0x5d1053[_0x104126(0x211)],'session_id':_0x5d1053[_0x104126(0x259)],'version':_0x5d1053[_0x104126(0x245)],'id':_0x5d1053[_0x104126(0x218)],'authorization':_0x5d1053[_0x104126(0x1ff)],'mjRateLimit':_0x5d1053[_0x104126(0x1d7)],'mjProxy':_0x5d1053[_0x104126(0x26b)]||0x0};return _0x224aab;}[_0x468ac4(0x17d)](_0x445a86){const _0x2bb586=_0x2ce8cf,_0x4d3aa7=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;return _0x445a86[_0x2bb586(0x22a)](_0x4d3aa7,'');}async[_0x2ce8cf(0x202)](_0x243b33){const _0x4df165=_0x468ac4,_0x4de99a=_0x2ce8cf,_0x44764c=await this[_0x4de99a(0x283)]['findOne']({'where':{'userId':_0x243b33[_0x4de99a(0x27e)]['id']}}),{id:_0x18c8d3,balance:_0x4bf4f9}=_0x44764c;if(!_0x4bf4f9||(_0x44764c===null||_0x44764c===void 0x0?void 0x0:_0x44764c[_0x4de99a(0x1ee)])<0x1)throw new common_1[(_0x4de99a(0x1ea))](_0x4de99a(0x21f),common_1[_0x4de99a(0x212)][_0x4df165(0x133)]);}async[_0x2ce8cf(0x207)](_0x5f1f46){const _0x42474b=_0x468ac4,_0x502909=_0x2ce8cf,{id:_0x20f606,role:_0xb2d5fe}=_0x5f1f46[_0x502909(0x27e)];!this[_0x502909(0x269)][_0x20f606]?this[_0x42474b(0x1d9)][_0x20f606]=0x1:this[_0x502909(0x269)][_0x20f606]=this[_0x502909(0x269)][_0x20f606]+0x1,console[_0x502909(0x260)]('当前用户'+_0x20f606+_0x502909(0x24c),this[_0x502909(0x269)][_0x20f606]);}async[_0x2ce8cf(0x23b)](_0x1b68e3){const _0x1313c0=_0x468ac4,_0x3400e8=_0x2ce8cf,{id:_0x4a8fc5,role:_0x4dc671}=_0x1b68e3[_0x3400e8(0x27e)];if([_0x3400e8(0x1fd),_0x3400e8(0x1dd)][_0x1313c0(0x1da)](_0x4dc671))return!![];const {mjRateLimit:_0x40fb79}=await this[_0x1313c0(0x180)]();if(this[_0x3400e8(0x24d)][_0x4a8fc5]){const _0x4dc043=this[_0x3400e8(0x24d)][_0x4a8fc5];if(_0x4dc043>Date[_0x3400e8(0x27b)]()){console[_0x3400e8(0x260)](_0x3400e8(0x1ec)+_0x4a8fc5+_0x3400e8(0x201));throw new common_1[(_0x3400e8(0x1ea))](_0x1313c0(0x15b)+_0x40fb79+_0x3400e8(0x219),common_1[_0x1313c0(0x1bc)][_0x3400e8(0x209)]);}else this[_0x3400e8(0x24d)][_0x4a8fc5]=Date[_0x3400e8(0x27b)]()+Number(_0x40fb79)*0x3e8;}else{const _0x4cd425=Date[_0x3400e8(0x27b)]();this[_0x3400e8(0x24d)][_0x4a8fc5]=_0x4cd425+0x3e8*Number(_0x40fb79);}}async[_0x2ce8cf(0x270)](_0x2770fd){const _0x360273=_0x468ac4,_0x50f1f5=_0x2ce8cf;await this[_0x50f1f5(0x283)][_0x50f1f5(0x231)]()[_0x360273(0x199)](balance_entity_1[_0x50f1f5(0x21e)])[_0x360273(0x1b3)]({'balance':()=>_0x50f1f5(0x27d)})[_0x360273(0x1bf)](_0x50f1f5(0x1fa),{'userId':_0x2770fd[_0x50f1f5(0x27e)]['id']})[_0x50f1f5(0x24b)]();}async[_0x468ac4(0x1c5)](){return 0x1;}};function _0x2cc0(_0x1a329c,_0x3023e1){const _0x5586fd=_0x5586();return _0x2cc0=function(_0x2cc0cb,_0xdd1894){_0x2cc0cb=_0x2cc0cb-0x127;let _0x487358=_0x5586fd[_0x2cc0cb];return _0x487358;},_0x2cc0(_0x1a329c,_0x3023e1);}MjService=__decorate([(0x0,common_1[_0x2ce8cf(0x25d)])(),__param(0x0,(0x0,typeorm_2[_0x468ac4(0x13f)])(chatLog_entity_1[_0x2ce8cf(0x25e)])),__param(0x1,(0x0,typeorm_2[_0x2ce8cf(0x220)])(balance_entity_1[_0x2ce8cf(0x21e)])),__metadata(_0x2ce8cf(0x235),[typeorm_1[_0x2ce8cf(0x1f5)],typeorm_1[_0x2ce8cf(0x1f5)],upload_service_1[_0x2ce8cf(0x229)],chatLog_service_1[_0x2ce8cf(0x20c)],globalConfig_service_1[_0x2ce8cf(0x1d4)],fanyi_service_1[_0x2ce8cf(0x274)],badwords_service_1[_0x2ce8cf(0x208)]])],MjService),exports[_0x2ce8cf(0x26e)]=MjService;