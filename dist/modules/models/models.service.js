'use strict';const _0x2ef65e=_0xf84c;(function(_0x875906,_0x386748){const _0x19eb58=_0xf84c,_0x1f92e6=_0x875906();while(!![]){try{const _0x3958e6=parseInt(_0x19eb58(0xdb))/0x1+parseInt(_0x19eb58(0xf4))/0x2*(-parseInt(_0x19eb58(0xe4))/0x3)+-parseInt(_0x19eb58(0xc4))/0x4+-parseInt(_0x19eb58(0xb3))/0x5*(-parseInt(_0x19eb58(0xee))/0x6)+parseInt(_0x19eb58(0xe1))/0x7+parseInt(_0x19eb58(0x98))/0x8*(parseInt(_0x19eb58(0xcb))/0x9)+parseInt(_0x19eb58(0xa2))/0xa*(parseInt(_0x19eb58(0xd5))/0xb);if(_0x3958e6===_0x386748)break;else _0x1f92e6['push'](_0x1f92e6['shift']());}catch(_0x1e8c6b){_0x1f92e6['push'](_0x1f92e6['shift']());}}}(_0x1e44,0x3a50b));function _0xf84c(_0x170176,_0x36187c){const _0x1e4498=_0x1e44();return _0xf84c=function(_0xf84c0a,_0x5f3dd0){_0xf84c0a=_0xf84c0a-0x95;let _0x16d810=_0x1e4498[_0xf84c0a];return _0x16d810;},_0xf84c(_0x170176,_0x36187c);}function _0x1e44(){const _0x7ce0ff=['26541sFDDHu','initCalcKey','ModelsTypeEntity','stringify','key:\x20','4848344iMWyUC','execute','keyPoolIndexMap','279564iqqrkx','reduce','delModelType','push','metadata','当前未指定特殊模型KEY、前往后台模型池设置吧！','ModelsService','../../common/constants/status.constant','271970cVdbpd','@nestjs/common','modelsEntity','length','modelTypes','ModelsMapCn','BAD_REQUEST','Logger','keyStatus','HttpException','sort','Injectable','forEach','keyType','ModelsEntity','queryModels','status','1155252MpNBCB','set','queryModelType','@nestjs/typeorm','design:paramtypes','keys','modelName','3069ikpdNO','keyList','__decorate','find','keyPoolMap','createQueryBuilder','decorate','919420OIBZvH','secret','parse','22bDTbvf','Repository','key','731355uJUbfW','4121768wPeWon','Like','63755LbBEjn','val','__param','getAllKey','440YmrSXO','super','359443cvaiEA','ASC','map','93iHhayO','defineProperty','__esModule','user','当前账号不存在！','modelsList','getOwnPropertyDescriptor','function','./modelType.entity','lockKey','6zGTejb','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','HttpStatus','where','shift','394584PmRcQd','6238JAhVgl','modelOrder','model','useToken\x20+\x20','log','2152PVAkRJ','error:\x20','delModel','65JKOSeA','typeorm','save','缺失必要参数！','__metadata','InjectRepository','modelMaps','1815670NyYHIk'];_0x1e44=function(){return _0x7ce0ff;};return _0x1e44();}function _0x3212(){const _0x350546=_0xf84c,_0x33f6b2=[_0x350546(0xf1),_0x350546(0xa5),_0x350546(0xa3),_0x350546(0x9b),'hideString','modelsTypeEntity',_0x350546(0xb5),_0x350546(0xf3),_0x350546(0xdc),_0x350546(0xc6),_0x350546(0xf0),'当前调用模型已经被移除、请重新选择模型！',_0x350546(0xe0),_0x350546(0xb9),_0x350546(0xb4),'from','update','onModuleInit',_0x350546(0xca),'saveUseLog',_0x350546(0x9c),'modelMaps',_0x350546(0xdf),_0x350546(0xc1),_0x350546(0xd9),'2dVTeGc',_0x350546(0xcf),_0x350546(0xa6),_0x350546(0xce),_0x350546(0xd3),_0x350546(0xd6),_0x350546(0xaf),_0x350546(0xb1),_0x350546(0xbd),'findOne','../../common/utils','keyType',_0x350546(0xbb),_0x350546(0xb2),_0x350546(0xb6),_0x350546(0xa8),_0x350546(0xa7),_0x350546(0xd8),_0x350546(0xef),_0x350546(0xda),'error',_0x350546(0xaa),_0x350546(0xed),_0x350546(0xc9),_0x350546(0xeb),_0x350546(0x9e),_0x350546(0xe3),_0x350546(0xd2),_0x350546(0xb0),_0x350546(0x95),'values',_0x350546(0xab),'initCalcKey',_0x350546(0xdd),'HttpException',_0x350546(0x96),'findAndCount',_0x350546(0xd0),'keyList','useCount\x20+\x201','getBaseConfig','delete',_0x350546(0xc8),'affected','id\x20=\x20:id',_0x350546(0xbf),'getCurrentModelKeyInfo',_0x350546(0xd7),'object',_0x350546(0xac),_0x350546(0xae),_0x350546(0xcd),'save',_0x350546(0xe2),'getRandomDrawKey',_0x350546(0xb7),_0x350546(0xc5),_0x350546(0xe9),_0x350546(0xd4),_0x350546(0xec),_0x350546(0xe5),_0x350546(0xd1),_0x350546(0xc3),'getRandomItemFromArray',_0x350546(0x99),_0x350546(0x97),'parse\x20error:\x20',_0x350546(0xe6)];return _0x3212=function(){return _0x33f6b2;},_0x3212();}const _0x21e3d9=_0x1461;(function(_0x271bd5,_0x5a36ed){const _0x22d4ab=_0xf84c,_0x26cf1a=_0x1461,_0x47a0ac=_0x271bd5();while(!![]){try{const _0x52ede1=parseInt(_0x26cf1a(0x14b))/0x1+-parseInt(_0x26cf1a(0x15d))/0x2*(-parseInt(_0x26cf1a(0x111))/0x3)+parseInt(_0x26cf1a(0x11b))/0x4+parseInt(_0x26cf1a(0x147))/0x5*(parseInt(_0x26cf1a(0x11f))/0x6)+-parseInt(_0x26cf1a(0x15c))/0x7+-parseInt(_0x26cf1a(0x10f))/0x8+-parseInt(_0x26cf1a(0x146))/0x9*(-parseInt(_0x26cf1a(0x15a))/0xa);if(_0x52ede1===_0x5a36ed)break;else _0x47a0ac[_0x22d4ab(0xae)](_0x47a0ac[_0x22d4ab(0xf2)]());}catch(_0x3f759d){_0x47a0ac['push'](_0x47a0ac[_0x22d4ab(0xf2)]());}}}(_0x3212,0x63d03));var __decorate=this&&this[_0x21e3d9(0x133)]||function(_0xffec01,_0x35206a,_0x4092ec,_0x4f3393){const _0x31436b=_0xf84c,_0x302bcb=_0x21e3d9;var _0x2806c4=arguments[_0x31436b(0xb6)],_0x5de784=_0x2806c4<0x3?_0x35206a:_0x4f3393===null?_0x4f3393=Object[_0x31436b(0xea)](_0x35206a,_0x4092ec):_0x4f3393,_0x21f9bf;if(typeof Reflect===_0x302bcb(0x130)&&typeof Reflect[_0x31436b(0xd1)]===_0x302bcb(0x118))_0x5de784=Reflect[_0x302bcb(0x13d)](_0xffec01,_0x35206a,_0x4092ec,_0x4f3393);else{for(var _0x2dc6f0=_0xffec01[_0x31436b(0xb6)]-0x1;_0x2dc6f0>=0x0;_0x2dc6f0--)if(_0x21f9bf=_0xffec01[_0x2dc6f0])_0x5de784=(_0x2806c4<0x3?_0x21f9bf(_0x5de784):_0x2806c4>0x3?_0x21f9bf(_0x35206a,_0x4092ec,_0x5de784):_0x21f9bf(_0x35206a,_0x4092ec))||_0x5de784;}return _0x2806c4>0x3&&_0x5de784&&Object[_0x302bcb(0x13c)](_0x35206a,_0x4092ec,_0x5de784),_0x5de784;},__metadata=this&&this[_0x2ef65e(0x9f)]||function(_0x442ce6,_0x2d8ac0){const _0xc71688=_0x21e3d9;if(typeof Reflect===_0xc71688(0x130)&&typeof Reflect[_0xc71688(0x163)]===_0xc71688(0x118))return Reflect[_0xc71688(0x163)](_0x442ce6,_0x2d8ac0);},__param=this&&this[_0x21e3d9(0x121)]||function(_0x11d082,_0x1d53c4){return function(_0xc2a974,_0x3eff36){_0x1d53c4(_0xc2a974,_0x3eff36,_0x11d082);};};Object[_0x2ef65e(0xe5)](exports,_0x21e3d9(0x143),{'value':!![]}),exports[_0x21e3d9(0x164)]=void 0x0;const common_1=require(_0x21e3d9(0x152)),typeorm_1=require(_0x2ef65e(0xc7)),typeorm_2=require(_0x21e3d9(0x158)),models_entity_1=require('./models.entity'),status_constant_1=require(_0x21e3d9(0x16a)),utils_1=require(_0x21e3d9(0x167)),modelType_entity_1=require(_0x21e3d9(0x13b));let ModelsService=class ModelsService{constructor(_0x2d7819,_0x48e5a6){const _0x282333=_0x2ef65e,_0x3da089=_0x21e3d9;this[_0x3da089(0x14a)]=_0x2d7819,this[_0x3da089(0x149)]=_0x48e5a6,this[_0x282333(0xb7)]=[],this[_0x3da089(0x159)]={},this[_0x3da089(0x126)]={},this[_0x3da089(0x15e)]={},this[_0x3da089(0x115)]={};}async[_0x21e3d9(0x155)](){const _0x292577=_0x21e3d9;await this[_0x292577(0x120)]();}async[_0x21e3d9(0x120)](){const _0x42ba1c=_0x2ef65e,_0x10e234=_0x21e3d9;this[_0x10e234(0x15e)]={},this[_0x10e234(0x115)]={},this[_0x42ba1c(0xcc)]={},this[_0x10e234(0x159)]={},this[_0x10e234(0x137)]=[];const _0x3a8446=await this[_0x10e234(0x14a)][_0x10e234(0x160)]({'where':{'status':!![]}}),_0x3eff66=_0x3a8446[_0x10e234(0x131)]((_0x4ae5b,_0x66e0cc)=>{const _0x79a8bb=_0x42ba1c,_0x12a954=_0x10e234;return!_0x4ae5b[_0x66e0cc[_0x12a954(0x168)]]?_0x4ae5b[_0x66e0cc[_0x79a8bb(0xc0)]]=[_0x66e0cc]:_0x4ae5b[_0x66e0cc[_0x12a954(0x168)]][_0x12a954(0x132)](_0x66e0cc),_0x4ae5b;},{});this[_0x10e234(0x137)]=Object[_0x10e234(0x117)](_0x3eff66)[_0x10e234(0x11a)](_0x38332f=>{const _0x1b7191=_0x42ba1c;return{'label':status_constant_1[_0x1b7191(0xb8)][_0x38332f],'val':_0x38332f};}),this[_0x10e234(0x159)]=_0x3eff66,this[_0x42ba1c(0xcc)]={},_0x3a8446[_0x10e234(0x12d)](_0x54e467=>{const _0x21359c=_0x10e234,{keyType:_0x5ae398,model:_0x51e9d2,keyWeight:_0x36c558}=_0x54e467;if(!this[_0x21359c(0x15e)][_0x51e9d2])this['keyPoolMap'][_0x51e9d2]=[];for(let _0x104988=0x0;_0x104988<_0x36c558;_0x104988++){this[_0x21359c(0x15e)][_0x51e9d2][_0x21359c(0x132)](_0x54e467);}if(!this[_0x21359c(0x115)][_0x51e9d2])this['keyPoolIndexMap'][_0x51e9d2]=0x0;if(!this[_0x21359c(0x126)][_0x5ae398])this['keyList'][_0x5ae398]={};if(!this[_0x21359c(0x126)][_0x5ae398][_0x51e9d2])this[_0x21359c(0x126)][_0x5ae398][_0x51e9d2]=[];this[_0x21359c(0x126)][_0x5ae398][_0x51e9d2][_0x21359c(0x132)](_0x54e467);});}async[_0x21e3d9(0x116)](_0x3d1b7f,_0x8917b0,_0x554af9=-0x1){const _0x50d107=_0x2ef65e,_0x4ead8e=_0x21e3d9,_0x45bc00=await this[_0x4ead8e(0x14a)][_0x4ead8e(0x154)]({'id':_0x3d1b7f},{'status':![],'keyStatus':_0x554af9,'remark':_0x8917b0});common_1[_0x50d107(0xba)][_0x4ead8e(0x114)](_0x4ead8e(0x110)+_0x3d1b7f+_0x4ead8e(0x112)),this[_0x4ead8e(0x120)]();}async[_0x21e3d9(0x12e)](_0x1beea5){const _0x34fb78=_0x2ef65e,_0x50ae3b=_0x21e3d9;if(!this['keyPoolMap'][_0x1beea5])throw new common_1[(_0x34fb78(0xbc))](_0x50ae3b(0x14f),common_1[_0x34fb78(0xf0)][_0x34fb78(0xb9)]);this[_0x50ae3b(0x115)][_0x1beea5]++;const _0xb49722=this[_0x50ae3b(0x115)][_0x1beea5];if(_0xb49722>=this[_0x50ae3b(0x15e)][_0x1beea5][_0x50ae3b(0x16b)])this[_0x50ae3b(0x115)][_0x1beea5]=0x0;const _0x5b7bdc=this[_0x50ae3b(0x15e)][_0x1beea5][this[_0x50ae3b(0x115)][_0x1beea5]];return _0x5b7bdc;}async[_0x21e3d9(0x128)](_0x802554){const _0x3fabad=_0x2ef65e,_0xc3f56b=_0x21e3d9;if(!this[_0xc3f56b(0x137)][_0xc3f56b(0x16b)]||!Object[_0xc3f56b(0x117)](this[_0x3fabad(0xa1)])['length'])return;const _0x47df0e=_0x802554?this[_0xc3f56b(0x137)][_0x3fabad(0xce)](_0x59b01f=>Number(_0x59b01f[_0xc3f56b(0x14c)])===0x1):this[_0xc3f56b(0x137)][0x0];if(!_0x47df0e)return;const {keyType:_0x171beb,modelName:_0x509c21,model:_0x400c20,maxModelTokens:_0x184b28,maxResponseTokens:_0x1ad5f2,deductType:_0x571e38,deduct:_0x36151f,maxRounds:_0x5a5136}=this[_0xc3f56b(0x159)][_0x47df0e[_0xc3f56b(0x14c)]][0x0];return{'modelTypeInfo':_0x47df0e,'modelInfo':{'keyType':_0x171beb,'modelName':_0x509c21,'model':_0x400c20,'maxModelTokens':_0x184b28,'maxResponseTokens':_0x1ad5f2,'topN':0.8,'systemMessage':'','deductType':_0x571e38,'deduct':_0x36151f,'maxRounds':_0x5a5136,'rounds':0x8}};}async['setModel'](_0x5c72f2){const _0x146b5f=_0x2ef65e,_0x1f9498=_0x21e3d9;try{const {id:_0x27b482}=_0x5c72f2;_0x5c72f2[_0x1f9498(0x13e)]&&(_0x5c72f2[_0x1f9498(0x169)]=0x1);if(_0x27b482){const _0x454ff6=await this[_0x1f9498(0x14a)]['update']({'id':_0x27b482},_0x5c72f2);return await this[_0x146b5f(0xa4)](),_0x454ff6[_0x1f9498(0x12b)]>0x0;}else{const {keyType:_0x198455,key:_0x15fc99}=_0x5c72f2;if(Number(_0x198455!==0x1)){const _0x3d2419=await this[_0x1f9498(0x14a)][_0x146b5f(0x9d)](_0x5c72f2);return await this[_0x1f9498(0x120)](),_0x3d2419;}else{const _0x4da12f=_0x15fc99[_0x1f9498(0x11a)](_0x144463=>{const _0x6f2209=_0x1f9498;try{const _0x22ed22=JSON[_0x6f2209(0x13a)](JSON['stringify'](_0x5c72f2));return _0x22ed22[_0x6f2209(0x12f)]=_0x144463,_0x22ed22;}catch(_0x5cafaf){console[_0x6f2209(0x141)](_0x6f2209(0x142),_0x5cafaf);}}),_0x35dc4a=await this[_0x146b5f(0xb5)][_0x1f9498(0x134)](_0x4da12f);return await this[_0x146b5f(0xa4)](),_0x35dc4a;}}}catch(_0x4de104){console[_0x1f9498(0x141)](_0x1f9498(0x140),_0x4de104);}}async[_0x2ef65e(0x9a)]({id:_0xa61e0f}){const _0x427433=_0x2ef65e,_0x2465cd=_0x21e3d9;if(!_0xa61e0f)throw new common_1[(_0x427433(0xbc))](_0x2465cd(0x119),common_1[_0x2465cd(0x14e)][_0x2465cd(0x151)]);const _0x41a8cf=await this[_0x2465cd(0x14a)][_0x2465cd(0x166)]({'where':{'id':_0xa61e0f}});if(!_0x41a8cf)throw new common_1[(_0x2465cd(0x122))](_0x427433(0xe8),common_1[_0x2465cd(0x14e)][_0x427433(0xb9)]);const _0x580a10=await this[_0x2465cd(0x14a)][_0x2465cd(0x129)]({'id':_0xa61e0f});return await this[_0x2465cd(0x120)](),_0x580a10;}async[_0x2ef65e(0xc2)](_0x4ef890,_0x2eb506){const _0x12d871=_0x2ef65e,_0x4562f7=_0x21e3d9,{role:_0xaa3bc0}=_0x4ef890[_0x12d871(0xe7)],{keyType:_0xc5148b,key:_0x20792d,status:_0x4c2ca9,model:_0x241973,page:page=0x1,size:size=0xa}=_0x2eb506;let _0x434816={};_0xc5148b&&(_0x434816[_0x12d871(0xc0)]=_0xc5148b),_0x241973&&(_0x434816[_0x4562f7(0x11d)]=_0x241973),_0x4c2ca9&&(_0x434816[_0x4562f7(0x13e)]=Number(_0x4c2ca9)===0x1?!![]:![]),_0x20792d&&(_0x434816[_0x12d871(0xd7)]=(0x0,typeorm_2[_0x4562f7(0x113)])('%'+_0x20792d+'%'));const [_0x2b68d6,_0x537361]=await this[_0x4562f7(0x14a)][_0x4562f7(0x124)]({'where':_0x434816,'order':{'modelOrder':_0x4562f7(0x135)},'skip':(page-0x1)*size,'take':size});return _0xaa3bc0!==_0x4562f7(0x150)&&_0x2b68d6[_0x4562f7(0x12d)](_0x33f95d=>{const _0x54c05a=_0x12d871,_0x22132b=_0x4562f7;_0x33f95d[_0x22132b(0x12f)]&&(_0x33f95d[_0x22132b(0x12f)]=(0x0,utils_1[_0x22132b(0x148)])(_0x33f95d[_0x22132b(0x12f)])),_0x33f95d[_0x22132b(0x161)]&&(_0x33f95d[_0x22132b(0x161)]=(0x0,utils_1[_0x22132b(0x148)])(_0x33f95d[_0x54c05a(0xd3)]));}),{'rows':_0x2b68d6,'count':_0x537361};}async[_0x21e3d9(0x139)](){const _0x42b03a=_0x21e3d9,_0x2c091a=JSON[_0x42b03a(0x13a)](JSON[_0x42b03a(0x15f)](this[_0x42b03a(0x159)]));return Object[_0x42b03a(0x117)](_0x2c091a)[_0x42b03a(0x12d)](_0x51ef06=>{const _0xf8ea61=_0xf84c,_0x322d42=_0x42b03a;_0x2c091a[_0x51ef06]=_0x2c091a[_0x51ef06][_0x322d42(0x165)]((_0x17da30,_0x458fd8)=>_0x17da30[_0xf8ea61(0xf5)]-_0x458fd8[_0xf8ea61(0xf5)]),_0x2c091a[_0x51ef06]=Array[_0x322d42(0x153)](_0x2c091a[_0x51ef06][_0x322d42(0x11a)](_0x1bb8f9=>{const {modelName:_0x336d8a,model:_0x2cc2ce,deduct:_0x15ea02,deductType:_0x26a3f1,maxRounds:_0x4f5cb8}=_0x1bb8f9;return{'modelName':_0x336d8a,'model':_0x2cc2ce,'deduct':_0x15ea02,'deductType':_0x26a3f1,'maxRounds':_0x4f5cb8};})[_0x322d42(0x131)]((_0x37610a,_0x2c3d1f)=>_0x37610a[_0xf8ea61(0xc5)](_0x2c3d1f[_0x322d42(0x156)],_0x2c3d1f),new Map())[_0x322d42(0x11e)]());}),{'modelTypeList':this[_0x42b03a(0x137)],'modelMaps':_0x2c091a};}async[_0x21e3d9(0x157)](_0x65212,_0x4f323e){const _0x41c284=_0x2ef65e,_0x468fd1=_0x21e3d9;await this[_0x41c284(0xb5)][_0x468fd1(0x125)]()[_0x468fd1(0x154)](models_entity_1[_0x468fd1(0x15b)])[_0x468fd1(0x138)]({'useCount':()=>_0x468fd1(0x127),'useToken':()=>_0x468fd1(0x123)+_0x4f323e})[_0x468fd1(0x144)](_0x468fd1(0x12c),{'id':_0x65212})[_0x41c284(0xa9)]();}async[_0x21e3d9(0x136)](){const _0x482109=_0x21e3d9,_0x4941d5=await this[_0x482109(0x14a)][_0x482109(0x160)]({'where':{'isDraw':!![],'status':!![]}});if(!_0x4941d5[_0x482109(0x16b)])throw new common_1[(_0x482109(0x122))](_0x482109(0x11c),common_1[_0x482109(0x14e)][_0x482109(0x151)]);return(0x0,utils_1[_0x482109(0x13f)])(_0x4941d5);}async[_0x2ef65e(0xde)](){const _0x201d12=_0x21e3d9;return await this[_0x201d12(0x14a)][_0x201d12(0x160)]();}async[_0x21e3d9(0x14d)](_0x2271f7){return 0x1;}async['setModelType'](_0x55822a){return 0x1;}async[_0x2ef65e(0xad)](_0x338dd5){return 0x1;}};function _0x1461(_0x2b6035,_0x53b8b0){const _0x55e527=_0x3212();return _0x1461=function(_0x4cc62f,_0x6b0019){_0x4cc62f=_0x4cc62f-0x10f;let _0x32c71a=_0x55e527[_0x4cc62f];return _0x32c71a;},_0x1461(_0x2b6035,_0x53b8b0);}ModelsService=__decorate([(0x0,common_1[_0x2ef65e(0xbe)])(),__param(0x0,(0x0,typeorm_1[_0x2ef65e(0xa0)])(models_entity_1[_0x21e3d9(0x15b)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(modelType_entity_1[_0x21e3d9(0x145)])),__metadata(_0x21e3d9(0x12a),[typeorm_2[_0x2ef65e(0xd6)],typeorm_2[_0x21e3d9(0x162)]])],ModelsService),exports[_0x21e3d9(0x164)]=ModelsService;