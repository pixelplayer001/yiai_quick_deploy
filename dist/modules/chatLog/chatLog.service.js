'use strict';const _0x5c1b6b=_0x54f5;function _0x54f5(_0x4782d4,_0x5c5f3a){const _0x5f5db0=_0x5f5d();return _0x54f5=function(_0x54f5bf,_0x5a8bd7){_0x54f5bf=_0x54f5bf-0xd7;let _0x459067=_0x5f5db0[_0x54f5bf];return _0x459067;},_0x54f5(_0x4782d4,_0x5c5f3a);}(function(_0x22f064,_0xea8a08){const _0x2bca89=_0x54f5,_0x2156d8=_0x22f064();while(!![]){try{const _0x2bad09=-parseInt(_0x2bca89(0xdf))/0x1*(-parseInt(_0x2bca89(0x125))/0x2)+parseInt(_0x2bca89(0x14e))/0x3+-parseInt(_0x2bca89(0x112))/0x4+-parseInt(_0x2bca89(0xe4))/0x5+parseInt(_0x2bca89(0xd8))/0x6*(parseInt(_0x2bca89(0xf7))/0x7)+-parseInt(_0x2bca89(0xf8))/0x8*(-parseInt(_0x2bca89(0x11a))/0x9)+-parseInt(_0x2bca89(0x10c))/0xa*(-parseInt(_0x2bca89(0xf2))/0xb);if(_0x2bad09===_0xea8a08)break;else _0x2156d8['push'](_0x2156d8['shift']());}catch(_0x3f8f2b){_0x2156d8['push'](_0x2156d8['shift']());}}}(_0x5f5d,0xd0e37));function _0x2632(_0x35ea04,_0x5276fc){const _0x28cfd4=_0x4b16();return _0x2632=function(_0x4ba960,_0x5c7088){_0x4ba960=_0x4ba960-0x1ce;let _0x1641f3=_0x28cfd4[_0x4ba960];return _0x1641f3;},_0x2632(_0x35ea04,_0x5276fc);}function _0x5f5d(){const _0x54ec00=['maskEmail','Workbook','thumbImg','回答答案','Content-Disposition','172lzRlIC','function','2702132vEhkmq','forEach','chatList','attachment;\x20filename=','length','3567465PXazvr','DALL-E2','__esModule','InjectRepository','Not','HttpStatus','recDrawImg','1545960gqLmjd','object','DESC','assign','@nine.com','querAllChatLog','chatLogEntity','createdAt','24906629rezCqd','3131841XDiMDs','提问问题','8tvyGrM','isGroup','6102UKikcW','byAppId','dall-e-3','10xbBtaA','type','defineProperty','design:paramtypes','20iGxTFR','14991xLRjIZ','super','affected','用户邮箱','6686190aYGZQR','fileInfo','tencent','../../common/constants/balance.constant','userEntity','parse','1354512LzHzos','save','提问时间','username','@nestjs/typeorm','chatGroupEntity','formatDate','/q/55','6566241gwafvk','write','1341923uhpPAg','./chatLog.entity','48674ffSgzx','6657TSHQdX','232LRcJTd','exceljs','CHAT_TYPE','5sOelPl','user','删除对话记录成功！','?imageView2/1/w/','../../common/utils','addRow','getOwnPropertyDescriptor','extend','saveChatLog','rec','default','addWorksheet','你操作的图片不存在、请检查！','push','querAllDrawLog','typeorm','BAD_REQUEST','10rgpiki','当前页面已经没有东西可以删除了！','Repository','HttpException','count','12NLfTvL','2913716nufOSc','setHeader','end','decorate','图片成功！','305761klMwFa','update','group','74349mTZCar','findOne','includes','map','cos','find','__metadata','paintCount','624288iJgZNP','prompt','userId','7366EBlHTC','20KMtine','取消推荐','1202040GvrfAK','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','../user/user.entity','querAllDrawLog\x20Json\x20parse\x20error','delByGroupId','PAINT_TYPE','shift','xlsx','answer','querDrawLog'];_0x5f5d=function(){return _0x54ec00;};return _0x5f5d();}const _0x1ccf39=_0x2632;(function(_0x2312d8,_0x30ab0e){const _0x1b8641=_0x54f5,_0x8ac82b=_0x2632,_0xd60bd5=_0x2312d8();while(!![]){try{const _0x29ecf4=-parseInt(_0x8ac82b(0x1e7))/0x1+parseInt(_0x8ac82b(0x1d2))/0x2*(-parseInt(_0x8ac82b(0x228))/0x3)+-parseInt(_0x8ac82b(0x1da))/0x4*(parseInt(_0x8ac82b(0x1fb))/0x5)+-parseInt(_0x8ac82b(0x21c))/0x6+-parseInt(_0x8ac82b(0x1f1))/0x7+-parseInt(_0x8ac82b(0x1df))/0x8*(parseInt(_0x8ac82b(0x1f3))/0x9)+parseInt(_0x8ac82b(0x240))/0xa*(parseInt(_0x8ac82b(0x221))/0xb);if(_0x29ecf4===_0x30ab0e)break;else _0xd60bd5[_0x1b8641(0x108)](_0xd60bd5[_0x1b8641(0x12e)]());}catch(_0x2fa591){_0xd60bd5['push'](_0xd60bd5[_0x1b8641(0x12e)]());}}}(_0x4b16,0x632ca));const _0x54c5a9=_0x2414;(function(_0x20cb0a,_0xc9d2e4){const _0x56ba14=_0x54f5,_0x2d8237=_0x2632,_0x46bb18=_0x2414,_0x137198=_0x20cb0a();while(!![]){try{const _0x304cab=-parseInt(_0x46bb18(0x151))/0x1*(parseInt(_0x46bb18(0x12e))/0x2)+parseInt(_0x46bb18(0x145))/0x3*(parseInt(_0x46bb18(0x142))/0x4)+parseInt(_0x46bb18(0x13f))/0x5*(-parseInt(_0x46bb18(0x107))/0x6)+-parseInt(_0x46bb18(0x120))/0x7+-parseInt(_0x46bb18(0xf1))/0x8*(parseInt(_0x46bb18(0x119))/0x9)+parseInt(_0x46bb18(0x111))/0xa+parseInt(_0x46bb18(0x134))/0xb;if(_0x304cab===_0xc9d2e4)break;else _0x137198[_0x2d8237(0x1fa)](_0x137198[_0x2d8237(0x214)]());}catch(_0xda10bb){_0x137198[_0x2d8237(0x1fa)](_0x137198[_0x56ba14(0x12e)]());}}}(_0x1db3,0x1e57a));var __decorate=this&&this[_0x1ccf39(0x237)]||function(_0x28e61c,_0x2b9002,_0x5a52e2,_0x119d7d){const _0x1c08e0=_0x54f5,_0x38d058=_0x1ccf39,_0x2a809c=_0x2414;var _0x40ebb0=arguments[_0x2a809c(0x12d)],_0x3c6253=_0x40ebb0<0x3?_0x2b9002:_0x119d7d===null?_0x119d7d=Object[_0x38d058(0x1ea)](_0x2b9002,_0x5a52e2):_0x119d7d,_0x5e6a03;if(typeof Reflect===_0x2a809c(0x143)&&typeof Reflect[_0x2a809c(0x136)]===_0x1c08e0(0x138))_0x3c6253=Reflect[_0x2a809c(0x136)](_0x28e61c,_0x2b9002,_0x5a52e2,_0x119d7d);else{for(var _0x5c5545=_0x28e61c[_0x2a809c(0x12d)]-0x1;_0x5c5545>=0x0;_0x5c5545--)if(_0x5e6a03=_0x28e61c[_0x5c5545])_0x3c6253=(_0x40ebb0<0x3?_0x5e6a03(_0x3c6253):_0x40ebb0>0x3?_0x5e6a03(_0x2b9002,_0x5a52e2,_0x3c6253):_0x5e6a03(_0x2b9002,_0x5a52e2))||_0x3c6253;}return _0x40ebb0>0x3&&_0x3c6253&&Object[_0x2a809c(0x100)](_0x2b9002,_0x5a52e2,_0x3c6253),_0x3c6253;},__metadata=this&&this[_0x54c5a9(0x125)]||function(_0x36b72f,_0x1ec08b){const _0x59801f=_0x1ccf39,_0x1c9e86=_0x54c5a9;if(typeof Reflect===_0x59801f(0x208)&&typeof Reflect[_0x1c9e86(0x110)]===_0x59801f(0x1e6))return Reflect[_0x1c9e86(0x110)](_0x36b72f,_0x1ec08b);},__param=this&&this[_0x54c5a9(0x10e)]||function(_0x1c96fc,_0x3bddf9){return function(_0x5e529c,_0x197f66){_0x3bddf9(_0x5e529c,_0x197f66,_0x1c96fc);};};Object[_0x54c5a9(0x100)](exports,_0x54c5a9(0x11b),{'value':!![]}),exports[_0x54c5a9(0xe8)]=void 0x0;function _0x4b16(){const _0x37571f=_0x54f5,_0x2a8e51=['?x-oss-process=image/resize,w_',_0x37571f(0x13a),_0x37571f(0x101),_0x37571f(0x129),_0x37571f(0xd7),_0x37571f(0x143),_0x37571f(0x122),_0x37571f(0x115),_0x37571f(0x14c),_0x37571f(0x128),_0x37571f(0x12d),_0x37571f(0x13e),_0x37571f(0xfa),_0x37571f(0xf0),_0x37571f(0x119),'你删除的对话记录不存在、请检查！',_0x37571f(0xe1),_0x37571f(0xe3),_0x37571f(0x108),_0x37571f(0xfb),_0x37571f(0x102),_0x37571f(0x110),_0x37571f(0x13b),'log',_0x37571f(0x148),_0x37571f(0xe5),_0x37571f(0x10f),_0x37571f(0xe6),_0x37571f(0xe8),_0x37571f(0xeb),_0x37571f(0x123),_0x37571f(0x105),_0x37571f(0x146),_0x37571f(0xda),'components',_0x37571f(0x12c),_0x37571f(0x132),_0x37571f(0x116),_0x37571f(0xec),_0x37571f(0x11e),'ChatLogService','__param',_0x37571f(0x12b),_0x37571f(0xde),'shift',_0x37571f(0x13f),_0x37571f(0x12a),'role',_0x37571f(0x118),'ali','assistant',_0x37571f(0x13d),'759888oECgqn',_0x37571f(0x106),_0x37571f(0x11b),_0x37571f(0x10b),_0x37571f(0xf5),_0x37571f(0x14d),_0x37571f(0x135),_0x37571f(0xdd),'chatLogEntity',_0x37571f(0xff),'model','chat.xlsx','90987reOvul',_0x37571f(0x11f),'Content-Type',_0x37571f(0xef),'DeductionKey',_0x37571f(0xe9),'Injectable','columns',_0x37571f(0xed),'findAndCount',_0x37571f(0x147),_0x37571f(0x127),'你推荐的图片不存在、请检查！',_0x37571f(0x120),'deleteChatLog','__decorate',_0x37571f(0xea),_0x37571f(0xe2),_0x37571f(0x12f),_0x37571f(0x14a),_0x37571f(0xdc),'chatlog','@nestjs/common',_0x37571f(0xfd),_0x37571f(0xdb),'Like',_0x37571f(0xf4),_0x37571f(0xe7),_0x37571f(0x11d),_0x37571f(0x111),_0x37571f(0xd9),'email',_0x37571f(0xe0),_0x37571f(0xf6),_0x37571f(0x140),'16998fZCvqG',_0x37571f(0xfc),_0x37571f(0x139),_0x37571f(0x13c),_0x37571f(0x121),_0x37571f(0x11c),_0x37571f(0x104),_0x37571f(0x150),_0x37571f(0x113),_0x37571f(0x100),_0x37571f(0x10e),_0x37571f(0x142),_0x37571f(0x124),_0x37571f(0x10a),_0x37571f(0x138),_0x37571f(0x117)];return _0x4b16=function(){return _0x2a8e51;},_0x4b16();}function _0x2414(_0x5aea9f,_0x1eb814){const _0x1d238a=_0x1db3();return _0x2414=function(_0x548d1c,_0x265750){_0x548d1c=_0x548d1c-0xe7;let _0xa03d9=_0x1d238a[_0x548d1c];return _0xa03d9;},_0x2414(_0x5aea9f,_0x1eb814);}const common_1=require(_0x54c5a9(0xe7)),typeorm_1=require(_0x5c1b6b(0xee)),chatLog_entity_1=require(_0x54c5a9(0x123)),typeorm_2=require(_0x54c5a9(0x117)),balance_constant_1=require(_0x54c5a9(0x112)),user_entity_1=require(_0x54c5a9(0xec)),utils_1=require(_0x1ccf39(0x225)),exceljs_1=require(_0x54c5a9(0x127)),chatGroup_entity_1=require(_0x54c5a9(0xf2));let ChatLogService=class ChatLogService{constructor(_0xd25a99,_0x504e55,_0x1f6f99){const _0x31cf1d=_0x1ccf39,_0x2b6b5b=_0x54c5a9;this[_0x31cf1d(0x224)]=_0xd25a99,this[_0x2b6b5b(0x13b)]=_0x504e55,this[_0x2b6b5b(0x13c)]=_0x1f6f99;}async[_0x54c5a9(0x13e)](_0x46f7f0){const _0x2a703a=_0x54c5a9;return await this[_0x2a703a(0x118)][_0x2a703a(0x12a)](_0x46f7f0);}async[_0x54c5a9(0x13d)](_0x5e1f8f,_0x560b05){const _0x437855=_0x1ccf39,_0x4fd5c2=_0x54c5a9,{id:_0x1847a1}=_0x5e1f8f['user'],{model:_0x1fa2df}=_0x560b05,_0x2fc4c8={'userId':_0x1847a1,'type':balance_constant_1[_0x4fd5c2(0xed)][_0x4fd5c2(0x147)]};_0x1fa2df&&(_0x2fc4c8[_0x4fd5c2(0x103)]=_0x1fa2df,_0x1fa2df===_0x4fd5c2(0x156)&&(_0x2fc4c8[_0x4fd5c2(0x103)]=(0x0,typeorm_2['In'])([_0x4fd5c2(0x156),_0x4fd5c2(0xf0)])));const _0x1a64a0=await this[_0x4fd5c2(0x118)][_0x437855(0x229)]({'where':_0x2fc4c8,'order':{'id':_0x4fd5c2(0x124)},'select':['id',_0x4fd5c2(0x121),_0x4fd5c2(0x131),_0x4fd5c2(0x10b),_0x437855(0x1f6),_0x4fd5c2(0x103),_0x437855(0x1fc),_0x437855(0x23c),_0x437855(0x201)]});return _0x1a64a0[_0x4fd5c2(0xfb)](_0x3e8b49=>{const _0x8e5c13=_0x54f5,_0x45fbb5=_0x437855,_0x4814d1=_0x4fd5c2;if(_0x3e8b49[_0x4814d1(0x113)]===_0x45fbb5(0x1dc)){const _0x1706c7=_0x3e8b49[_0x45fbb5(0x226)]==='mj'?0x136:0xa0,_0x319676=_0x3e8b49[_0x4814d1(0x121)][_0x4814d1(0x14c)](_0x4814d1(0xf5))?_0x8e5c13(0xe6):_0x45fbb5(0x219),_0x2d585d=_0x319676===_0x4814d1(0x12f)?_0x4814d1(0x109)+_0x1706c7+_0x4814d1(0x14e):_0x45fbb5(0x1e8)+_0x1706c7;_0x3e8b49[_0x4814d1(0x150)]=_0x3e8b49[_0x4814d1(0x121)]+_0x2d585d;try{_0x3e8b49[_0x4814d1(0x132)]=_0x3e8b49[_0x8e5c13(0xe5)]?JSON[_0x4814d1(0xff)](_0x3e8b49[_0x4814d1(0x132)]):null;}catch(_0x5ee6b7){_0x3e8b49[_0x4814d1(0x132)]={};}}}),_0x1a64a0;}async[_0x5c1b6b(0x109)](_0x2bd2b4){const _0x12142d=_0x1ccf39,_0x3ae40c=_0x54c5a9,{page:page=0x1,size:size=0x14,rec:_0x4a9a67,userId:_0x1ed3d4,model:_0x45e856}=_0x2bd2b4,_0x4f95cb={'type':balance_constant_1[_0x12142d(0x22c)][_0x12142d(0x1f2)],'prompt':(0x0,typeorm_2[_0x3ae40c(0xfc)])(''),'answer':(0x0,typeorm_2[_0x3ae40c(0xfc)])('')};_0x4a9a67&&Object[_0x3ae40c(0xfe)](_0x4f95cb,{'rec':_0x4a9a67}),_0x1ed3d4&&Object[_0x3ae40c(0xfe)](_0x4f95cb,{'userId':_0x1ed3d4}),_0x45e856&&(_0x4f95cb[_0x12142d(0x226)]=_0x45e856,_0x45e856===_0x3ae40c(0x156)&&(_0x4f95cb[_0x3ae40c(0x103)]=(0x0,typeorm_2['In'])([_0x3ae40c(0x156),_0x3ae40c(0xf0)])));const [_0x1703c4,_0x22bad6]=await this[_0x12142d(0x224)][_0x3ae40c(0xf8)]({'order':{'id':_0x12142d(0x232)},'skip':(page-0x1)*size,'take':size,'where':_0x4f95cb});return _0x1703c4[_0x3ae40c(0xfb)](_0x49efec=>{const _0x5557e7=_0x54f5,_0x4144a0=_0x12142d,_0x8f3be4=_0x3ae40c;var _0x3dc29d;if(_0x49efec[_0x8f3be4(0x113)]===_0x8f3be4(0x122)){const _0x590a85=_0x49efec[_0x8f3be4(0x103)]==='mj'?0x136:0xa0,_0x28ff0d=_0x49efec[_0x8f3be4(0x121)][_0x8f3be4(0x14c)](_0x4144a0(0x20f))?_0x4144a0(0x203):_0x8f3be4(0x153),_0x19404f=_0x28ff0d===_0x4144a0(0x203)?_0x5557e7(0xfe)+_0x590a85+_0x8f3be4(0x14e):_0x8f3be4(0x138)+_0x590a85;_0x49efec[_0x8f3be4(0x150)]=_0x49efec[_0x8f3be4(0x121)]+_0x19404f;try{const _0x4ad636=_0x49efec[_0x8f3be4(0x11c)]?JSON[_0x8f3be4(0xff)](_0x49efec[_0x8f3be4(0x11c)]):null;_0x4ad636&&(_0x4ad636?_0x49efec[_0x8f3be4(0xf6)]=((_0x3dc29d=_0x4ad636===null||_0x4ad636===void 0x0?void 0x0:_0x4ad636[_0x4144a0(0x20a)][0x0])===null||_0x3dc29d===void 0x0?void 0x0:_0x3dc29d[_0x8f3be4(0x13a)][_0x5557e7(0x13d)])===0x5:_0x49efec[_0x8f3be4(0xf6)]=![]);}catch(_0x53385c){console[_0x4144a0(0x1ff)](_0x8f3be4(0x14f),_0x53385c);}}}),{'rows':_0x1703c4,'count':_0x22bad6};}async[_0x54c5a9(0x155)](_0x26c509){const _0x2739d9=_0x5c1b6b,_0x2320de=_0x1ccf39,_0x364ca2=_0x54c5a9,{id:_0xa5149f}=_0x26c509,_0x2dc598=await this[_0x364ca2(0x118)][_0x364ca2(0x10a)]({'where':{'id':_0xa5149f,'type':balance_constant_1[_0x364ca2(0xed)][_0x364ca2(0x147)]}});if(!_0x2dc598)throw new common_1[(_0x364ca2(0x11a))](_0x364ca2(0x116),common_1[_0x364ca2(0x146)][_0x364ca2(0x133)]);const _0x1c693a=_0x2dc598[_0x364ca2(0x105)]===0x1?0x0:0x1,_0x135373=await this[_0x2739d9(0x14b)][_0x2320de(0x218)]({'id':_0xa5149f},{'rec':_0x1c693a});if(_0x135373[_0x364ca2(0x129)]>0x0)return(_0x1c693a?'推荐':_0x364ca2(0x141))+_0x364ca2(0x126);throw new common_1[(_0x364ca2(0x11a))](_0x364ca2(0x101),common_1[_0x364ca2(0x146)][_0x364ca2(0x133)]);}async['exportExcel'](_0x4ddfb0,_0x408044){const _0x1d7421=_0x5c1b6b,_0x4a24fc=_0x1ccf39,_0x2f3bc2=_0x54c5a9,_0x2e8c5f={'type':balance_constant_1[_0x2f3bc2(0xed)][_0x4a24fc(0x1f4)]},{page:page=0x1,size:size=0x1e,prompt:_0x522e45,email:_0x2b8b1a}=_0x4ddfb0;_0x522e45&&Object[_0x4a24fc(0x200)](_0x2e8c5f,{'prompt':(0x0,typeorm_2[_0x4a24fc(0x1ce)])('%'+_0x522e45+'%')});if(_0x2b8b1a){const _0x109210=await this[_0x2f3bc2(0x13b)][_0x2f3bc2(0x10a)]({'where':{'email':_0x2b8b1a}});(_0x109210===null||_0x109210===void 0x0?void 0x0:_0x109210['id'])&&Object[_0x2f3bc2(0xfe)](_0x2e8c5f,{'userId':_0x109210['id']});}const [_0x4868ed,_0x59e465]=await this[_0x4a24fc(0x224)][_0x2f3bc2(0xf8)]({'order':{'id':_0x2f3bc2(0x124)},'skip':(page-0x1)*size,'take':size,'where':_0x2e8c5f}),_0x335ea0=_0x4868ed[_0x2f3bc2(0x149)](_0x14b5e2=>_0x14b5e2[_0x2f3bc2(0xee)]),_0x61b096=await this[_0x2f3bc2(0x13b)][_0x4a24fc(0x229)]({'where':{'id':(0x0,typeorm_2['In'])(_0x335ea0)}}),_0x33ff9e=_0x4868ed[_0x2f3bc2(0x149)](_0xe746c=>{const _0x345ad0=_0x4a24fc,_0x4e5834=_0x2f3bc2,_0x346dec=_0x61b096[_0x4e5834(0x108)](_0x458ec2=>_0x458ec2['id']===_0xe746c[_0x4e5834(0xee)]);return{'username':_0x346dec?_0x346dec[_0x4e5834(0x128)]:'','email':_0x346dec?_0x346dec[_0x345ad0(0x1d4)]:'','prompt':_0xe746c[_0x4e5834(0x131)],'answer':_0xe746c[_0x4e5834(0x121)],'createdAt':(0x0,utils_1[_0x345ad0(0x1f5)])(_0xe746c[_0x4e5834(0x115)])};}),_0x555ada=new exceljs_1[(_0x4a24fc(0x207))][(_0x2f3bc2(0xfa))](),_0x3fa219=_0x555ada[_0x2f3bc2(0xf7)](_0x4a24fc(0x23d));_0x3fa219[_0x2f3bc2(0x148)]=[{'header':_0x2f3bc2(0xfd),'key':_0x4a24fc(0x230),'width':0x14},{'header':_0x2f3bc2(0x144),'key':_0x2f3bc2(0x11e),'width':0x14},{'header':_0x2f3bc2(0xf4),'key':_0x2f3bc2(0x115),'width':0x14},{'header':_0x2f3bc2(0x130),'key':_0x2f3bc2(0x131),'width':0x50},{'header':_0x4a24fc(0x222),'key':_0x1d7421(0x130),'width':0x96}],_0x33ff9e[_0x4a24fc(0x1e9)](_0x25abc0=>_0x3fa219[_0x2f3bc2(0x135)](_0x25abc0)),_0x408044[_0x2f3bc2(0x10c)](_0x2f3bc2(0xea),_0x2f3bc2(0xeb)),_0x408044[_0x4a24fc(0x1e0)](_0x2f3bc2(0x12b),_0x4a24fc(0x1db)+_0x2f3bc2(0x10f)),await _0x555ada[_0x2f3bc2(0x14a)][_0x1d7421(0xf3)](_0x408044),_0x408044[_0x2f3bc2(0x12c)]();}async[_0x54c5a9(0xef)](_0xab83a3,_0x2daf9b){const _0xcc4435=_0x1ccf39,_0x9226dd=_0x54c5a9,{page:page=0x1,size:size=0x14,userId:_0x1934aa,prompt:_0x4bf5b0}=_0xab83a3,_0x76f06d={'type':balance_constant_1[_0x9226dd(0xed)][_0x9226dd(0x139)],'prompt':(0x0,typeorm_2[_0x9226dd(0xfc)])('')};_0x1934aa&&Object[_0x9226dd(0xfe)](_0x76f06d,{'userId':_0x1934aa}),_0x4bf5b0&&Object[_0x9226dd(0xfe)](_0x76f06d,{'prompt':(0x0,typeorm_2[_0x9226dd(0x106)])('%'+_0x4bf5b0+'%')});const [_0x4d4c83,_0x1cb544]=await this[_0x9226dd(0x118)][_0x9226dd(0xf8)]({'order':{'id':_0x9226dd(0x124)},'skip':(page-0x1)*size,'take':size,'where':_0x76f06d}),_0x2ea631=_0x4d4c83[_0x9226dd(0x149)](_0x459aa3=>_0x459aa3[_0x9226dd(0xee)]),_0x36e7f4=await this[_0x9226dd(0x13b)][_0x9226dd(0x108)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2ea631)},'select':['id',_0x9226dd(0x128),_0xcc4435(0x1d4)]});return _0x4d4c83[_0x9226dd(0xfb)](_0x3d739a=>{const _0x26d22e=_0xcc4435,_0x8cf53f=_0x9226dd,{username:_0x259d9,email:_0xcaf87a}=_0x36e7f4[_0x26d22e(0x229)](_0x36f7af=>_0x36f7af['id']===_0x3d739a[_0x8cf53f(0xee)])||{};_0x3d739a[_0x8cf53f(0x128)]=_0x259d9,_0x3d739a[_0x26d22e(0x1d4)]=_0xcaf87a;}),_0x2daf9b[_0xcc4435(0x1d9)][_0xcc4435(0x217)]!==_0x9226dd(0xe9)&&_0x4d4c83[_0x9226dd(0xfb)](_0x34c8b6=>_0x34c8b6[_0x9226dd(0x11e)]=(0x0,utils_1[_0xcc4435(0x20c)])(_0x34c8b6[_0x9226dd(0x11e)])),_0x4d4c83[_0x9226dd(0xfb)](_0x11ddeb=>{const _0x3fd988=_0xcc4435,_0x3cbbc1=_0x9226dd;!_0x11ddeb[_0x3fd988(0x1d4)]&&(_0x11ddeb[_0x3cbbc1(0x11e)]=(_0x11ddeb===null||_0x11ddeb===void 0x0?void 0x0:_0x11ddeb[_0x3cbbc1(0xee)])+_0x3cbbc1(0x104)),!_0x11ddeb[_0x3cbbc1(0x128)]&&(_0x11ddeb[_0x3cbbc1(0x128)]='游客'+(_0x11ddeb===null||_0x11ddeb===void 0x0?void 0x0:_0x11ddeb[_0x3cbbc1(0xee)]));}),{'rows':_0x4d4c83,'count':_0x1cb544};}async[_0x54c5a9(0x154)](_0x79ea6,_0x594bce){const _0x410af3=_0x1ccf39,_0x50a730=_0x54c5a9,{id:_0x5cd834}=_0x79ea6[_0x50a730(0x11d)],{groupId:_0x3d1597}=_0x594bce,_0x18bf6a={'userId':_0x5cd834,'isDelete':![]};_0x3d1597&&Object[_0x50a730(0xfe)](_0x18bf6a,{'groupId':_0x3d1597});if(_0x3d1597){const _0x261247=await this[_0x410af3(0x22b)][_0x50a730(0x152)]({'where':{'isDelete':![]}});if(_0x261247===0x0)return[];}const _0x4de2f7=await this[_0x50a730(0x118)][_0x50a730(0x108)]({'where':_0x18bf6a});return _0x4de2f7[_0x50a730(0x149)](_0x5e0248=>{const _0x2651ee=_0x410af3,_0x4fd8b9=_0x50a730,{prompt:_0x527514,role:_0x4bcb05,answer:_0x3ba308,createdAt:_0x2a4606,model:_0x297069,conversationOptions:_0x3b35b0,requestOptions:_0x2b30bd,id:_0x38ba1c,imageUrl:_0x2ee43e}=_0x5e0248;let _0x2afd29=null,_0x5ed88e=null;try{_0x2afd29=JSON[_0x4fd8b9(0xff)](_0x3b35b0),_0x5ed88e=JSON[_0x4fd8b9(0xff)](_0x2b30bd);}catch(_0x31a986){}return{'chatId':_0x38ba1c,'dateTime':(0x0,utils_1[_0x2651ee(0x1f5)])(_0x2a4606),'text':_0x4bcb05===_0x4fd8b9(0x11d)?_0x527514:_0x3ba308,'inversion':_0x4bcb05===_0x2651ee(0x1d9),'error':![],'conversationOptions':_0x2afd29,'requestOptions':_0x5ed88e,'imageUrl':_0x2ee43e,'model':_0x297069};});}async[_0x1ccf39(0x236)](_0x20f2cb,_0x1b09bb){const _0x23870d=_0x5c1b6b,_0x570542=_0x1ccf39,_0x1f6f28=_0x54c5a9,{id:_0x6e9759}=_0x20f2cb[_0x570542(0x1d9)],{id:_0x1ae222}=_0x1b09bb,_0x1873c0=await this[_0x570542(0x224)][_0x570542(0x21e)]({'where':{'id':_0x1ae222,'userId':_0x6e9759}});if(!_0x1873c0)throw new common_1[(_0x1f6f28(0x11a))](_0x1f6f28(0x114),common_1[_0x1f6f28(0x146)][_0x1f6f28(0x133)]);const _0x19b540=await this[_0x570542(0x224)][_0x1f6f28(0x14b)]({'id':_0x1ae222},{'isDelete':!![]});if(_0x19b540[_0x1f6f28(0x129)]>0x0)return _0x570542(0x23f);else throw new common_1[(_0x23870d(0x10f))](_0x570542(0x1f7),common_1[_0x1f6f28(0x146)][_0x1f6f28(0x133)]);}async[_0x1ccf39(0x20b)](_0x361087,_0x3c778d){const _0x353881=_0x5c1b6b,_0x90e58=_0x1ccf39,_0x50b91b=_0x54c5a9,{groupId:_0x2186ae}=_0x3c778d,{id:_0x352c0e}=_0x361087[_0x353881(0xfc)],_0x17afce=await this[_0x353881(0xef)][_0x90e58(0x21e)]({'where':{'id':_0x2186ae,'userId':_0x352c0e}});if(!_0x17afce)throw new common_1[(_0x50b91b(0x11a))](_0x90e58(0x1f7),common_1[_0x50b91b(0x146)][_0x90e58(0x21f)]);const _0x524fea=await this[_0x50b91b(0x118)][_0x50b91b(0x14b)]({'groupId':_0x2186ae},{'isDelete':!![]});if(_0x524fea[_0x90e58(0x239)]>0x0)return _0x50b91b(0x137);if(_0x524fea[_0x90e58(0x239)]===0x0)throw new common_1[(_0x90e58(0x202))](_0x50b91b(0xf3),common_1[_0x50b91b(0x146)][_0x50b91b(0x133)]);}async[_0x54c5a9(0x102)](_0x866614,_0x4a9e7e){const _0x10c60f=_0x1ccf39,_0x4d7a88=_0x54c5a9,{id:_0x52c4d6}=_0x866614[_0x4d7a88(0x11d)],{appId:_0x54b108,page:page=0x1,size:size=0xa}=_0x4a9e7e,[_0x17cf7e,_0x5815cd]=await this[_0x4d7a88(0x118)][_0x4d7a88(0xf8)]({'where':{'userId':_0x52c4d6,'appId':_0x54b108,'role':_0x10c60f(0x21a)},'order':{'id':_0x4d7a88(0x124)},'take':size,'skip':(page-0x1)*size});return{'rows':_0x17cf7e,'count':_0x5815cd};}};ChatLogService=__decorate([(0x0,common_1[_0x54c5a9(0xf9)])(),__param(0x0,(0x0,typeorm_1[_0x54c5a9(0x11f)])(chatLog_entity_1[_0x54c5a9(0x140)])),__param(0x1,(0x0,typeorm_1[_0x54c5a9(0x11f)])(user_entity_1['UserEntity'])),__param(0x2,(0x0,typeorm_1[_0x54c5a9(0x11f)])(chatGroup_entity_1['ChatGroupEntity'])),__metadata(_0x54c5a9(0x10d),[typeorm_2[_0x1ccf39(0x1e2)],typeorm_2[_0x54c5a9(0x14d)],typeorm_2[_0x54c5a9(0x14d)]])],ChatLogService),exports[_0x54c5a9(0xe8)]=ChatLogService;function _0x1db3(){const _0x5b4772=_0x5c1b6b,_0x7c7434=_0x1ccf39,_0x5c982a=[_0x7c7434(0x23f),_0x7c7434(0x1e8),_0x7c7434(0x1f4),_0x7c7434(0x20a),_0x7c7434(0x204),_0x7c7434(0x22b),_0x5b4772(0x131),_0x5b4772(0x103),_0x5b4772(0x126),'ChatLogEntity',_0x7c7434(0x233),_0x5b4772(0x137),_0x7c7434(0x208),_0x7c7434(0x1f9),_0x7c7434(0x1d5),_0x7c7434(0x1ed),'PAINT_TYPE',_0x7c7434(0x22f),_0x7c7434(0x1d1),_0x7c7434(0x23a),_0x5b4772(0x118),_0x7c7434(0x1dd),_0x7c7434(0x1e2),_0x5b4772(0xf1),_0x7c7434(0x212),_0x5b4772(0x134),'4MWvoZo',_0x7c7434(0x1fd),_0x7c7434(0x219),_0x7c7434(0x1fe),_0x5b4772(0x144),_0x7c7434(0x215),_0x7c7434(0x23e),_0x7c7434(0x210),_0x7c7434(0x1f8),_0x7c7434(0x22a),_0x7c7434(0x1eb),_0x7c7434(0x216),_0x7c7434(0x22c),_0x7c7434(0x1e4),_0x7c7434(0x23b),_0x7c7434(0x209),_0x7c7434(0x238),'../chatGroup/chatGroup.entity',_0x5b4772(0x10d),_0x7c7434(0x20e),_0x7c7434(0x20f),_0x7c7434(0x1ec),_0x7c7434(0x21d),_0x7c7434(0x231),_0x7c7434(0x22e),_0x5b4772(0x133),_0x7c7434(0x1e9),_0x7c7434(0x1e3),'用户名',_0x7c7434(0x200),_0x7c7434(0x22d),_0x7c7434(0x223),_0x5b4772(0x107),_0x7c7434(0x1d3),_0x7c7434(0x226),_0x5b4772(0x149),_0x7c7434(0x1de),_0x7c7434(0x1ce),_0x7c7434(0x1d8),_0x7c7434(0x229),_0x5b4772(0xfe),_0x5b4772(0x11b),'message_id',_0x7c7434(0x1e0),_0x7c7434(0x213),_0x7c7434(0x211),_0x7c7434(0x227),'metadata',_0x5b4772(0x145),_0x7c7434(0x1d0),_0x5b4772(0xdc),_0x7c7434(0x1f7),_0x7c7434(0x1f0),_0x7c7434(0x234),_0x7c7434(0x1e5),_0x7c7434(0x224),'9GIVIlq',_0x7c7434(0x202),_0x7c7434(0x1d7),_0x5b4772(0x102),_0x5b4772(0xfc),_0x7c7434(0x1d4),_0x5b4772(0x141),_0x7c7434(0x1ee),_0x5b4772(0x130),_0x7c7434(0x1dc),_0x7c7434(0x220),_0x7c7434(0x232),_0x7c7434(0x235),_0x7c7434(0x20d),_0x5b4772(0xf9),_0x7c7434(0x230),_0x7c7434(0x239),_0x7c7434(0x205),_0x5b4772(0x136),_0x5b4772(0x114),_0x7c7434(0x21b),_0x7c7434(0x1d6),_0x5b4772(0xe6),_0x5b4772(0x14f),_0x7c7434(0x206),_0x7c7434(0x201),_0x7c7434(0x21f),_0x7c7434(0x1cf),_0x7c7434(0x1e1),_0x7c7434(0x1ef)];return _0x1db3=function(){return _0x5c982a;},_0x1db3();}