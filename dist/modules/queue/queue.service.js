'use strict';const _0x38d1f7=_0x3efb;(function(_0xfaa704,_0xf3c49f){const _0x3f44eb=_0x3efb,_0x245a88=_0xfaa704();while(!![]){try{const _0x3a81ac=parseInt(_0x3f44eb(0xd9))/0x1+parseInt(_0x3f44eb(0xb5))/0x2+parseInt(_0x3f44eb(0xba))/0x3*(parseInt(_0x3f44eb(0xe7))/0x4)+-parseInt(_0x3f44eb(0xf4))/0x5*(parseInt(_0x3f44eb(0xd8))/0x6)+parseInt(_0x3f44eb(0xcc))/0x7+-parseInt(_0x3f44eb(0xf0))/0x8*(parseInt(_0x3f44eb(0xd7))/0x9)+parseInt(_0x3f44eb(0xb3))/0xa*(-parseInt(_0x3f44eb(0xdf))/0xb);if(_0x3a81ac===_0xf3c49f)break;else _0x245a88['push'](_0x245a88['shift']());}catch(_0x3b51da){_0x245a88['push'](_0x245a88['shift']());}}}(_0x31cd,0x1e640));function _0x3efb(_0x494075,_0x19656e){const _0x31cdd5=_0x31cd();return _0x3efb=function(_0x3efb2e,_0xe9759f){_0x3efb2e=_0x3efb2e-0xb2;let _0x4f9ad0=_0x31cdd5[_0x3efb2e];return _0x4f9ad0;},_0x3efb(_0x494075,_0x19656e);}const _0x572b44=_0x2ad5;function _0x31cd(){const _0x5bd9e4=['../midjourney/midjourney.service','mjTimeoutMs','2475571WIVmRB','object','userBalanceService','141335VmDUhA','design:paramtypes','../../common/utils','active','HttpException','UserBalanceService','checkLimit','validateBalance','globalConfigService','@nestjs/common','mjDrawQueue','12811284PavplU','1560020yEWAWY','function','__metadata','getOwnPropertyDescriptor','MidjourneyService','decorate','defineProperty','__param','shift','20gfXelh','clean','3411CsfBed','6PvgGsm','108604kqaLUJ','getDrawActionDetail','push','../userBalance/userBalance.service','GlobalConfigService','add','263989dRfZmn','MJDRAW','342QvhxuW','user','getConfigs','__decorate','159GrzORG','UPSCALE','4viZcGY','onApplicationBootstrap','372580IcVjLD','createRandomUid','metadata','getQueue','jobIds','HttpStatus','mjDraw','4048CavMZk','assign','QueueService','缺少必要参数！','194315PnDwvz','addDrawQueue','130OJJOIk','3314hUwvVh','345844Fiifti','731337wXIjhf','BAD_REQUEST','midjourneyService','24UhPDUe','488154NjtipM'];_0x31cd=function(){return _0x5bd9e4;};return _0x31cd();}function _0x2ad5(_0x6c7f0f,_0x4140c0){const _0x575069=_0x3f6c();return _0x2ad5=function(_0xa18c85,_0x13d09b){_0xa18c85=_0xa18c85-0x18e;let _0x919360=_0x575069[_0xa18c85];return _0x919360;},_0x2ad5(_0x6c7f0f,_0x4140c0);}(function(_0x319cb9,_0x3dcfca){const _0x3fc72a=_0x3efb,_0x34a15e=_0x2ad5,_0x5c2770=_0x319cb9();while(!![]){try{const _0xaa5f95=parseInt(_0x34a15e(0x1b3))/0x1+-parseInt(_0x34a15e(0x18f))/0x2*(-parseInt(_0x34a15e(0x1bb))/0x3)+-parseInt(_0x34a15e(0x1c3))/0x4*(parseInt(_0x34a15e(0x1aa))/0x5)+-parseInt(_0x34a15e(0x1ad))/0x6+parseInt(_0x34a15e(0x1be))/0x7*(parseInt(_0x34a15e(0x194))/0x8)+-parseInt(_0x34a15e(0x1a5))/0x9*(-parseInt(_0x34a15e(0x19e))/0xa)+parseInt(_0x34a15e(0x18e))/0xb*(-parseInt(_0x34a15e(0x1a3))/0xc);if(_0xaa5f95===_0x3dcfca)break;else _0x5c2770[_0x3fc72a(0xdb)](_0x5c2770['shift']());}catch(_0x3b86b3){_0x5c2770['push'](_0x5c2770[_0x3fc72a(0xd4)]());}}}(_0x3f6c,0xb02df));var __decorate=this&&this[_0x572b44(0x1c4)]||function(_0x3bd8f2,_0x53912b,_0x18d48d,_0x3fe521){const _0x36aea2=_0x3efb,_0x4d9932=_0x572b44;var _0x192549=arguments[_0x4d9932(0x1a6)],_0x3fe9e8=_0x192549<0x3?_0x53912b:_0x3fe521===null?_0x3fe521=Object[_0x4d9932(0x19c)](_0x53912b,_0x18d48d):_0x3fe521,_0x2b9746;if(typeof Reflect===_0x36aea2(0xbe)&&typeof Reflect[_0x4d9932(0x197)]===_0x4d9932(0x1a2))_0x3fe9e8=Reflect[_0x4d9932(0x197)](_0x3bd8f2,_0x53912b,_0x18d48d,_0x3fe521);else{for(var _0x587fee=_0x3bd8f2[_0x4d9932(0x1a6)]-0x1;_0x587fee>=0x0;_0x587fee--)if(_0x2b9746=_0x3bd8f2[_0x587fee])_0x3fe9e8=(_0x192549<0x3?_0x2b9746(_0x3fe9e8):_0x192549>0x3?_0x2b9746(_0x53912b,_0x18d48d,_0x3fe9e8):_0x2b9746(_0x53912b,_0x18d48d))||_0x3fe9e8;}return _0x192549>0x3&&_0x3fe9e8&&Object[_0x4d9932(0x1b6)](_0x53912b,_0x18d48d,_0x3fe9e8),_0x3fe9e8;},__metadata=this&&this[_0x38d1f7(0xce)]||function(_0x71c474,_0x1210fa){const _0x5eee4c=_0x38d1f7,_0x38b3aa=_0x572b44;if(typeof Reflect===_0x5eee4c(0xbe)&&typeof Reflect[_0x5eee4c(0xeb)]===_0x5eee4c(0xcd))return Reflect[_0x38b3aa(0x1c5)](_0x71c474,_0x1210fa);},__param=this&&this[_0x38d1f7(0xd3)]||function(_0x49217f,_0x4bd265){return function(_0x3107d0,_0x419e6a){_0x4bd265(_0x3107d0,_0x419e6a,_0x49217f);};};Object['defineProperty'](exports,_0x572b44(0x1a9),{'value':!![]}),exports[_0x572b44(0x1ae)]=void 0x0;const common_1=require(_0x572b44(0x1ba)),bull_1=require('@nestjs/bull'),utils_1=require(_0x572b44(0x19f)),midjourney_service_1=require(_0x572b44(0x1c0)),userBalance_service_1=require(_0x572b44(0x196)),globalConfig_service_1=require(_0x572b44(0x1b9));let QueueService=class QueueService{constructor(_0xdf3790,_0x356879,_0x534fa6,_0x581453){const _0x77e62=_0x38d1f7,_0x3eb305=_0x572b44;this[_0x3eb305(0x1bf)]=_0xdf3790,this[_0x3eb305(0x1c1)]=_0x356879,this[_0x77e62(0xbf)]=_0x534fa6,this[_0x77e62(0xc8)]=_0x581453,this[_0x77e62(0xed)]=[];}async[_0x572b44(0x1bd)](){const _0x59dbfc=_0x38d1f7,_0xd34450=_0x572b44;await this[_0xd34450(0x1bf)][_0xd34450(0x199)](0x0,_0x59dbfc(0xc3)),await this[_0xd34450(0x1c1)][_0xd34450(0x19b)]();}async[_0x572b44(0x1a4)](_0x1cbc09,_0x3b5512){const _0x2922a1=_0x38d1f7,_0x4ceb96=_0x572b44,{imgUrl:_0x4b766e,orderId:_0x19594a,action:_0x18ce49,drawId:_0x3cf88a}=_0x1cbc09;await this['midjourneyService'][_0x4ceb96(0x1ac)](_0x3b5512),await this[_0x4ceb96(0x1b5)][_0x4ceb96(0x1a7)](_0x3b5512,_0x4ceb96(0x193),_0x18ce49===_0x2922a1(0xe6)?0x1:0x4);if(_0x18ce49==='IMAGINE'){const _0x37e951=''+(0x0,utils_1[_0x2922a1(0xea)])(),_0x178fce=Object['assign'](Object[_0x4ceb96(0x1b0)]({},_0x1cbc09),{'userId':_0x3b5512[_0x4ceb96(0x1b1)]['id'],'randomDrawId':_0x37e951}),_0x2e5b88=await this[_0x4ceb96(0x1c1)][_0x4ceb96(0x1b7)](_0x178fce),_0x3f4b0c=await this[_0x4ceb96(0x192)][_0x2922a1(0xe3)]([_0x2922a1(0xbc)])||0x30d40,_0xd416f9=await this[_0x4ceb96(0x1bf)][_0x4ceb96(0x1b4)](_0x4ceb96(0x193),{'id':_0x2e5b88['id'],'action':_0x18ce49,'userId':_0x3b5512[_0x4ceb96(0x1b1)]['id']},{'delay':0x3e8,'timeout':+_0x3f4b0c});return this[_0x4ceb96(0x1c2)][_0x4ceb96(0x1a0)](_0xd416f9['id']),!![];}else{const {orderId:_0x26679f,action:_0x2de0f6,drawId:_0x518361}=_0x1cbc09,_0x844aea=await this[_0x4ceb96(0x1c1)][_0x4ceb96(0x1b2)](_0x2de0f6,_0x518361,_0x26679f),_0x54039b=Object[_0x4ceb96(0x1b0)](Object[_0x4ceb96(0x1b0)](Object[_0x4ceb96(0x1b0)]({},_0x1cbc09),{'userId':_0x3b5512[_0x4ceb96(0x1b1)]['id']}),_0x844aea),_0x408bda=await this[_0x4ceb96(0x1c1)][_0x4ceb96(0x1b7)](_0x54039b),_0x415102=await this[_0x4ceb96(0x192)][_0x4ceb96(0x1ab)]([_0x4ceb96(0x198)])||0x30d40,_0x281f24=await this[_0x4ceb96(0x1bf)][_0x4ceb96(0x1b4)](_0x4ceb96(0x193),{'id':_0x408bda['id'],'action':_0x2de0f6,'userId':_0x3b5512[_0x2922a1(0xe2)]['id']},{'delay':0x3e8,'timeout':+_0x415102});this[_0x4ceb96(0x1c2)][_0x4ceb96(0x1a0)](_0x281f24['id']);return;}if(!_0x3cf88a||!_0x19594a)throw new common_1[(_0x4ceb96(0x1af))](_0x2922a1(0xf3),common_1[_0x4ceb96(0x190)][_0x4ceb96(0x19d)]);}async[_0x572b44(0x19a)](){const _0x5a8f6b=_0x572b44;return{'jobIds':this[_0x5a8f6b(0x1c2)]};}};function _0x3f6c(){const _0x589390=_0x38d1f7,_0x38104c=[_0x589390(0xc0),_0x589390(0xe3),_0x589390(0xc6),'8192088awTdBv',_0x589390(0xf2),_0x589390(0xc4),_0x589390(0xf1),_0x589390(0xe2),_0x589390(0xda),_0x589390(0xb6),_0x589390(0xde),'userBalanceService',_0x589390(0xd2),_0x589390(0xb2),_0x589390(0xe0),'../globalConfig/globalConfig.service',_0x589390(0xc9),_0x589390(0xe5),'InjectQueue',_0x589390(0xe8),_0x589390(0xbd),_0x589390(0xca),_0x589390(0xbb),_0x589390(0xb8),_0x589390(0xed),_0x589390(0xd5),_0x589390(0xe4),_0x589390(0xeb),'11YdMEtv',_0x589390(0xb4),_0x589390(0xee),_0x589390(0xdd),_0x589390(0xc8),_0x589390(0xef),_0x589390(0xb9),_0x589390(0xc5),_0x589390(0xdc),_0x589390(0xd1),_0x589390(0xbc),_0x589390(0xd6),_0x589390(0xec),'cleanQueue',_0x589390(0xcf),_0x589390(0xb7),_0x589390(0xe9),_0x589390(0xc2),_0x589390(0xdb),_0x589390(0xd0),_0x589390(0xcd),_0x589390(0xcb),'addMjDrawQueue',_0x589390(0xe1),'length',_0x589390(0xc7),_0x589390(0xc1),'__esModule'];return _0x3f6c=function(){return _0x38104c;},_0x3f6c();}QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x572b44(0x1bc)])(_0x572b44(0x1b8))),__metadata(_0x572b44(0x1a8),[Object,midjourney_service_1[_0x572b44(0x1a1)],userBalance_service_1[_0x572b44(0x195)],globalConfig_service_1[_0x572b44(0x191)]])],QueueService),exports[_0x38d1f7(0xf2)]=QueueService;