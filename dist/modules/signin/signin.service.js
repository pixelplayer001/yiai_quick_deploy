'use strict';const _0x5b2f4d=_0x93d8;(function(_0x330464,_0x4e5356){const _0x7f4679=_0x93d8,_0xf5edd2=_0x330464();while(!![]){try{const _0x3186e7=parseInt(_0x7f4679(0x1e6))/0x1+-parseInt(_0x7f4679(0x1d3))/0x2*(parseInt(_0x7f4679(0x1c4))/0x3)+parseInt(_0x7f4679(0x1e3))/0x4*(parseInt(_0x7f4679(0x1de))/0x5)+parseInt(_0x7f4679(0x1dc))/0x6*(parseInt(_0x7f4679(0x1ce))/0x7)+parseInt(_0x7f4679(0x1ef))/0x8+-parseInt(_0x7f4679(0x1e4))/0x9+parseInt(_0x7f4679(0x1fa))/0xa*(-parseInt(_0x7f4679(0x1b4))/0xb);if(_0x3186e7===_0x4e5356)break;else _0xf5edd2['push'](_0xf5edd2['shift']());}catch(_0x513042){_0xf5edd2['push'](_0xf5edd2['shift']());}}}(_0x4340,0x94d5b));const _0x45b0c7=_0x25c6;function _0xe0a6(){const _0x5f3432=_0x93d8,_0xbb7a2c=['signin.userId\x20=\x20:userId','10682595pJxEyM',_0x5f3432(0x1c3),_0x5f3432(0x1d6),_0x5f3432(0x1f1),_0x5f3432(0x1fb),_0x5f3432(0x1e2),_0x5f3432(0x1b7),_0x5f3432(0x1c1),_0x5f3432(0x1cd),_0x5f3432(0x1f3),'今日已签到、改天再来吧!.',_0x5f3432(0x1ac),_0x5f3432(0x1d5),_0x5f3432(0x1ee),'createQueryBuilder',_0x5f3432(0x1dd),'用户不存在',_0x5f3432(0x1fd),_0x5f3432(0x1f2),_0x5f3432(0x1cc),_0x5f3432(0x1df),_0x5f3432(0x1d7),'8TEROge',_0x5f3432(0x1ad),_0x5f3432(0x1a5),_0x5f3432(0x1ca),_0x5f3432(0x1a8),_0x5f3432(0x1a6),_0x5f3432(0x1b2),_0x5f3432(0x1ab),_0x5f3432(0x1fe),'metadata','default',_0x5f3432(0x1f8),_0x5f3432(0x1fc),'Injectable',_0x5f3432(0x1b6),'signinEntity',_0x5f3432(0x1eb),_0x5f3432(0x1b9),_0x5f3432(0x1c6),'482484eUCNrr','5274996nAmsCU',_0x5f3432(0x1e1),'4575125rrLjka',_0x5f3432(0x1b1),_0x5f3432(0x1f6),_0x5f3432(0x1aa),'month','format',_0x5f3432(0x1be),_0x5f3432(0x1f9),_0x5f3432(0x1c0),_0x5f3432(0x1c5),_0x5f3432(0x1e0),_0x5f3432(0x1d1),_0x5f3432(0x1b8),_0x5f3432(0x1c7),_0x5f3432(0x1ae),_0x5f3432(0x1a4),_0x5f3432(0x1ed),_0x5f3432(0x1da),_0x5f3432(0x1a9),_0x5f3432(0x1db),_0x5f3432(0x1af),_0x5f3432(0x1e9),_0x5f3432(0x1d0),'5GdMsUu','YYYY-MM-DD','162786UVcaxt','debug',_0x5f3432(0x1e7),'10MMPPHC',_0x5f3432(0x1d9),'15065061yEgzQM',_0x5f3432(0x1d2),_0x5f3432(0x1c8),_0x5f3432(0x1a7),_0x5f3432(0x1c9),_0x5f3432(0x1f4),_0x5f3432(0x1ec),_0x5f3432(0x1bf),'find'];return _0xe0a6=function(){return _0xbb7a2c;},_0xe0a6();}(function(_0x3acfe7,_0x92783d){const _0x400603=_0x93d8,_0x5944ab=_0x25c6,_0x1aec4f=_0x3acfe7();while(!![]){try{const _0x3455f8=parseInt(_0x5944ab(0x18b))/0x1*(-parseInt(_0x5944ab(0x173))/0x2)+parseInt(_0x5944ab(0x176))/0x3+parseInt(_0x5944ab(0x18f))/0x4*(parseInt(_0x5944ab(0x190))/0x5)+-parseInt(_0x5944ab(0x192))/0x6*(parseInt(_0x5944ab(0x17a))/0x7)+parseInt(_0x5944ab(0x183))/0x8*(parseInt(_0x5944ab(0x1a8))/0x9)+parseInt(_0x5944ab(0x1ba))/0xa+-parseInt(_0x5944ab(0x197))/0xb*(parseInt(_0x5944ab(0x1b6))/0xc);if(_0x3455f8===_0x92783d)break;else _0x1aec4f['push'](_0x1aec4f[_0x400603(0x1fe)]());}catch(_0x35cf12){_0x1aec4f['push'](_0x1aec4f[_0x400603(0x1fe)]());}}}(_0xe0a6,0xb58eb));const _0x4f76cb=_0x195c;(function(_0x50964f,_0x586a52){const _0x48549e=_0x25c6,_0x439e89=_0x195c,_0x2208f2=_0x50964f();while(!![]){try{const _0x4c2c28=-parseInt(_0x439e89(0x169))/0x1*(-parseInt(_0x439e89(0x18f))/0x2)+parseInt(_0x439e89(0x17f))/0x3*(parseInt(_0x439e89(0x190))/0x4)+-parseInt(_0x439e89(0x188))/0x5+-parseInt(_0x439e89(0x17a))/0x6+-parseInt(_0x439e89(0x15f))/0x7*(-parseInt(_0x439e89(0x165))/0x8)+-parseInt(_0x439e89(0x143))/0x9*(parseInt(_0x439e89(0x16c))/0xa)+-parseInt(_0x439e89(0x160))/0xb*(parseInt(_0x439e89(0x16e))/0xc);if(_0x4c2c28===_0x586a52)break;else _0x2208f2[_0x48549e(0x1bc)](_0x2208f2[_0x48549e(0x1bf)]());}catch(_0x4b1869){_0x2208f2[_0x48549e(0x1bc)](_0x2208f2[_0x48549e(0x1bf)]());}}}(_0x3501,0xbf2e4));var __decorate=this&&this[_0x4f76cb(0x16d)]||function(_0x1d07ec,_0x51d0a3,_0x51f688,_0x48373e){const _0x520f8d=_0x25c6,_0x53158d=_0x4f76cb;var _0x847a53=arguments[_0x520f8d(0x178)],_0x3bab4c=_0x847a53<0x3?_0x51d0a3:_0x48373e===null?_0x48373e=Object[_0x53158d(0x16a)](_0x51d0a3,_0x51f688):_0x48373e,_0x3a38fa;if(typeof Reflect===_0x53158d(0x176)&&typeof Reflect[_0x520f8d(0x1b3)]===_0x53158d(0x151))_0x3bab4c=Reflect[_0x53158d(0x189)](_0x1d07ec,_0x51d0a3,_0x51f688,_0x48373e);else{for(var _0x3463a4=_0x1d07ec[_0x520f8d(0x178)]-0x1;_0x3463a4>=0x0;_0x3463a4--)if(_0x3a38fa=_0x1d07ec[_0x3463a4])_0x3bab4c=(_0x847a53<0x3?_0x3a38fa(_0x3bab4c):_0x847a53>0x3?_0x3a38fa(_0x51d0a3,_0x51f688,_0x3bab4c):_0x3a38fa(_0x51d0a3,_0x51f688))||_0x3bab4c;}return _0x847a53>0x3&&_0x3bab4c&&Object[_0x53158d(0x178)](_0x51d0a3,_0x51f688,_0x3bab4c),_0x3bab4c;},__metadata=this&&this[_0x4f76cb(0x184)]||function(_0x297cda,_0x5f202c){const _0x4de055=_0x25c6,_0x3617ce=_0x4f76cb;if(typeof Reflect===_0x3617ce(0x176)&&typeof Reflect[_0x4de055(0x1c0)]===_0x3617ce(0x151))return Reflect[_0x3617ce(0x14a)](_0x297cda,_0x5f202c);},__param=this&&this[_0x4f76cb(0x18b)]||function(_0x717fc6,_0x25a67e){return function(_0xccaad8,_0x53897e){_0x25a67e(_0xccaad8,_0x53897e,_0x717fc6);};};function _0x3501(){const _0x5276ab=_0x93d8,_0x3f70e1=_0x25c6,_0x2affe4=[_0x3f70e1(0x19c),_0x5276ab(0x1cf),_0x3f70e1(0x172),_0x3f70e1(0x1b5),_0x5276ab(0x1ad),_0x5276ab(0x1ba),_0x3f70e1(0x174),_0x3f70e1(0x185),_0x5276ab(0x1e5),_0x3f70e1(0x1bc),_0x3f70e1(0x193),_0x3f70e1(0x1ae),_0x3f70e1(0x179),_0x3f70e1(0x1b3),_0x3f70e1(0x1c1),'__param',_0x3f70e1(0x191),_0x3f70e1(0x19f),_0x3f70e1(0x1be),_0x3f70e1(0x1c3),_0x3f70e1(0x177),_0x5276ab(0x1bd),_0x3f70e1(0x1a1),_0x3f70e1(0x1a3),_0x5276ab(0x1bb),_0x3f70e1(0x19a),'design:paramtypes',_0x3f70e1(0x18c),_0x5276ab(0x1e9),_0x3f70e1(0x1c0),_0x3f70e1(0x17b),'../userBalance/userBalance.service',_0x3f70e1(0x19d),_0x3f70e1(0x19b),_0x3f70e1(0x1a2),_0x3f70e1(0x1a6),_0x3f70e1(0x182),_0x5276ab(0x1f0),_0x3f70e1(0x1ac),_0x3f70e1(0x1af),_0x3f70e1(0x1ad),_0x3f70e1(0x1a5),_0x3f70e1(0x1bb),_0x3f70e1(0x184),_0x5276ab(0x1e8),_0x5276ab(0x1b5),_0x3f70e1(0x175),_0x3f70e1(0x181),_0x3f70e1(0x18a),_0x3f70e1(0x199),_0x5276ab(0x1c2),_0x3f70e1(0x188),_0x5276ab(0x1d4),_0x3f70e1(0x194),_0x3f70e1(0x1b0),_0x3f70e1(0x19e),_0x3f70e1(0x1b7),_0x3f70e1(0x180),_0x3f70e1(0x1a4),_0x3f70e1(0x189),_0x5276ab(0x1cb),_0x3f70e1(0x186),_0x3f70e1(0x196),_0x3f70e1(0x195),_0x5276ab(0x1b3),_0x3f70e1(0x187),_0x3f70e1(0x17d),_0x3f70e1(0x17e),_0x5276ab(0x1fd),_0x5276ab(0x1bc),_0x5276ab(0x1d8),_0x3f70e1(0x1bd),_0x3f70e1(0x1a9),_0x3f70e1(0x1b4),_0x3f70e1(0x1ab),_0x3f70e1(0x1b9),_0x3f70e1(0x17c),_0x5276ab(0x1ea),_0x3f70e1(0x1aa)];return _0x3501=function(){return _0x2affe4;},_0x3501();}function _0x195c(_0x152dd4,_0x1b46fe){const _0x4f899e=_0x3501();return _0x195c=function(_0x2dcef3,_0x1cd6d8){_0x2dcef3=_0x2dcef3-0x142;let _0x2a72c7=_0x4f899e[_0x2dcef3];return _0x2a72c7;},_0x195c(_0x152dd4,_0x1b46fe);}function _0x93d8(_0x5cda5f,_0x294dc3){const _0x434070=_0x4340();return _0x93d8=function(_0x93d8b7,_0x1c8a0b){_0x93d8b7=_0x93d8b7-0x1a4;let _0x65bb50=_0x434070[_0x93d8b7];return _0x65bb50;},_0x93d8(_0x5cda5f,_0x294dc3);}function _0x25c6(_0x36c27e,_0x2dfd49){const _0x49cac2=_0xe0a6();return _0x25c6=function(_0x407879,_0x56392f){_0x407879=_0x407879-0x170;let _0x3d7e20=_0x49cac2[_0x407879];return _0x3d7e20;},_0x25c6(_0x36c27e,_0x2dfd49);}Object[_0x4f76cb(0x178)](exports,_0x4f76cb(0x14b),{'value':!![]}),exports[_0x4f76cb(0x144)]=void 0x0;const globalConfig_service_1=require(_0x5b2f4d(0x1f7)),userBalance_service_1=require(_0x4f76cb(0x14c)),common_1=require(_0x4f76cb(0x152)),signIn_entity_1=require(_0x4f76cb(0x187)),typeorm_1=require(_0x4f76cb(0x181)),typeorm_2=require(_0x45b0c7(0x18d)),date_1=require(_0x4f76cb(0x173)),user_entity_1=require(_0x45b0c7(0x17f)),balance_constant_1=require(_0x4f76cb(0x15a));let SigninService=class SigninService{constructor(_0x596d10,_0x582bb7,_0x3b7da5,_0x4c3673){const _0x49f8de=_0x5b2f4d,_0x147043=_0x4f76cb;this[_0x147043(0x17e)]=_0x596d10,this[_0x49f8de(0x1e7)]=_0x582bb7,this[_0x147043(0x17d)]=_0x3b7da5,this[_0x147043(0x168)]=_0x4c3673;}async[_0x4f76cb(0x159)](_0x4ad681){const _0x4eaf29=_0x5b2f4d,_0x95ced4=_0x45b0c7,_0xc79afd=_0x4f76cb,{id:_0xd15647}=_0x4ad681[_0xc79afd(0x174)],_0x24e5ca=(0x0,date_1[_0xc79afd(0x18a)])(new Date())[_0x4eaf29(0x1f5)](_0xc79afd(0x18c)),_0x26993d=await this[_0xc79afd(0x17e)][_0xc79afd(0x157)]({'where':{'userId':_0xd15647,'signInDate':_0x24e5ca}});if(_0x26993d)throw new common_1[(_0xc79afd(0x150))](_0xc79afd(0x177),common_1[_0xc79afd(0x180)][_0x95ced4(0x181)]);const {model3Count:_0xb5de8a,model4Count:_0x2c75e2,drawMjCount:_0x289c7c}=await this[_0xc79afd(0x168)][_0xc79afd(0x142)]();await this[_0xc79afd(0x17e)][_0xc79afd(0x164)]({'userId':_0xd15647,'signInTime':new Date(),'signInDate':_0x24e5ca,'isSigned':!![]}),await this[_0xc79afd(0x17d)][_0xc79afd(0x15b)](_0xd15647,{'model3Count':_0xb5de8a,'model4Count':_0x2c75e2,'drawMjCount':_0x289c7c}),await this[_0xc79afd(0x17d)][_0xc79afd(0x15d)]({'userId':_0xd15647,'rechargeType':balance_constant_1[_0xc79afd(0x17b)][_0xc79afd(0x15e)],'model3Count':_0xb5de8a,'model4Count':_0x2c75e2,'drawMjCount':_0x289c7c});const _0x4da90b=(0x0,date_1[_0x95ced4(0x1c1)])(new Date())[_0x95ced4(0x1c2)](0x1,_0xc79afd(0x153))[_0xc79afd(0x170)](_0x95ced4(0x191)),_0x1ae801=await this[_0x95ced4(0x172)][_0x95ced4(0x1bb)]({'where':{'userId':_0xd15647,'signInDate':_0x4da90b}});if(_0x1ae801){common_1[_0xc79afd(0x14d)][_0xc79afd(0x186)]('用户'+_0xd15647+_0x95ced4(0x1a7),_0x95ced4(0x1a3));const _0x226831=await this[_0xc79afd(0x162)][_0xc79afd(0x157)]({'where':{'id':_0xd15647}});if(!_0x226831)throw new common_1[(_0xc79afd(0x150))](_0x95ced4(0x1b1),common_1[_0xc79afd(0x180)][_0xc79afd(0x15c)]);const {consecutiveDays:consecutiveDays=0x0}=_0x226831;await this[_0xc79afd(0x162)][_0xc79afd(0x171)]({'id':_0xd15647},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0xc79afd(0x14d)][_0xc79afd(0x186)]('用户'+_0xd15647+_0xc79afd(0x182),_0xc79afd(0x144)),await this[_0x95ced4(0x194)][_0x95ced4(0x1b2)]({'id':_0xd15647},{'consecutiveDays':0x1});return _0x95ced4(0x198);}async['getSigninLog'](_0x427b06){const _0x51f6e1=_0x5b2f4d,_0x1f4212=_0x45b0c7,_0xb33567=_0x4f76cb;try{const {id:_0xc174d9}=_0x427b06[_0xb33567(0x174)],_0x106f3d=(0x0,date_1[_0xb33567(0x18a)])()[_0xb33567(0x156)](_0xb33567(0x16f))[_0xb33567(0x170)](_0xb33567(0x14e)),_0x28e091=(0x0,date_1[_0x1f4212(0x1c1)])()[_0xb33567(0x146)](_0xb33567(0x16f))[_0xb33567(0x170)](_0xb33567(0x14e)),_0x256c20=this[_0xb33567(0x17e)][_0xb33567(0x154)](_0xb33567(0x148)),_0xec1d88=await _0x256c20[_0xb33567(0x14f)](_0xb33567(0x155))[_0x51f6e1(0x1e9)](_0x1f4212(0x1a0),{'userId':_0x427b06[_0x1f4212(0x1bd)]['id']})[_0x1f4212(0x18e)](_0xb33567(0x172),{'firstDay':_0x106f3d})[_0xb33567(0x149)](_0xb33567(0x145),{'lastDay':_0x28e091})[_0xb33567(0x179)](),_0xac66c9=new Date(_0x106f3d),_0x723ce7=new Date(_0x28e091),_0x58b3f7=[],_0xf76d08=new Date(_0xac66c9);while(_0xf76d08<=_0x723ce7){_0x58b3f7[_0x1f4212(0x1bc)]((0x0,date_1[_0xb33567(0x18a)])(new Date(_0xf76d08))[_0xb33567(0x170)]('YYYY-MM-DD')),_0xf76d08[_0xb33567(0x163)](_0xf76d08[_0xb33567(0x175)]()+0x1);}const _0x2f9463=[];for(const _0x1cf1c8 of _0x58b3f7){const _0x1af3ee=_0xec1d88[_0xb33567(0x18d)](_0x84eae0=>_0x84eae0[_0xb33567(0x158)]===_0x1cf1c8);!_0x1af3ee?_0x2f9463[_0xb33567(0x185)]({'signInDate':_0x1cf1c8,'isSigned':![]}):(_0x1af3ee[_0xb33567(0x167)]=!![],_0x2f9463[_0x51f6e1(0x1a6)](_0x1af3ee));}return _0x2f9463;}catch(_0x56dfca){console[_0xb33567(0x16b)]('error:\x20',_0x56dfca);throw new common_1[(_0xb33567(0x150))](_0x1f4212(0x171),common_1[_0x1f4212(0x1b8)][_0xb33567(0x15c)]);}}};SigninService=__decorate([(0x0,common_1[_0x45b0c7(0x170)])(),__param(0x0,(0x0,typeorm_1[_0x4f76cb(0x183)])(signIn_entity_1[_0x5b2f4d(0x1b0)])),__param(0x1,(0x0,typeorm_1[_0x45b0c7(0x185)])(user_entity_1[_0x4f76cb(0x17c)])),__metadata(_0x4f76cb(0x147),[typeorm_2[_0x45b0c7(0x180)],typeorm_2[_0x4f76cb(0x166)],userBalance_service_1[_0x4f76cb(0x18e)],globalConfig_service_1[_0x4f76cb(0x161)]])],SigninService),exports[_0x4f76cb(0x144)]=SigninService;function _0x4340(){const _0x406d0c=['decorate','RechargeType','UserEntity','format','__esModule','../globalConfig/globalConfig.service','subtract','Repository','10bNiRnk','startOf','4fUuDbQ','update','shift','1254areKig','defineProperty','push','endOf','findOne','7331fOGNos','getRawMany','UserBalanceService','day','HttpStatus','21132vTmayF','typeorm','SigninEntity','70ULjRHP','user','__decorate','6856619MnCngc','../../common/constants/balance.constant','获取签到数据失败！','昨天签到了、今天是连续签到！','InjectRepository','昨天没签到、今天重置天数！','@nestjs/typeorm','signin.signInTime\x20<=\x20:lastDay','signin.signInTime\x20>=\x20:firstDay','getSignatureGiftConfig','../user/user.entity','save','BAD_REQUEST','47412ozIIKr','10129595yggmBx','select','8676SHnDML','function','addBalanceToUser','getOwnPropertyDescriptor','SIGN_IN','YYYY-MM-DD\x20HH:mm:ss','2569460NOayDn','609008wtUTrJ','object','getDate','134582xYEYzZ','userBalanceService','5812244WOLLDL','signInDate','Sign\x20in\x20successful.','798gpacTu','GlobalConfigService','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','SigninService','12JevwNk','../../common/utils/date','log','saveRecordRechargeLog','signin','114XOnDZO','setDate','5cZTfFQ','3qaMqwv','1192OnVHPB','length','HttpException','3221948bbgpds','5706828qhgSvy','__metadata','1078398FaxskV','userEntity','sign','andWhere','5388240DqqZqa','74lhTWOe','Logger','globalConfigService','./signIn.entity','6174216lgQGjB','@nestjs/common','isSigned'];_0x4340=function(){return _0x406d0c;};return _0x4340();}