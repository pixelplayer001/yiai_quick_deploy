'use strict';const _0x45b0c7=_0x25c6;function _0xe0a6(){const _0x606e25=['signin.userId\x20=\x20:userId','10682595pJxEyM','select','SigninService','isSigned','startOf','HttpException','昨天签到了、今天是连续签到！','47412ozIIKr','getDate','RechargeType','今日已签到、改天再来吧!.','day','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','./signIn.entity','createQueryBuilder','setDate','用户不存在','update','decorate','object','3qaMqwv','12JevwNk','8TEROge','HttpStatus','defineProperty','2569460NOayDn','findOne','push','user','UserBalanceService','shift','metadata','default','subtract','4fUuDbQ','Injectable','获取签到数据失败！','signinEntity','74lhTWOe','昨天没签到、今天重置天数！','addBalanceToUser','482484eUCNrr','5274996nAmsCU','length','4575125rrLjka','70ULjRHP','__esModule','getRawMany','month','format','../user/user.entity','Repository','BAD_REQUEST','function','1192OnVHPB','signInDate','InjectRepository','getOwnPropertyDescriptor','21132vTmayF','1254areKig','globalConfigService','saveRecordRechargeLog','7331fOGNos','signin','typeorm','andWhere','5812244WOLLDL','5GdMsUu','YYYY-MM-DD','162786UVcaxt','debug','userEntity','10MMPPHC','log','15065061yEgzQM','Sign\x20in\x20successful.','SIGN_IN','endOf','YYYY-MM-DD\x20HH:mm:ss','UserEntity','Logger','save','find'];_0xe0a6=function(){return _0x606e25;};return _0xe0a6();}(function(_0x4518a0,_0x1dfbd2){const _0x4bedf9=_0x25c6,_0x5aa325=_0x4518a0();while(!![]){try{const _0x13dc1e=parseInt(_0x4bedf9(0x18b))/0x1*(-parseInt(_0x4bedf9(0x173))/0x2)+parseInt(_0x4bedf9(0x176))/0x3+parseInt(_0x4bedf9(0x18f))/0x4*(parseInt(_0x4bedf9(0x190))/0x5)+-parseInt(_0x4bedf9(0x192))/0x6*(parseInt(_0x4bedf9(0x17a))/0x7)+parseInt(_0x4bedf9(0x183))/0x8*(parseInt(_0x4bedf9(0x1a8))/0x9)+parseInt(_0x4bedf9(0x1ba))/0xa+-parseInt(_0x4bedf9(0x197))/0xb*(parseInt(_0x4bedf9(0x1b6))/0xc);if(_0x13dc1e===_0x1dfbd2)break;else _0x5aa325['push'](_0x5aa325['shift']());}catch(_0x5d4cca){_0x5aa325['push'](_0x5aa325['shift']());}}}(_0xe0a6,0xb58eb));const _0x4f76cb=_0x195c;(function(_0x5d4fb2,_0x2158f5){const _0x5b7e21=_0x25c6,_0x1c1d7c=_0x195c,_0x5d8333=_0x5d4fb2();while(!![]){try{const _0x508fb8=-parseInt(_0x1c1d7c(0x169))/0x1*(-parseInt(_0x1c1d7c(0x18f))/0x2)+parseInt(_0x1c1d7c(0x17f))/0x3*(parseInt(_0x1c1d7c(0x190))/0x4)+-parseInt(_0x1c1d7c(0x188))/0x5+-parseInt(_0x1c1d7c(0x17a))/0x6+-parseInt(_0x1c1d7c(0x15f))/0x7*(-parseInt(_0x1c1d7c(0x165))/0x8)+-parseInt(_0x1c1d7c(0x143))/0x9*(parseInt(_0x1c1d7c(0x16c))/0xa)+-parseInt(_0x1c1d7c(0x160))/0xb*(parseInt(_0x1c1d7c(0x16e))/0xc);if(_0x508fb8===_0x2158f5)break;else _0x5d8333[_0x5b7e21(0x1bc)](_0x5d8333[_0x5b7e21(0x1bf)]());}catch(_0x303f38){_0x5d8333[_0x5b7e21(0x1bc)](_0x5d8333[_0x5b7e21(0x1bf)]());}}}(_0x3501,0xbf2e4));var __decorate=this&&this[_0x4f76cb(0x16d)]||function(_0x21d976,_0x198c20,_0x43c72d,_0x306530){const _0x165013=_0x25c6,_0xedd75c=_0x4f76cb;var _0xcd9210=arguments[_0x165013(0x178)],_0x54b09c=_0xcd9210<0x3?_0x198c20:_0x306530===null?_0x306530=Object[_0xedd75c(0x16a)](_0x198c20,_0x43c72d):_0x306530,_0x473098;if(typeof Reflect===_0xedd75c(0x176)&&typeof Reflect[_0x165013(0x1b3)]===_0xedd75c(0x151))_0x54b09c=Reflect[_0xedd75c(0x189)](_0x21d976,_0x198c20,_0x43c72d,_0x306530);else{for(var _0x2cab31=_0x21d976[_0x165013(0x178)]-0x1;_0x2cab31>=0x0;_0x2cab31--)if(_0x473098=_0x21d976[_0x2cab31])_0x54b09c=(_0xcd9210<0x3?_0x473098(_0x54b09c):_0xcd9210>0x3?_0x473098(_0x198c20,_0x43c72d,_0x54b09c):_0x473098(_0x198c20,_0x43c72d))||_0x54b09c;}return _0xcd9210>0x3&&_0x54b09c&&Object[_0xedd75c(0x178)](_0x198c20,_0x43c72d,_0x54b09c),_0x54b09c;},__metadata=this&&this[_0x4f76cb(0x184)]||function(_0x2b6e06,_0x4e5698){const _0x5056f4=_0x25c6,_0x34fb2d=_0x4f76cb;if(typeof Reflect===_0x34fb2d(0x176)&&typeof Reflect[_0x5056f4(0x1c0)]===_0x34fb2d(0x151))return Reflect[_0x34fb2d(0x14a)](_0x2b6e06,_0x4e5698);},__param=this&&this[_0x4f76cb(0x18b)]||function(_0x19603e,_0xed7453){return function(_0x598b8f,_0x20621d){_0xed7453(_0x598b8f,_0x20621d,_0x19603e);};};function _0x3501(){const _0x1bc516=_0x25c6,_0x4cdaa4=[_0x1bc516(0x19c),'userBalanceService',_0x1bc516(0x172),_0x1bc516(0x1b5),'HttpStatus','@nestjs/typeorm',_0x1bc516(0x174),_0x1bc516(0x185),'__metadata',_0x1bc516(0x1bc),_0x1bc516(0x193),_0x1bc516(0x1ae),_0x1bc516(0x179),_0x1bc516(0x1b3),_0x1bc516(0x1c1),'__param',_0x1bc516(0x191),_0x1bc516(0x19f),_0x1bc516(0x1be),_0x1bc516(0x1c3),_0x1bc516(0x177),'getSignatureGiftConfig',_0x1bc516(0x1a1),_0x1bc516(0x1a3),'signin.signInTime\x20<=\x20:lastDay',_0x1bc516(0x19a),'design:paramtypes',_0x1bc516(0x18c),'andWhere',_0x1bc516(0x1c0),_0x1bc516(0x17b),'../userBalance/userBalance.service',_0x1bc516(0x19d),_0x1bc516(0x19b),_0x1bc516(0x1a2),_0x1bc516(0x1a6),_0x1bc516(0x182),'@nestjs/common',_0x1bc516(0x1ac),_0x1bc516(0x1af),_0x1bc516(0x1ad),_0x1bc516(0x1a5),_0x1bc516(0x1bb),_0x1bc516(0x184),'sign','../../common/constants/balance.constant',_0x1bc516(0x175),_0x1bc516(0x181),_0x1bc516(0x18a),_0x1bc516(0x199),'10129595yggmBx',_0x1bc516(0x188),'GlobalConfigService',_0x1bc516(0x194),_0x1bc516(0x1b0),_0x1bc516(0x19e),_0x1bc516(0x1b7),_0x1bc516(0x180),_0x1bc516(0x1a4),_0x1bc516(0x189),'609008wtUTrJ',_0x1bc516(0x186),_0x1bc516(0x196),_0x1bc516(0x195),'__decorate',_0x1bc516(0x187),_0x1bc516(0x17d),_0x1bc516(0x17e),'update','signin.signInTime\x20>=\x20:firstDay','../../common/utils/date',_0x1bc516(0x1bd),_0x1bc516(0x1a9),_0x1bc516(0x1b4),_0x1bc516(0x1ab),_0x1bc516(0x1b9),_0x1bc516(0x17c),'5388240DqqZqa',_0x1bc516(0x1aa)];return _0x3501=function(){return _0x4cdaa4;},_0x3501();}function _0x195c(_0x5865eb,_0x3c6463){const _0x2dbdd4=_0x3501();return _0x195c=function(_0x5dd9db,_0x20fa22){_0x5dd9db=_0x5dd9db-0x142;let _0x1690d6=_0x2dbdd4[_0x5dd9db];return _0x1690d6;},_0x195c(_0x5865eb,_0x3c6463);}function _0x25c6(_0x199bd2,_0x237f25){const _0xe0a6f5=_0xe0a6();return _0x25c6=function(_0x25c647,_0x54cc40){_0x25c647=_0x25c647-0x170;let _0x173732=_0xe0a6f5[_0x25c647];return _0x173732;},_0x25c6(_0x199bd2,_0x237f25);}Object[_0x4f76cb(0x178)](exports,_0x4f76cb(0x14b),{'value':!![]}),exports[_0x4f76cb(0x144)]=void 0x0;const globalConfig_service_1=require('../globalConfig/globalConfig.service'),userBalance_service_1=require(_0x4f76cb(0x14c)),common_1=require(_0x4f76cb(0x152)),signIn_entity_1=require(_0x4f76cb(0x187)),typeorm_1=require(_0x4f76cb(0x181)),typeorm_2=require(_0x45b0c7(0x18d)),date_1=require(_0x4f76cb(0x173)),user_entity_1=require(_0x45b0c7(0x17f)),balance_constant_1=require(_0x4f76cb(0x15a));let SigninService=class SigninService{constructor(_0x3682ac,_0x52c29a,_0x50c402,_0x3eab41){const _0x168be9=_0x4f76cb;this[_0x168be9(0x17e)]=_0x3682ac,this['userEntity']=_0x52c29a,this[_0x168be9(0x17d)]=_0x50c402,this[_0x168be9(0x168)]=_0x3eab41;}async[_0x4f76cb(0x159)](_0x1f1d5){const _0x2fb1db=_0x45b0c7,_0x2f623b=_0x4f76cb,{id:_0x473813}=_0x1f1d5[_0x2f623b(0x174)],_0x8d19b9=(0x0,date_1[_0x2f623b(0x18a)])(new Date())['format'](_0x2f623b(0x18c)),_0x482fc7=await this[_0x2f623b(0x17e)][_0x2f623b(0x157)]({'where':{'userId':_0x473813,'signInDate':_0x8d19b9}});if(_0x482fc7)throw new common_1[(_0x2f623b(0x150))](_0x2f623b(0x177),common_1[_0x2f623b(0x180)][_0x2fb1db(0x181)]);const {model3Count:_0x33a150,model4Count:_0x4b60f3,drawMjCount:_0x3aa744}=await this[_0x2f623b(0x168)][_0x2f623b(0x142)]();await this[_0x2f623b(0x17e)][_0x2f623b(0x164)]({'userId':_0x473813,'signInTime':new Date(),'signInDate':_0x8d19b9,'isSigned':!![]}),await this[_0x2f623b(0x17d)][_0x2f623b(0x15b)](_0x473813,{'model3Count':_0x33a150,'model4Count':_0x4b60f3,'drawMjCount':_0x3aa744}),await this[_0x2f623b(0x17d)][_0x2f623b(0x15d)]({'userId':_0x473813,'rechargeType':balance_constant_1[_0x2f623b(0x17b)][_0x2f623b(0x15e)],'model3Count':_0x33a150,'model4Count':_0x4b60f3,'drawMjCount':_0x3aa744});const _0x2c99fd=(0x0,date_1[_0x2fb1db(0x1c1)])(new Date())[_0x2fb1db(0x1c2)](0x1,_0x2f623b(0x153))[_0x2f623b(0x170)](_0x2fb1db(0x191)),_0x514417=await this[_0x2fb1db(0x172)][_0x2fb1db(0x1bb)]({'where':{'userId':_0x473813,'signInDate':_0x2c99fd}});if(_0x514417){common_1[_0x2f623b(0x14d)][_0x2f623b(0x186)]('用户'+_0x473813+_0x2fb1db(0x1a7),_0x2fb1db(0x1a3));const _0x4e9415=await this[_0x2f623b(0x162)][_0x2f623b(0x157)]({'where':{'id':_0x473813}});if(!_0x4e9415)throw new common_1[(_0x2f623b(0x150))](_0x2fb1db(0x1b1),common_1[_0x2f623b(0x180)][_0x2f623b(0x15c)]);const {consecutiveDays:consecutiveDays=0x0}=_0x4e9415;await this[_0x2f623b(0x162)][_0x2f623b(0x171)]({'id':_0x473813},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x2f623b(0x14d)][_0x2f623b(0x186)]('用户'+_0x473813+_0x2f623b(0x182),_0x2f623b(0x144)),await this[_0x2fb1db(0x194)][_0x2fb1db(0x1b2)]({'id':_0x473813},{'consecutiveDays':0x1});return _0x2fb1db(0x198);}async['getSigninLog'](_0x514f6b){const _0x145c04=_0x45b0c7,_0x47bdfa=_0x4f76cb;try{const {id:_0xe97236}=_0x514f6b[_0x47bdfa(0x174)],_0x156854=(0x0,date_1[_0x47bdfa(0x18a)])()[_0x47bdfa(0x156)](_0x47bdfa(0x16f))[_0x47bdfa(0x170)](_0x47bdfa(0x14e)),_0x4d2a62=(0x0,date_1[_0x145c04(0x1c1)])()[_0x47bdfa(0x146)](_0x47bdfa(0x16f))[_0x47bdfa(0x170)](_0x47bdfa(0x14e)),_0x2c7d95=this[_0x47bdfa(0x17e)][_0x47bdfa(0x154)](_0x47bdfa(0x148)),_0x2e8aee=await _0x2c7d95[_0x47bdfa(0x14f)](_0x47bdfa(0x155))['andWhere'](_0x145c04(0x1a0),{'userId':_0x514f6b[_0x145c04(0x1bd)]['id']})[_0x145c04(0x18e)](_0x47bdfa(0x172),{'firstDay':_0x156854})[_0x47bdfa(0x149)](_0x47bdfa(0x145),{'lastDay':_0x4d2a62})[_0x47bdfa(0x179)](),_0x3d302f=new Date(_0x156854),_0x5f4863=new Date(_0x4d2a62),_0x336a98=[],_0xffe6a4=new Date(_0x3d302f);while(_0xffe6a4<=_0x5f4863){_0x336a98[_0x145c04(0x1bc)]((0x0,date_1[_0x47bdfa(0x18a)])(new Date(_0xffe6a4))[_0x47bdfa(0x170)]('YYYY-MM-DD')),_0xffe6a4[_0x47bdfa(0x163)](_0xffe6a4[_0x47bdfa(0x175)]()+0x1);}const _0x50eacb=[];for(const _0x4bf32a of _0x336a98){const _0x2ffce4=_0x2e8aee[_0x47bdfa(0x18d)](_0x26644d=>_0x26644d[_0x47bdfa(0x158)]===_0x4bf32a);!_0x2ffce4?_0x50eacb[_0x47bdfa(0x185)]({'signInDate':_0x4bf32a,'isSigned':![]}):(_0x2ffce4[_0x47bdfa(0x167)]=!![],_0x50eacb['push'](_0x2ffce4));}return _0x50eacb;}catch(_0x52db59){console[_0x47bdfa(0x16b)]('error:\x20',_0x52db59);throw new common_1[(_0x47bdfa(0x150))](_0x145c04(0x171),common_1[_0x145c04(0x1b8)][_0x47bdfa(0x15c)]);}}};SigninService=__decorate([(0x0,common_1[_0x45b0c7(0x170)])(),__param(0x0,(0x0,typeorm_1[_0x4f76cb(0x183)])(signIn_entity_1['SigninEntity'])),__param(0x1,(0x0,typeorm_1[_0x45b0c7(0x185)])(user_entity_1[_0x4f76cb(0x17c)])),__metadata(_0x4f76cb(0x147),[typeorm_2[_0x45b0c7(0x180)],typeorm_2[_0x4f76cb(0x166)],userBalance_service_1[_0x4f76cb(0x18e)],globalConfig_service_1[_0x4f76cb(0x161)]])],SigninService),exports[_0x4f76cb(0x144)]=SigninService;