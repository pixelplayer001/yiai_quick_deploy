'use strict';const _0x83d42c=_0x4152;(function(_0x46e30,_0x1072ef){const _0x5db6b7=_0x4152,_0x4c0900=_0x46e30();while(!![]){try{const _0x7efa0f=-parseInt(_0x5db6b7(0x1ea))/0x1*(parseInt(_0x5db6b7(0x201))/0x2)+parseInt(_0x5db6b7(0x21f))/0x3+-parseInt(_0x5db6b7(0x213))/0x4+-parseInt(_0x5db6b7(0x1e5))/0x5*(-parseInt(_0x5db6b7(0x226))/0x6)+-parseInt(_0x5db6b7(0x20d))/0x7+parseInt(_0x5db6b7(0x1dd))/0x8+-parseInt(_0x5db6b7(0x22c))/0x9*(-parseInt(_0x5db6b7(0x218))/0xa);if(_0x7efa0f===_0x1072ef)break;else _0x4c0900['push'](_0x4c0900['shift']());}catch(_0x5d8a8b){_0x4c0900['push'](_0x4c0900['shift']());}}}(_0x15f9,0xee97e));const _0x3556a9=_0x5759;function _0x4152(_0x1ab297,_0x31ca27){const _0x15f9f6=_0x15f9();return _0x4152=function(_0x415245,_0x221e0f){_0x415245=_0x415245-0x1dc;let _0x454adc=_0x15f9f6[_0x415245];return _0x454adc;},_0x4152(_0x1ab297,_0x31ca27);}(function(_0xbd8a00,_0x10cf2f){const _0x1ba540=_0x4152,_0x20c9dd=_0x5759,_0x8ba678=_0xbd8a00();while(!![]){try{const _0x12a75e=-parseInt(_0x20c9dd(0x146))/0x1+parseInt(_0x20c9dd(0x142))/0x2*(-parseInt(_0x20c9dd(0x13a))/0x3)+-parseInt(_0x20c9dd(0xfe))/0x4*(-parseInt(_0x20c9dd(0x145))/0x5)+parseInt(_0x20c9dd(0x137))/0x6*(-parseInt(_0x20c9dd(0x133))/0x7)+parseInt(_0x20c9dd(0x107))/0x8*(parseInt(_0x20c9dd(0x11e))/0x9)+parseInt(_0x20c9dd(0x10b))/0xa*(parseInt(_0x20c9dd(0x101))/0xb)+parseInt(_0x20c9dd(0xf9))/0xc*(-parseInt(_0x20c9dd(0x140))/0xd);if(_0x12a75e===_0x10cf2f)break;else _0x8ba678['push'](_0x8ba678[_0x1ba540(0x22e)]());}catch(_0x9b4cad){_0x8ba678[_0x1ba540(0x1df)](_0x8ba678[_0x1ba540(0x22e)]());}}}(_0x5b23,0xe8a70),(Object[_0x3556a9(0x11a)](exports,_0x3556a9(0x114),{'value':!![]}),exports[_0x3556a9(0x119)]=exports[_0x3556a9(0x10f)]=void 0x0));const axios_1=require(_0x3556a9(0x130)),tiktoken_1=require(_0x3556a9(0x118)),common_1=require(_0x3556a9(0x112)),uuid=require(_0x3556a9(0x138)),tokenizer=(0x0,tiktoken_1[_0x3556a9(0x127)])(_0x83d42c(0x1f2));function getFullUrl(_0x441375){const _0x28654e=_0x83d42c,_0x1b2c5a=_0x3556a9,_0x4480c5=_0x441375[_0x28654e(0x1ff)]('/')?_0x441375[_0x1b2c5a(0x12a)](0x0,-0x1):_0x441375,_0x4a2e40=_0x4480c5||_0x1b2c5a(0x128);return _0x4a2e40+_0x1b2c5a(0x12c);}async function sendMessageFromOpenAi(_0x53e454,_0x5db822,_0x51c922){const _0x144d3d=_0x83d42c,_0x344b14=_0x3556a9;var _0x45496d,_0x34ece1,_0x48612d,_0x4b0a42;const {onProgress:_0x5ae517,maxToken:_0x15fa22,apiKey:_0x139673,model:_0x1801b9,temperature:temperature=0.8,proxyUrl:_0x31f45e,prompt:_0x7fbdd8}=_0x5db822;if(_0x1801b9[_0x344b14(0x141)]('dall')){let _0x43ebf1={'text':'','imageUrl':''};try{const _0x915a56={'method':_0x344b14(0x13f),'url':_0x31f45e+_0x344b14(0x113),'headers':{'Content-Type':_0x344b14(0x144),'Authorization':_0x344b14(0x11b)+_0x139673},'data':{'prompt':_0x7fbdd8,'model':_0x1801b9,'response_format':_0x344b14(0x136)}},_0x34246d=await(0x0,axios_1[_0x344b14(0x126)])(_0x915a56),{b64_json:_0x4c51b8,revised_prompt:_0x52d433}=_0x34246d[_0x144d3d(0x1fd)][_0x344b14(0x125)][0x0],_0x4ee3ca=Buffer[_0x344b14(0x106)](_0x4c51b8,'base64');let _0x423448='';try{const _0x4d82a3=uuid['v4']()[_0x344b14(0x12a)](0x0,0xa)+_0x344b14(0x116);common_1[_0x344b14(0x129)][_0x344b14(0xfc)](_0x344b14(0x109),_0x144d3d(0x220));const _0x1760bc=Buffer[_0x344b14(0x106)](_0x4c51b8,_0x344b14(0x117));_0x423448=await _0x51c922[_0x144d3d(0x1e2)]({'filename':_0x4d82a3,'buffer':_0x1760bc}),common_1[_0x344b14(0x129)][_0x144d3d(0x1f4)](_0x344b14(0x13c)+_0x423448,_0x344b14(0x13e));}catch(_0x41ab9f){common_1[_0x344b14(0x129)][_0x344b14(0x132)]('上传图片过程中出现错误:\x20'+_0x41ab9f,_0x344b14(0x13e));}return _0x43ebf1[_0x344b14(0x11f)]=_0x423448,_0x43ebf1[_0x144d3d(0x206)]=_0x52d433,_0x5ae517&&_0x5ae517({'text':_0x43ebf1[_0x344b14(0x103)]}),_0x43ebf1;}catch(_0x23c48b){const _0x2471b6=((_0x45496d=_0x23c48b===null||_0x23c48b===void 0x0?void 0x0:_0x23c48b[_0x344b14(0xfd)])===null||_0x45496d===void 0x0?void 0x0:_0x45496d[_0x344b14(0x135)])||0x1f4;console[_0x344b14(0x10c)](_0x144d3d(0x204),JSON[_0x344b14(0x12e)](_0x23c48b),_0x2471b6);const _0x406d52=(_0x4b0a42=(_0x48612d=(_0x34ece1=_0x23c48b===null||_0x23c48b===void 0x0?void 0x0:_0x23c48b[_0x344b14(0xfd)])===null||_0x34ece1===void 0x0?void 0x0:_0x34ece1[_0x144d3d(0x1fd)])===null||_0x48612d===void 0x0?void 0x0:_0x48612d[_0x344b14(0x132)])===null||_0x4b0a42===void 0x0?void 0x0:_0x4b0a42[_0x344b14(0x104)];if(_0x2471b6===0x1ad)return _0x43ebf1['text']=_0x344b14(0x10a),_0x43ebf1;if(_0x2471b6===0x190&&_0x406d52[_0x344b14(0x141)](_0x344b14(0xfa)))return _0x43ebf1[_0x344b14(0x103)]=_0x144d3d(0x228),_0x43ebf1;if(_0x2471b6===0x190&&_0x406d52[_0x344b14(0x141)](_0x344b14(0x11d)))return _0x43ebf1[_0x344b14(0x103)]=_0x144d3d(0x217),_0x43ebf1;if(_0x2471b6===0x1f4)return _0x43ebf1['text']=_0x344b14(0x120),_0x43ebf1;if(_0x2471b6===0x191)return _0x43ebf1[_0x344b14(0x103)]=_0x344b14(0x100),_0x43ebf1;return _0x43ebf1[_0x344b14(0x103)]=_0x344b14(0x12d),_0x43ebf1;}}else{let _0xdecdae={'text':''};const _0x383190={'method':_0x344b14(0x13f),'url':getFullUrl(_0x31f45e),'responseType':_0x344b14(0x139),'headers':{'Content-Type':_0x344b14(0x144),'Accept':_0x344b14(0x144),'Authorization':_0x344b14(0x11b)+_0x139673},'data':{'stream':!![],'temperature':temperature,'model':_0x1801b9,'messages':_0x53e454}};return _0x1801b9===_0x344b14(0x10d)&&(_0x383190[_0x344b14(0x125)][_0x344b14(0x13b)]=0x800),new Promise(async(_0x2fb196,_0x13d154)=>{const _0x5a177e=_0x144d3d,_0xaa2961=_0x344b14;try{const _0x13b62c=await(0x0,axios_1[_0x5a177e(0x219)])(_0x383190),_0xc9929a=_0x13b62c[_0xaa2961(0x125)];_0xc9929a['on'](_0xaa2961(0x125),_0x418358=>{const _0x2e90ca=_0x5a177e,_0x203c1e=_0xaa2961;var _0x36f52b;const _0x2bbc25=_0x418358[_0x203c1e(0x102)]()[_0x2e90ca(0x200)]('\x0a\x0a')[_0x2e90ca(0x22d)](_0x5035bd=>_0x5035bd[_0x203c1e(0x115)]()!=='');for(const _0x220e56 of _0x2bbc25){const _0x44fd3e=_0x220e56['replace'](_0x203c1e(0x12b),'');let _0x49c8b8=![];try{_0x49c8b8=JSON[_0x203c1e(0x11c)](_0x44fd3e)[_0x203c1e(0x134)][0x0][_0x2e90ca(0x1dc)]===_0x203c1e(0x105);}catch(_0x4285ef){_0x49c8b8=![];}if(_0x49c8b8)return _0xdecdae[_0x2e90ca(0x206)]=_0xdecdae[_0x203c1e(0x103)][_0x203c1e(0x115)](),_0xdecdae;try{if(_0x44fd3e!==_0x203c1e(0xff)&&_0x44fd3e!==_0x2e90ca(0x203)&&_0x44fd3e!=_0x203c1e(0x124)){const _0x893911=JSON[_0x2e90ca(0x224)](_0x44fd3e);_0x893911['id']&&(_0xdecdae['id']=_0x893911['id']);if((_0x36f52b=_0x893911[_0x203c1e(0x134)])===null||_0x36f52b===void 0x0?void 0x0:_0x36f52b[_0x203c1e(0x131)]){const _0x1762ee=_0x893911[_0x203c1e(0x134)][0x0][_0x203c1e(0x143)];_0xdecdae[_0x203c1e(0x143)]=_0x1762ee[_0x203c1e(0x121)];if(_0x1762ee===null||_0x1762ee===void 0x0?void 0x0:_0x1762ee[_0x203c1e(0x121)])_0xdecdae[_0x203c1e(0x103)]+=_0x1762ee[_0x203c1e(0x121)];_0x1762ee[_0x2e90ca(0x22b)]&&(_0xdecdae['role']=_0x1762ee[_0x203c1e(0x111)]),_0xdecdae[_0x2e90ca(0x212)]=_0x893911;}_0x5ae517&&_0x5ae517({'text':_0xdecdae[_0x2e90ca(0x206)]});}}catch(_0x2a9505){console[_0x203c1e(0x10c)](_0x203c1e(0xfb),_0x44fd3e);}}});let _0x596413='';_0x53e454[_0xaa2961(0x13d)](_0x862ad5=>{const _0x3fe5f5=_0xaa2961;_0x596413+=_0x862ad5[_0x3fe5f5(0x121)]+'\x20';}),_0xc9929a['on'](_0xaa2961(0x123),()=>{const _0xd907c8=_0xaa2961;if(_0xdecdae[_0xd907c8(0x108)]&&_0xdecdae[_0xd907c8(0x103)]){const _0x161833=getTokenCount(_0x596413),_0x54afaa=getTokenCount(_0xdecdae[_0xd907c8(0x103)]);_0xdecdae[_0xd907c8(0x108)][_0xd907c8(0x110)]={'prompt_tokens':_0x161833,'completion_tokens':_0x54afaa,'total_tokens':_0x161833+_0x54afaa,'estimated':!![]};}return _0x2fb196(_0xdecdae);});}catch(_0x25786d){_0x13d154(_0x25786d);}});}}function _0x5b23(){const _0x3c47a7=_0x83d42c,_0x4748ba=['axios',_0x3c47a7(0x207),_0x3c47a7(0x223),_0x3c47a7(0x1e6),_0x3c47a7(0x20e),_0x3c47a7(0x1f9),_0x3c47a7(0x231),_0x3c47a7(0x215),'uuid','stream',_0x3c47a7(0x1e1),_0x3c47a7(0x1ec),'图片上传成功，URL:\x20',_0x3c47a7(0x1ee),_0x3c47a7(0x220),_0x3c47a7(0x1de),'5681PYOAHr',_0x3c47a7(0x1e4),_0x3c47a7(0x22a),'delta',_0x3c47a7(0x1ef),'2598415fTIGla','199644cBpmqX',_0x3c47a7(0x1e0),_0x3c47a7(0x1fb),_0x3c47a7(0x1eb),'debug',_0x3c47a7(0x1fe),_0x3c47a7(0x1f6),_0x3c47a7(0x230),_0x3c47a7(0x205),_0x3c47a7(0x1fc),_0x3c47a7(0x202),_0x3c47a7(0x206),_0x3c47a7(0x20c),_0x3c47a7(0x225),_0x3c47a7(0x21a),_0x3c47a7(0x1e3),_0x3c47a7(0x212),_0x3c47a7(0x1f1),_0x3c47a7(0x1e9),'90tCansH',_0x3c47a7(0x20f),_0x3c47a7(0x209),_0x3c47a7(0x208),'sendMessageFromOpenAi',_0x3c47a7(0x1f8),_0x3c47a7(0x22b),'@nestjs/common','/v1/images/generations','__esModule',_0x3c47a7(0x216),_0x3c47a7(0x227),_0x3c47a7(0x20b),_0x3c47a7(0x22f),_0x3c47a7(0x1ed),_0x3c47a7(0x229),_0x3c47a7(0x21e),_0x3c47a7(0x224),_0x3c47a7(0x1e8),'9ehHSwl',_0x3c47a7(0x20a),_0x3c47a7(0x1fa),_0x3c47a7(0x214),_0x3c47a7(0x1f7),_0x3c47a7(0x221),_0x3c47a7(0x1e7),_0x3c47a7(0x1fd),_0x3c47a7(0x219),_0x3c47a7(0x1f3),_0x3c47a7(0x211),_0x3c47a7(0x21b),_0x3c47a7(0x1f5),_0x3c47a7(0x21d),_0x3c47a7(0x1f0),_0x3c47a7(0x21c),_0x3c47a7(0x210),_0x3c47a7(0x222)];return _0x5b23=function(){return _0x4748ba;},_0x5b23();}exports[_0x3556a9(0x10f)]=sendMessageFromOpenAi;function _0x15f9(){const _0x458c9e=['MidjourneyService','end','replace','error','parse','stop','138HEbdXV','.png','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','defineProperty','1553146EAPGms','role','3249423PuDYTX','filter','shift','@dqbd/tiktoken','\x20[DONE]','b64_json','finish_reason','7060144bodEcq','POST','push','4056KgQObu','3EzVWsh','uploadFile','12279896txzxTm','includes','53995svEflV','25060rcAPzP','[DONE]\x20','Billing\x20hard\x20limit\x20has\x20been\x20reached','当前请求已过载、请稍等会儿再试试吧！','7GiQUBO','parse\x20Error','max_tokens','getTokenCount','forEach','application/json','/v1/chat/completions','------>\x20开始上传图片！！！','cl100k_base','get_encoding','debug','slice','4yvHCGb','encode','usage','status','绘制图片失败，请检查你的提示词是否有非法描述！','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','1746723HvzFXB','data','response','endsWith','split','16026YpCJwf','toString','[DONE]','openai-draw\x20error:\x20','绘制图片失败，此次绘画被拒绝了！','text','length','string','gpt-4-vision-preview','imageUrl','base64','message','1091482iYJUhl','choices','log','stringify','https://api.openai.com','detail','4389060gubRnR','content','2358CpMsWN','trim','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','30BZDZBt','default','from','Logger','绘制图片失败，请稍后试试吧！','data:','Bearer\x20','217572meEmxK'];_0x15f9=function(){return _0x458c9e;};return _0x15f9();}function getTokenCount(_0x294b73){const _0x360f60=_0x3556a9;if(!_0x294b73)return 0x0;return typeof _0x294b73!==_0x360f60(0x10e)&&(_0x294b73=String(_0x294b73)),_0x294b73=_0x294b73[_0x360f60(0x12f)](/<\|endoftext\|>/g,''),tokenizer[_0x360f60(0x122)](_0x294b73)[_0x360f60(0x131)];}function _0x5759(_0x5d44ad,_0x147de9){const _0x25ba5f=_0x5b23();return _0x5759=function(_0x5dbf4e,_0xe3f863){_0x5dbf4e=_0x5dbf4e-0xf9;let _0x10aaf5=_0x25ba5f[_0x5dbf4e];return _0x10aaf5;},_0x5759(_0x5d44ad,_0x147de9);}exports[_0x83d42c(0x1ed)]=getTokenCount;