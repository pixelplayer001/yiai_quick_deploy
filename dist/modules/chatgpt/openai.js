'use strict';(function(_0x521eaf,_0xea2b82){const _0x5831ad=_0x44f9,_0x5e2904=_0x521eaf();while(!![]){try{const _0xb2ca8a=-parseInt(_0x5831ad(0x15a))/0x1+parseInt(_0x5831ad(0x131))/0x2+parseInt(_0x5831ad(0x181))/0x3*(parseInt(_0x5831ad(0x136))/0x4)+-parseInt(_0x5831ad(0x13d))/0x5+-parseInt(_0x5831ad(0x179))/0x6+-parseInt(_0x5831ad(0x17f))/0x7*(parseInt(_0x5831ad(0x12e))/0x8)+parseInt(_0x5831ad(0x137))/0x9;if(_0xb2ca8a===_0xea2b82)break;else _0x5e2904['push'](_0x5e2904['shift']());}catch(_0x3051b9){_0x5e2904['push'](_0x5e2904['shift']());}}}(_0x3c4b,0x80d4e));const _0x83d42c=_0x4152;(function(_0x3aca92,_0x1e6231){const _0x1ad3d1=_0x44f9,_0x46724c=_0x4152,_0x9a50f=_0x3aca92();while(!![]){try{const _0x25e139=-parseInt(_0x46724c(0x1ea))/0x1*(parseInt(_0x46724c(0x201))/0x2)+parseInt(_0x46724c(0x21f))/0x3+-parseInt(_0x46724c(0x213))/0x4+-parseInt(_0x46724c(0x1e5))/0x5*(-parseInt(_0x46724c(0x226))/0x6)+-parseInt(_0x46724c(0x20d))/0x7+parseInt(_0x46724c(0x1dd))/0x8+-parseInt(_0x46724c(0x22c))/0x9*(-parseInt(_0x46724c(0x218))/0xa);if(_0x25e139===_0x1e6231)break;else _0x9a50f[_0x1ad3d1(0x159)](_0x9a50f[_0x1ad3d1(0x13b)]());}catch(_0x198e5a){_0x9a50f[_0x1ad3d1(0x159)](_0x9a50f[_0x1ad3d1(0x13b)]());}}}(_0x15f9,0xee97e));const _0x3556a9=_0x5759;function _0x44f9(_0x4b7e9d,_0x11c8fd){const _0x3c4ba5=_0x3c4b();return _0x44f9=function(_0x44f9af,_0x4fcbec){_0x44f9af=_0x44f9af-0x12e;let _0x3ee85d=_0x3c4ba5[_0x44f9af];return _0x3ee85d;},_0x44f9(_0x4b7e9d,_0x11c8fd);}function _0x4152(_0x3e2117,_0x26c351){const _0x4894ea=_0x15f9();return _0x4152=function(_0x30020a,_0x450c84){_0x30020a=_0x30020a-0x1dc;let _0x457492=_0x4894ea[_0x30020a];return _0x457492;},_0x4152(_0x3e2117,_0x26c351);}(function(_0x1b3db2,_0x3051f4){const _0x33143b=_0x44f9,_0x8c2764=_0x4152,_0x34715a=_0x5759,_0xe87194=_0x1b3db2();while(!![]){try{const _0x435126=-parseInt(_0x34715a(0x146))/0x1+parseInt(_0x34715a(0x142))/0x2*(-parseInt(_0x34715a(0x13a))/0x3)+-parseInt(_0x34715a(0xfe))/0x4*(-parseInt(_0x34715a(0x145))/0x5)+parseInt(_0x34715a(0x137))/0x6*(-parseInt(_0x34715a(0x133))/0x7)+parseInt(_0x34715a(0x107))/0x8*(parseInt(_0x34715a(0x11e))/0x9)+parseInt(_0x34715a(0x10b))/0xa*(parseInt(_0x34715a(0x101))/0xb)+parseInt(_0x34715a(0xf9))/0xc*(-parseInt(_0x34715a(0x140))/0xd);if(_0x435126===_0x3051f4)break;else _0xe87194[_0x33143b(0x159)](_0xe87194[_0x8c2764(0x22e)]());}catch(_0x1b2aea){_0xe87194[_0x8c2764(0x1df)](_0xe87194[_0x8c2764(0x22e)]());}}}(_0x5b23,0xe8a70),(Object[_0x3556a9(0x11a)](exports,_0x3556a9(0x114),{'value':!![]}),exports[_0x3556a9(0x119)]=exports[_0x3556a9(0x10f)]=void 0x0));const axios_1=require(_0x3556a9(0x130)),tiktoken_1=require(_0x3556a9(0x118)),common_1=require(_0x3556a9(0x112)),uuid=require(_0x3556a9(0x138)),tokenizer=(0x0,tiktoken_1[_0x3556a9(0x127)])(_0x83d42c(0x1f2));function getFullUrl(_0x1865be){const _0x5f2e90=_0x83d42c,_0x587c41=_0x3556a9,_0x4e3192=_0x1865be[_0x5f2e90(0x1ff)]('/')?_0x1865be[_0x587c41(0x12a)](0x0,-0x1):_0x1865be,_0x468bee=_0x4e3192||_0x587c41(0x128);return _0x468bee+_0x587c41(0x12c);}async function sendMessageFromOpenAi(_0x1aeae4,_0x25a912,_0xc6cef6){const _0x3af266=_0x44f9,_0x26dab0=_0x83d42c,_0x24b3ca=_0x3556a9;var _0xdac6d,_0x36014e,_0xcca4f1,_0x12c257;const {onProgress:_0x912f94,maxToken:_0x94758b,apiKey:_0x8b96ce,model:_0x5dbb87,temperature:temperature=0.8,proxyUrl:_0xbef444,prompt:_0x3a9f62}=_0x25a912;if(_0x5dbb87[_0x24b3ca(0x141)]('dall')){let _0x2b6b99={'text':'','imageUrl':''};try{const _0x3f650e={'method':_0x24b3ca(0x13f),'url':_0xbef444+_0x24b3ca(0x113),'headers':{'Content-Type':_0x24b3ca(0x144),'Authorization':_0x24b3ca(0x11b)+_0x8b96ce},'data':{'prompt':_0x3a9f62,'model':_0x5dbb87,'response_format':_0x24b3ca(0x136)}},_0x49ec22=await(0x0,axios_1[_0x24b3ca(0x126)])(_0x3f650e),{b64_json:_0x12b444,revised_prompt:_0x7745d1}=_0x49ec22[_0x26dab0(0x1fd)][_0x24b3ca(0x125)][0x0],_0xd11da7=Buffer[_0x24b3ca(0x106)](_0x12b444,_0x3af266(0x144));let _0x570707='';try{const _0x2c53ad=uuid['v4']()[_0x24b3ca(0x12a)](0x0,0xa)+_0x24b3ca(0x116);common_1[_0x24b3ca(0x129)][_0x24b3ca(0xfc)](_0x24b3ca(0x109),_0x26dab0(0x220));const _0xc459ac=Buffer[_0x24b3ca(0x106)](_0x12b444,_0x24b3ca(0x117));_0x570707=await _0xc6cef6[_0x26dab0(0x1e2)]({'filename':_0x2c53ad,'buffer':_0xc459ac}),common_1[_0x24b3ca(0x129)][_0x26dab0(0x1f4)](_0x24b3ca(0x13c)+_0x570707,_0x24b3ca(0x13e));}catch(_0x153edc){common_1[_0x24b3ca(0x129)][_0x24b3ca(0x132)](_0x3af266(0x189)+_0x153edc,_0x24b3ca(0x13e));}return _0x2b6b99[_0x24b3ca(0x11f)]=_0x570707,_0x2b6b99[_0x26dab0(0x206)]=_0x7745d1,_0x912f94&&_0x912f94({'text':_0x2b6b99[_0x24b3ca(0x103)]}),_0x2b6b99;}catch(_0x15dd33){const _0x1cf5b0=((_0xdac6d=_0x15dd33===null||_0x15dd33===void 0x0?void 0x0:_0x15dd33[_0x24b3ca(0xfd)])===null||_0xdac6d===void 0x0?void 0x0:_0xdac6d[_0x24b3ca(0x135)])||0x1f4;console[_0x24b3ca(0x10c)](_0x26dab0(0x204),JSON[_0x24b3ca(0x12e)](_0x15dd33),_0x1cf5b0);const _0x4b47ca=(_0x12c257=(_0xcca4f1=(_0x36014e=_0x15dd33===null||_0x15dd33===void 0x0?void 0x0:_0x15dd33[_0x24b3ca(0xfd)])===null||_0x36014e===void 0x0?void 0x0:_0x36014e[_0x26dab0(0x1fd)])===null||_0xcca4f1===void 0x0?void 0x0:_0xcca4f1[_0x24b3ca(0x132)])===null||_0x12c257===void 0x0?void 0x0:_0x12c257[_0x24b3ca(0x104)];if(_0x1cf5b0===0x1ad)return _0x2b6b99[_0x3af266(0x14d)]=_0x24b3ca(0x10a),_0x2b6b99;if(_0x1cf5b0===0x190&&_0x4b47ca[_0x24b3ca(0x141)](_0x24b3ca(0xfa)))return _0x2b6b99[_0x24b3ca(0x103)]=_0x26dab0(0x228),_0x2b6b99;if(_0x1cf5b0===0x190&&_0x4b47ca[_0x24b3ca(0x141)](_0x24b3ca(0x11d)))return _0x2b6b99[_0x24b3ca(0x103)]=_0x26dab0(0x217),_0x2b6b99;if(_0x1cf5b0===0x1f4)return _0x2b6b99['text']=_0x24b3ca(0x120),_0x2b6b99;if(_0x1cf5b0===0x191)return _0x2b6b99[_0x24b3ca(0x103)]=_0x24b3ca(0x100),_0x2b6b99;return _0x2b6b99[_0x24b3ca(0x103)]=_0x24b3ca(0x12d),_0x2b6b99;}}else{let _0x8c2c2e={'text':''};const _0x50f4c2={'method':_0x24b3ca(0x13f),'url':getFullUrl(_0xbef444),'responseType':_0x24b3ca(0x139),'headers':{'Content-Type':_0x24b3ca(0x144),'Accept':_0x24b3ca(0x144),'Authorization':_0x24b3ca(0x11b)+_0x8b96ce},'data':{'stream':!![],'temperature':temperature,'model':_0x5dbb87,'messages':_0x1aeae4}};return _0x5dbb87===_0x24b3ca(0x10d)&&(_0x50f4c2[_0x24b3ca(0x125)][_0x24b3ca(0x13b)]=0x800),new Promise(async(_0x2fe7b8,_0x599ced)=>{const _0x4fa865=_0x26dab0,_0x43f02a=_0x24b3ca;try{const _0x49eddc=await(0x0,axios_1[_0x4fa865(0x219)])(_0x50f4c2),_0x407f13=_0x49eddc[_0x43f02a(0x125)];_0x407f13['on'](_0x43f02a(0x125),_0xd80cb8=>{const _0x46cf24=_0x44f9,_0x1e5c27=_0x4fa865,_0x30653a=_0x43f02a;var _0x134065;const _0x502cbf=_0xd80cb8[_0x30653a(0x102)]()[_0x1e5c27(0x200)]('\x0a\x0a')[_0x1e5c27(0x22d)](_0x402020=>_0x402020[_0x30653a(0x115)]()!=='');for(const _0x1f09b4 of _0x502cbf){const _0x5c78a5=_0x1f09b4['replace'](_0x30653a(0x12b),'');let _0x4f825e=![];try{_0x4f825e=JSON[_0x30653a(0x11c)](_0x5c78a5)[_0x30653a(0x134)][0x0][_0x1e5c27(0x1dc)]===_0x30653a(0x105);}catch(_0x306657){_0x4f825e=![];}if(_0x4f825e)return _0x8c2c2e[_0x1e5c27(0x206)]=_0x8c2c2e[_0x30653a(0x103)][_0x30653a(0x115)](),_0x8c2c2e;try{if(_0x5c78a5!==_0x30653a(0xff)&&_0x5c78a5!==_0x1e5c27(0x203)&&_0x5c78a5!=_0x30653a(0x124)){const _0x4fe48d=JSON[_0x1e5c27(0x224)](_0x5c78a5);_0x4fe48d['id']&&(_0x8c2c2e['id']=_0x4fe48d['id']);if((_0x134065=_0x4fe48d[_0x30653a(0x134)])===null||_0x134065===void 0x0?void 0x0:_0x134065[_0x30653a(0x131)]){const _0xc1d065=_0x4fe48d[_0x30653a(0x134)][0x0][_0x30653a(0x143)];_0x8c2c2e[_0x30653a(0x143)]=_0xc1d065[_0x30653a(0x121)];if(_0xc1d065===null||_0xc1d065===void 0x0?void 0x0:_0xc1d065[_0x30653a(0x121)])_0x8c2c2e[_0x30653a(0x103)]+=_0xc1d065[_0x30653a(0x121)];_0xc1d065[_0x1e5c27(0x22b)]&&(_0x8c2c2e[_0x46cf24(0x151)]=_0xc1d065[_0x30653a(0x111)]),_0x8c2c2e[_0x1e5c27(0x212)]=_0x4fe48d;}_0x912f94&&_0x912f94({'text':_0x8c2c2e[_0x1e5c27(0x206)]});}}catch(_0x38ea2b){console[_0x30653a(0x10c)](_0x30653a(0xfb),_0x5c78a5);}}});let _0x30cb62='';_0x1aeae4[_0x43f02a(0x13d)](_0x53cb9f=>{const _0x503f74=_0x43f02a;_0x30cb62+=_0x53cb9f[_0x503f74(0x121)]+'\x20';}),_0x407f13['on'](_0x43f02a(0x123),()=>{const _0x1d9cbf=_0x43f02a;if(_0x8c2c2e[_0x1d9cbf(0x108)]&&_0x8c2c2e[_0x1d9cbf(0x103)]){const _0x2f03f6=getTokenCount(_0x30cb62),_0x5ccc13=getTokenCount(_0x8c2c2e[_0x1d9cbf(0x103)]);_0x8c2c2e[_0x1d9cbf(0x108)][_0x1d9cbf(0x110)]={'prompt_tokens':_0x2f03f6,'completion_tokens':_0x5ccc13,'total_tokens':_0x2f03f6+_0x5ccc13,'estimated':!![]};}return _0x2fe7b8(_0x8c2c2e);});}catch(_0x1473de){_0x599ced(_0x1473de);}});}}function _0x5b23(){const _0x576399=_0x44f9,_0x4a8cdf=_0x83d42c,_0x13e93c=['axios',_0x4a8cdf(0x207),_0x4a8cdf(0x223),_0x4a8cdf(0x1e6),_0x4a8cdf(0x20e),_0x4a8cdf(0x1f9),_0x4a8cdf(0x231),_0x4a8cdf(0x215),'uuid',_0x576399(0x153),_0x4a8cdf(0x1e1),_0x4a8cdf(0x1ec),_0x576399(0x142),_0x4a8cdf(0x1ee),_0x4a8cdf(0x220),_0x4a8cdf(0x1de),'5681PYOAHr',_0x4a8cdf(0x1e4),_0x4a8cdf(0x22a),_0x576399(0x162),_0x4a8cdf(0x1ef),'2598415fTIGla',_0x576399(0x168),_0x4a8cdf(0x1e0),_0x4a8cdf(0x1fb),_0x4a8cdf(0x1eb),'debug',_0x4a8cdf(0x1fe),_0x4a8cdf(0x1f6),_0x4a8cdf(0x230),_0x4a8cdf(0x205),_0x4a8cdf(0x1fc),_0x4a8cdf(0x202),_0x4a8cdf(0x206),_0x4a8cdf(0x20c),_0x4a8cdf(0x225),_0x4a8cdf(0x21a),_0x4a8cdf(0x1e3),_0x4a8cdf(0x212),_0x4a8cdf(0x1f1),_0x4a8cdf(0x1e9),_0x576399(0x15c),_0x4a8cdf(0x20f),_0x4a8cdf(0x209),_0x4a8cdf(0x208),_0x576399(0x178),_0x4a8cdf(0x1f8),_0x4a8cdf(0x22b),_0x576399(0x12f),_0x576399(0x186),_0x576399(0x17d),_0x4a8cdf(0x216),_0x4a8cdf(0x227),_0x4a8cdf(0x20b),_0x4a8cdf(0x22f),_0x4a8cdf(0x1ed),_0x4a8cdf(0x229),_0x4a8cdf(0x21e),_0x4a8cdf(0x224),_0x4a8cdf(0x1e8),_0x576399(0x154),_0x4a8cdf(0x20a),_0x4a8cdf(0x1fa),_0x4a8cdf(0x214),_0x4a8cdf(0x1f7),_0x4a8cdf(0x221),_0x4a8cdf(0x1e7),_0x4a8cdf(0x1fd),_0x4a8cdf(0x219),_0x4a8cdf(0x1f3),_0x4a8cdf(0x211),_0x4a8cdf(0x21b),_0x4a8cdf(0x1f5),_0x4a8cdf(0x21d),_0x4a8cdf(0x1f0),_0x4a8cdf(0x21c),_0x4a8cdf(0x210),_0x4a8cdf(0x222)];return _0x5b23=function(){return _0x13e93c;},_0x5b23();}exports[_0x3556a9(0x10f)]=sendMessageFromOpenAi;function _0x15f9(){const _0x423401=_0x44f9,_0x4bb382=[_0x423401(0x161),'end',_0x423401(0x173),_0x423401(0x17e),_0x423401(0x132),_0x423401(0x138),_0x423401(0x184),_0x423401(0x152),'您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',_0x423401(0x148),_0x423401(0x15f),_0x423401(0x151),_0x423401(0x15b),_0x423401(0x134),_0x423401(0x13b),_0x423401(0x163),_0x423401(0x13c),_0x423401(0x171),_0x423401(0x176),_0x423401(0x14e),_0x423401(0x150),_0x423401(0x159),_0x423401(0x177),_0x423401(0x16b),_0x423401(0x169),'12279896txzxTm','includes',_0x423401(0x16a),_0x423401(0x16c),_0x423401(0x174),_0x423401(0x185),_0x423401(0x140),_0x423401(0x17b),'parse\x20Error','max_tokens',_0x423401(0x14f),_0x423401(0x147),_0x423401(0x15d),_0x423401(0x180),_0x423401(0x14c),_0x423401(0x16e),'get_encoding',_0x423401(0x175),_0x423401(0x182),_0x423401(0x160),'encode',_0x423401(0x165),_0x423401(0x157),_0x423401(0x135),_0x423401(0x13f),_0x423401(0x14a),_0x423401(0x13e),_0x423401(0x149),_0x423401(0x156),_0x423401(0x187),_0x423401(0x16d),_0x423401(0x146),_0x423401(0x141),_0x423401(0x167),_0x423401(0x130),'text','length',_0x423401(0x164),_0x423401(0x170),_0x423401(0x145),_0x423401(0x144),_0x423401(0x15e),'1091482iYJUhl',_0x423401(0x166),'log',_0x423401(0x143),_0x423401(0x183),_0x423401(0x139),'4389060gubRnR',_0x423401(0x188),_0x423401(0x133),_0x423401(0x17c),_0x423401(0x16f),_0x423401(0x158),_0x423401(0x172),_0x423401(0x13a),'Logger',_0x423401(0x14b),'data:',_0x423401(0x155),_0x423401(0x17a)];return _0x15f9=function(){return _0x4bb382;},_0x15f9();}function getTokenCount(_0x376914){const _0x4ca805=_0x3556a9;if(!_0x376914)return 0x0;return typeof _0x376914!==_0x4ca805(0x10e)&&(_0x376914=String(_0x376914)),_0x376914=_0x376914[_0x4ca805(0x12f)](/<\|endoftext\|>/g,''),tokenizer[_0x4ca805(0x122)](_0x376914)[_0x4ca805(0x131)];}function _0x3c4b(){const _0x4a2057=['7GiQUBO','trim','__esModule','error','5295073fNpOjC','/v1/chat/completions','1431438JDNOKY','slice','https://api.openai.com','138HEbdXV','Billing\x20hard\x20limit\x20has\x20been\x20reached','/v1/images/generations','split','content','上传图片过程中出现错误:\x20','8wxthpY','@nestjs/common','绘制图片失败，此次绘画被拒绝了！','1493174wGdtWG','parse','2358CpMsWN','filter','绘制图片失败，请检查你的提示词是否有非法描述！','4OYBGKp','17978850EnupGO','stop','detail','from','shift','\x20[DONE]','4087230wsFiCR','data','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','当前请求已过载、请稍等会儿再试试吧！','[DONE]','图片上传成功，URL:\x20','stringify','base64','imageUrl','toString','forEach','defineProperty','response','1746723HvzFXB','绘制图片失败，请稍后试试吧！','------>\x20开始上传图片！！！','text','7060144bodEcq','getTokenCount','POST','role','.png','stream','9ehHSwl','Bearer\x20','endsWith','status','30BZDZBt','push','376283zGedhI','3249423PuDYTX','90tCansH','application/json','message','1553146EAPGms','4yvHCGb','MidjourneyService','delta','@dqbd/tiktoken','string','usage','choices','openai-draw\x20error:\x20','199644cBpmqX','uploadFile','53995svEflV','3EzVWsh','25060rcAPzP','16026YpCJwf','cl100k_base','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','gpt-4-vision-preview','b64_json','default','replace','[DONE]\x20','debug','finish_reason','4056KgQObu','sendMessageFromOpenAi','4461126BXmuqL','217572meEmxK'];_0x3c4b=function(){return _0x4a2057;};return _0x3c4b();}function _0x5759(_0x14d61d,_0x34723b){const _0x55b39d=_0x5b23();return _0x5759=function(_0x16a88f,_0x3bd5d2){_0x16a88f=_0x16a88f-0xf9;let _0x4a3c8c=_0x55b39d[_0x16a88f];return _0x4a3c8c;},_0x5759(_0x14d61d,_0x34723b);}exports[_0x83d42c(0x1ed)]=getTokenCount;