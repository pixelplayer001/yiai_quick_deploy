'use strict';const _0x2ce00b=_0x4bdc;(function(_0x57c63e,_0x24258d){const _0x847b27=_0x4bdc,_0x5c8634=_0x57c63e();while(!![]){try{const _0x3137cc=-parseInt(_0x847b27(0x1df))/0x1+parseInt(_0x847b27(0x1e4))/0x2*(-parseInt(_0x847b27(0x1f1))/0x3)+-parseInt(_0x847b27(0x1fa))/0x4*(-parseInt(_0x847b27(0x1e1))/0x5)+-parseInt(_0x847b27(0x1f8))/0x6*(parseInt(_0x847b27(0x1fb))/0x7)+-parseInt(_0x847b27(0x1ea))/0x8*(-parseInt(_0x847b27(0x1f5))/0x9)+-parseInt(_0x847b27(0x200))/0xa+-parseInt(_0x847b27(0x211))/0xb*(-parseInt(_0x847b27(0x1da))/0xc);if(_0x3137cc===_0x24258d)break;else _0x5c8634['push'](_0x5c8634['shift']());}catch(_0x341e2a){_0x5c8634['push'](_0x5c8634['shift']());}}}(_0x4376,0x96732));const _0x40a48a=_0x227a;(function(_0x1bd03d,_0x11ce4d){const _0x4be510=_0x4bdc,_0x54f2f7=_0x227a,_0x4ad2a5=_0x1bd03d();while(!![]){try{const _0x3029f3=-parseInt(_0x54f2f7(0x100))/0x1*(-parseInt(_0x54f2f7(0x118))/0x2)+-parseInt(_0x54f2f7(0x10f))/0x3*(parseInt(_0x54f2f7(0x121))/0x4)+-parseInt(_0x54f2f7(0x114))/0x5*(parseInt(_0x54f2f7(0xfd))/0x6)+parseInt(_0x54f2f7(0x10e))/0x7*(parseInt(_0x54f2f7(0x116))/0x8)+-parseInt(_0x54f2f7(0x130))/0x9+-parseInt(_0x54f2f7(0x10a))/0xa*(parseInt(_0x54f2f7(0x11e))/0xb)+parseInt(_0x54f2f7(0x111))/0xc;if(_0x3029f3===_0x11ce4d)break;else _0x4ad2a5[_0x4be510(0x206)](_0x4ad2a5['shift']());}catch(_0x326de7){_0x4ad2a5[_0x4be510(0x206)](_0x4ad2a5[_0x4be510(0x1e0)]());}}}(_0x540d,0x40edb));function _0x227a(_0x35b5eb,_0x14162d){const _0x1aa5c4=_0x540d();return _0x227a=function(_0x1299df,_0xec9771){_0x1299df=_0x1299df-0xf6;let _0x501a69=_0x1aa5c4[_0x1299df];return _0x501a69;},_0x227a(_0x35b5eb,_0x14162d);}const _0x4f6d0b=_0x5b70;(function(_0x5805b7,_0x3c6f3b){const _0x1ab9ff=_0x4bdc,_0x3db46e=_0x227a,_0x4c2d75=_0x5b70,_0x3be79c=_0x5805b7();while(!![]){try{const _0x5b72ed=parseInt(_0x4c2d75(0xab))/0x1*(parseInt(_0x4c2d75(0xa5))/0x2)+-parseInt(_0x4c2d75(0xcc))/0x3+parseInt(_0x4c2d75(0xc7))/0x4+parseInt(_0x4c2d75(0xb7))/0x5+parseInt(_0x4c2d75(0xb0))/0x6+parseInt(_0x4c2d75(0xc6))/0x7*(parseInt(_0x4c2d75(0xc4))/0x8)+-parseInt(_0x4c2d75(0xa9))/0x9*(parseInt(_0x4c2d75(0xc3))/0xa);if(_0x5b72ed===_0x3c6f3b)break;else _0x3be79c[_0x3db46e(0xf7)](_0x3be79c[_0x1ab9ff(0x1e0)]());}catch(_0x54105a){_0x3be79c[_0x3db46e(0xf7)](_0x3be79c[_0x1ab9ff(0x1e0)]());}}}(_0x5cdd,0x4baa5));function _0x5b70(_0x4807e2,_0x17e421){const _0x4c2cfb=_0x5cdd();return _0x5b70=function(_0x2126a1,_0x210faf){_0x2126a1=_0x2126a1-0xa3;let _0x58b5c4=_0x4c2cfb[_0x2126a1];return _0x58b5c4;},_0x5b70(_0x4807e2,_0x17e421);}function _0x4bdc(_0x3d557d,_0x3ce4a2){const _0x43768a=_0x4376();return _0x4bdc=function(_0x4bdcfe,_0x183e60){_0x4bdcfe=_0x4bdcfe-0x1d4;let _0x523c70=_0x43768a[_0x4bdcfe];return _0x523c70;},_0x4bdc(_0x3d557d,_0x3ce4a2);}function _0x5cdd(){const _0x2c78d0=_0x4bdc,_0x456040=_0x227a,_0x18fc11=[_0x456040(0x108),_0x456040(0x124),_0x2c78d0(0x203),_0x456040(0x11c),_0x456040(0xfb),_0x2c78d0(0x219),_0x456040(0x12e),_0x2c78d0(0x1ec),_0x456040(0xf8),_0x2c78d0(0x20b),_0x2c78d0(0x1f7),_0x456040(0x125),_0x2c78d0(0x215),_0x2c78d0(0x20e),_0x456040(0x12c),_0x456040(0x117),_0x456040(0x103),_0x456040(0x110),_0x456040(0xf6),_0x2c78d0(0x218),_0x456040(0x11b),_0x456040(0x126),_0x456040(0x112),_0x456040(0x10b),_0x456040(0x104),_0x456040(0x122),_0x456040(0xfc),'24xdFLRH',_0x2c78d0(0x204),_0x456040(0x113),_0x456040(0x120),_0x456040(0xf7),_0x456040(0x10c),_0x456040(0x128),_0x456040(0x11d),_0x456040(0x12d),_0x456040(0xfa),_0x456040(0x106),_0x456040(0x105),_0x2c78d0(0x1f9),_0x2c78d0(0x1ee),_0x456040(0x11f),_0x456040(0x129),_0x456040(0x102),_0x456040(0x12f),_0x456040(0xfe),_0x456040(0x12b),_0x456040(0x123),_0x2c78d0(0x205),'47890klHgmg',_0x456040(0x109),'gemini-pro',_0x456040(0xf9)];return _0x5cdd=function(){return _0x18fc11;},_0x5cdd();}Object[_0x4f6d0b(0xbf)](exports,_0x4f6d0b(0xc5),{'value':!![]}),exports[_0x4f6d0b(0xcb)]=void 0x0;const uuid_1=require(_0x40a48a(0x115)),tiktoken_1=require(_0x4f6d0b(0xbb)),tokenizer=(0x0,tiktoken_1[_0x4f6d0b(0xc0)])(_0x40a48a(0x12a));function _0x540d(){const _0x74378f=_0x4bdc,_0x4afa40=[_0x74378f(0x202),_0x74378f(0x217),'namespace',_0x74378f(0x1f2),_0x74378f(0x1e6),_0x74378f(0x21d),'parentMessageId',_0x74378f(0x213),'getData','system',_0x74378f(0x20a),_0x74378f(0x1fe),'5461776gZgjjC',_0x74378f(0x21e),'30uLJVCP',_0x74378f(0x1de),_0x74378f(0x1dd),'encode',_0x74378f(0x1fc),'4203KkQjLr',_0x74378f(0x201),_0x74378f(0x1eb),_0x74378f(0x20d),_0x74378f(0x1f6),_0x74378f(0x208),_0x74378f(0x1e7),'45944pChemf',_0x74378f(0x1f4),'6ENiXXg',_0x74378f(0x21b),_0x74378f(0x1d9),_0x74378f(0x1d6),_0x74378f(0x210),_0x74378f(0x20f),_0x74378f(0x1ed),_0x74378f(0x1f0),_0x74378f(0x1e9),_0x74378f(0x1dc),_0x74378f(0x1ef),_0x74378f(0x212),_0x74378f(0x214),'gpt-4o',_0x74378f(0x1d4),_0x74378f(0x1d7),_0x74378f(0x1fd),_0x74378f(0x209),_0x74378f(0x1e3),_0x74378f(0x1d8),_0x74378f(0x1e2),'1474698ypfyjP',_0x74378f(0x21a),_0x74378f(0x20c),_0x74378f(0x1f3),_0x74378f(0x1ff),_0x74378f(0x206),_0x74378f(0x1e8),_0x74378f(0x216),_0x74378f(0x1e5),_0x74378f(0x1d5)];return _0x540d=function(){return _0x4afa40;},_0x540d();}class NineStore{constructor(_0x1512c6){const _0x471087=_0x4f6d0b,{store:_0x33ce30,namespace:_0x365734,expires:_0xc668ea}=this[_0x471087(0xc9)](_0x1512c6);this[_0x471087(0xa8)]=_0x33ce30,this[_0x471087(0xd6)]=_0x365734,this[_0x471087(0xc2)]=_0xc668ea;}[_0x4f6d0b(0xc9)](_0x1bdf02){const _0x30f642=_0x40a48a,{store:_0x7f1837,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x30f642(0x127)}=_0x1bdf02;return{'store':_0x7f1837,'namespace':namespace,'expires':expires};}[_0x40a48a(0x119)](_0x27a15d){const _0x3a79a8=_0x4bdc,_0x5f4315=_0x40a48a;return this[_0x5f4315(0xfe)]?this[_0x3a79a8(0x21c)]+'-'+_0x27a15d:_0x27a15d;}async[_0x40a48a(0x104)](_0x5aecde){const _0x624c0f=_0x4f6d0b,_0x232093=await this[_0x624c0f(0xa8)]['get'](_0x5aecde);return _0x232093;}async[_0x4f6d0b(0xb9)](_0x1228b8,_0xc5a325=this[_0x4f6d0b(0xc2)]){const _0x39664f=_0x4f6d0b;await this[_0x39664f(0xa8)][_0x39664f(0xb2)](_0x1228b8['id'],_0x1228b8,_0xc5a325);}async[_0x2ce00b(0x1db)](_0x4a6323,_0x1edd2f){const _0x24ac08=_0x2ce00b,_0xcfc060=_0x40a48a,_0x122dd9=_0x4f6d0b;let {maxRounds:_0x1d4752,maxModelToken:_0x5aca00,maxResponseTokens:_0x1840e6,systemMessage:systemMessage='',name:_0xd3df61,imageUrl:_0x1fb7d1,model:_0x3e0117,activeModel:_0x2bee36}=_0x1edd2f,{parentMessageId:_0x590a4e}=_0x1edd2f,_0x41a88f=[],_0xde7ea1=0x0;if(systemMessage){const _0x530490=[_0x122dd9(0xa7),_0x122dd9(0xa3),_0x122dd9(0xaf)],_0x3cdf1d=_0x2bee36&&_0x530490[_0x24ac08(0x207)](_0x42caa0=>_0x2bee36[_0xcfc060(0xf8)](_0x42caa0));_0x3cdf1d?(_0x41a88f[_0x122dd9(0xc8)]({'role':_0x122dd9(0xb8),'content':systemMessage,'name':_0xd3df61}),_0x41a88f[_0x122dd9(0xc8)]({'role':_0x122dd9(0xce),'content':'好的','name':_0xd3df61})):_0x41a88f[_0x122dd9(0xc8)]({'role':_0x122dd9(0xcf),'content':systemMessage,'name':_0xd3df61});}const _0xf51d5b=_0x41a88f[_0x122dd9(0xcd)];let _0x58c74f=0x0;const _0x1e2828=[_0x122dd9(0xbc),_0x122dd9(0xb4),_0x122dd9(0xa4)];if(_0x1e2828[_0x122dd9(0xb1)](_0x2bee36)&&_0x1fb7d1){const _0x468d0c=[{'type':_0xcfc060(0x128),'text':_0x4a6323},{'type':_0x122dd9(0xad),'image_url':{'url':_0x1fb7d1}}];_0x41a88f[_0x122dd9(0xc8)]({'role':_0xcfc060(0x117),'content':_0x468d0c,'name':_0xd3df61});}else{if(_0x1e2828[_0x122dd9(0xb1)](_0x2bee36)&&!_0x1fb7d1){const _0x2f83d0=[{'type':_0x24ac08(0x1fd),'text':_0x4a6323}];_0x41a88f[_0x122dd9(0xc8)]({'role':_0x122dd9(0xb8),'content':_0x2f83d0,'name':_0xd3df61});}else(_0x3e0117===_0x122dd9(0xaa)||_0x3e0117===_0xcfc060(0x101))&&_0x1fb7d1&&(_0x4a6323=_0x1fb7d1+'\x0a'+_0x4a6323),_0x41a88f[_0x122dd9(0xc8)]({'role':_0x122dd9(0xb8),'content':_0x4a6323,'name':_0xd3df61});}let _0x184881=_0x41a88f;do{if(!_0x590a4e)break;const _0x36a184=await this[_0x122dd9(0xc1)](_0x590a4e);if(!_0x36a184)break;const {text:_0x21fe74,name:_0x39ce97,role:_0x52bfa6,imageUrl:_0x56ddad}=_0x36a184;let _0x3ea9eb=_0x21fe74;if(_0x56ddad)_0x1e2828[_0xcfc060(0xf8)](_0x2bee36)&&(_0x52bfa6===_0x122dd9(0xce)?_0x3ea9eb=[{'type':_0x122dd9(0xca),'text':_0x21fe74}]:_0x3ea9eb=[{'type':_0x122dd9(0xca),'text':_0x21fe74},{'type':_0x122dd9(0xad),'image_url':{'url':_0x56ddad}}]);else!_0x56ddad&&_0x1e2828[_0x122dd9(0xb1)](_0x2bee36)&&(_0x3ea9eb=[{'type':_0x122dd9(0xca),'text':_0x21fe74}]);_0x184881=_0x184881[_0x122dd9(0xd3)](0x0,_0xf51d5b)[_0x122dd9(0xd2)]([{'role':_0x52bfa6,'content':_0x3ea9eb,'name':_0x39ce97},..._0x184881[_0x122dd9(0xd3)](_0xf51d5b)]),_0x58c74f++;if(_0x1d4752&&_0x58c74f>=_0x1d4752)break;if(_0x5aca00&&_0x1840e6){const _0x18459b=_0x5aca00-_0x1840e6;_0xde7ea1=await this[_0x122dd9(0xb6)](_0x184881);const _0x3401b2=_0xde7ea1+0xc8<=_0x18459b;!_0x3401b2&&(_0x184881=this[_0x122dd9(0xa6)](_0x184881,_0x18459b,systemMessage));}_0x590a4e=_0x36a184[_0x122dd9(0xd4)];}while(!![]);const _0x5d36b0=Math[_0x122dd9(0xd1)](0x1,Math[_0x122dd9(0xd7)](_0x5aca00-_0xde7ea1,_0x1840e6));return console[_0x122dd9(0xba)](_0xcfc060(0xff),_0x184881[_0x122dd9(0xcd)],_0xde7ea1),{'context':_0x184881,'round':_0x184881[_0x122dd9(0xcd)],'historyToken':_0xde7ea1};}[_0x4f6d0b(0xb6)](_0x4eb06e){const _0x53677e=_0x40a48a,_0x2d77db=_0x4f6d0b;let _0x580e20=_0x4eb06e[_0x53677e(0x11a)]((_0x163d10,_0x4a1de3)=>{const _0x2f88c7=_0x5b70;if(Array[_0x2f88c7(0xb3)](_0x4a1de3[_0x2f88c7(0xb5)])){const _0x32e572=_0x4a1de3[_0x2f88c7(0xb5)][_0x2f88c7(0xae)](_0x384839=>_0x384839[_0x2f88c7(0xd5)]===_0x2f88c7(0xca))[_0x2f88c7(0xbd)](_0x4d0636=>_0x4d0636[_0x2f88c7(0xca)])[_0x2f88c7(0xbe)]('\x20');return _0x163d10+_0x32e572;}else return _0x163d10+(_0x4a1de3[_0x2f88c7(0xb5)]||'');},'');return _0x580e20=_0x580e20[_0x2d77db(0xac)](/<\|endoftext\|>/g,''),tokenizer[_0x53677e(0x10d)](_0x580e20)[_0x2d77db(0xcd)];}[_0x4f6d0b(0xa6)](_0x2e1753,_0x3db6a8,_0x31fc0e){const _0x19403f=_0x2ce00b,_0x25133f=_0x4f6d0b,_0x88d05f=this[_0x19403f(0x20e)](_0x2e1753);if(_0x88d05f<=_0x3db6a8)return _0x2e1753;return _0x2e1753[_0x25133f(0xd0)](_0x31fc0e?0x1:0x0,0x1),this[_0x25133f(0xa6)](_0x2e1753,_0x3db6a8,_0x31fc0e);}[_0x40a48a(0x107)](){return(0x0,uuid_1['v4'])();}}function _0x4376(){const _0x59e0e5=['claude-3-5-sonnet-20240620','push','some','635gwTRWk','slice','assistant','set','type','defineProperty','_getTokenCount','NineStore','replace','15699563DztdEZ','ERNIE','setData','gpt-4-all','content','store','6342jdmKXZ','gpt-4-vision-preview','filter','hunyuan','generateKey','namespace','gpt-4o-all','_recursivePruning','join','image_url','map','chat','min','reduce','12JtzTLG','buildMessageFromParentMessageId','760ceimUK','formatOptions','get_encoding','669682OhhSZD','shift','25KiCutV','393430BQPRGA','cl100k_base','290uRgWJD','length','33739JFfCYT','uuid','includes','1294056fHmgqU','2056Syicqs','9719112TDsaDc','1865874raZJIe','1554432GNQXXc','max','expires','concat','2778SWSHVN','本次携带上下文的长度','1178577pSFHgH','user','19431KZpokw','672259QllAiD','isArray','1698RfwbXg','splice','118316HacSNS','9751HBDIJK','378GSkPWX','text','getUuid','@dqbd/tiktoken','3155780BZWjUN','log','10zrljvG','17oKvUxl','__esModule'];_0x4376=function(){return _0x59e0e5;};return _0x4376();}exports[_0x4f6d0b(0xcb)]=NineStore;