'use strict';const _0x40a48a=_0x227a;(function(_0x1fe8fe,_0x2945a3){const _0x54a425=_0x227a,_0x3294aa=_0x1fe8fe();while(!![]){try{const _0x4f5474=-parseInt(_0x54a425(0x100))/0x1*(-parseInt(_0x54a425(0x118))/0x2)+-parseInt(_0x54a425(0x10f))/0x3*(parseInt(_0x54a425(0x121))/0x4)+-parseInt(_0x54a425(0x114))/0x5*(parseInt(_0x54a425(0xfd))/0x6)+parseInt(_0x54a425(0x10e))/0x7*(parseInt(_0x54a425(0x116))/0x8)+-parseInt(_0x54a425(0x130))/0x9+-parseInt(_0x54a425(0x10a))/0xa*(parseInt(_0x54a425(0x11e))/0xb)+parseInt(_0x54a425(0x111))/0xc;if(_0x4f5474===_0x2945a3)break;else _0x3294aa['push'](_0x3294aa['shift']());}catch(_0x1557ff){_0x3294aa['push'](_0x3294aa['shift']());}}}(_0x540d,0x40edb));function _0x227a(_0x355e61,_0x169d0c){const _0x540d5b=_0x540d();return _0x227a=function(_0x227a5c,_0x334bcb){_0x227a5c=_0x227a5c-0xf6;let _0x554c0c=_0x540d5b[_0x227a5c];return _0x554c0c;},_0x227a(_0x355e61,_0x169d0c);}const _0x4f6d0b=_0x5b70;(function(_0x3d52d2,_0x52caeb){const _0x2550a2=_0x227a,_0x131faf=_0x5b70,_0x3deccc=_0x3d52d2();while(!![]){try{const _0x3931cd=parseInt(_0x131faf(0xab))/0x1*(parseInt(_0x131faf(0xa5))/0x2)+-parseInt(_0x131faf(0xcc))/0x3+parseInt(_0x131faf(0xc7))/0x4+parseInt(_0x131faf(0xb7))/0x5+parseInt(_0x131faf(0xb0))/0x6+parseInt(_0x131faf(0xc6))/0x7*(parseInt(_0x131faf(0xc4))/0x8)+-parseInt(_0x131faf(0xa9))/0x9*(parseInt(_0x131faf(0xc3))/0xa);if(_0x3931cd===_0x52caeb)break;else _0x3deccc[_0x2550a2(0xf7)](_0x3deccc['shift']());}catch(_0x11af7b){_0x3deccc[_0x2550a2(0xf7)](_0x3deccc['shift']());}}}(_0x5cdd,0x4baa5));function _0x5b70(_0x26a6ce,_0x215462){const _0x27d458=_0x5cdd();return _0x5b70=function(_0x2ba0a7,_0x43b5db){_0x2ba0a7=_0x2ba0a7-0xa3;let _0x52008f=_0x27d458[_0x2ba0a7];return _0x52008f;},_0x5b70(_0x26a6ce,_0x215462);}function _0x5cdd(){const _0x6ebe83=_0x227a,_0x180454=[_0x6ebe83(0x108),_0x6ebe83(0x124),'17oKvUxl',_0x6ebe83(0x11c),_0x6ebe83(0xfb),'filter',_0x6ebe83(0x12e),'1865874raZJIe',_0x6ebe83(0xf8),'set','isArray',_0x6ebe83(0x125),'content','_getTokenCount',_0x6ebe83(0x12c),_0x6ebe83(0x117),_0x6ebe83(0x103),_0x6ebe83(0x110),_0x6ebe83(0xf6),'gpt-4-vision-preview',_0x6ebe83(0x11b),_0x6ebe83(0x126),_0x6ebe83(0x112),_0x6ebe83(0x10b),_0x6ebe83(0x104),_0x6ebe83(0x122),_0x6ebe83(0xfc),'24xdFLRH','__esModule',_0x6ebe83(0x113),_0x6ebe83(0x120),_0x6ebe83(0xf7),_0x6ebe83(0x10c),_0x6ebe83(0x128),_0x6ebe83(0x11d),_0x6ebe83(0x12d),_0x6ebe83(0xfa),_0x6ebe83(0x106),_0x6ebe83(0x105),'splice','max',_0x6ebe83(0x11f),_0x6ebe83(0x129),_0x6ebe83(0x102),_0x6ebe83(0x12f),_0x6ebe83(0xfe),_0x6ebe83(0x12b),_0x6ebe83(0x123),'claude-3-5-sonnet-20240620','47890klHgmg',_0x6ebe83(0x109),'gemini-pro',_0x6ebe83(0xf9)];return _0x5cdd=function(){return _0x180454;},_0x5cdd();}Object[_0x4f6d0b(0xbf)](exports,_0x4f6d0b(0xc5),{'value':!![]}),exports[_0x4f6d0b(0xcb)]=void 0x0;const uuid_1=require(_0x40a48a(0x115)),tiktoken_1=require(_0x4f6d0b(0xbb)),tokenizer=(0x0,tiktoken_1[_0x4f6d0b(0xc0)])(_0x40a48a(0x12a));function _0x540d(){const _0x5f48a1=['10zrljvG','6342jdmKXZ','namespace','本次携带上下文的长度','33739JFfCYT','gpt-4o-all','parentMessageId','setData','getData','system','assistant','getUuid','5461776gZgjjC','_recursivePruning','30uLJVCP','get_encoding','formatOptions','encode','378GSkPWX','4203KkQjLr','log','9719112TDsaDc','defineProperty','672259QllAiD','635gwTRWk','uuid','45944pChemf','user','6ENiXXg','generateKey','reduce','map','replace','NineStore','1554432GNQXXc','concat','1294056fHmgqU','760ceimUK','expires','ERNIE','gpt-4-all','gpt-4o','join','chat','text','slice','cl100k_base','min','393430BQPRGA','1474698ypfyjP','hunyuan','type','1178577pSFHgH','@dqbd/tiktoken','push','includes','store','length','image_url'];_0x540d=function(){return _0x5f48a1;};return _0x540d();}class NineStore{constructor(_0x42c44a){const _0x1ce5cc=_0x4f6d0b,{store:_0x46e088,namespace:_0x439d43,expires:_0x143005}=this[_0x1ce5cc(0xc9)](_0x42c44a);this[_0x1ce5cc(0xa8)]=_0x46e088,this[_0x1ce5cc(0xd6)]=_0x439d43,this[_0x1ce5cc(0xc2)]=_0x143005;}[_0x4f6d0b(0xc9)](_0x55065f){const _0x254393=_0x40a48a,{store:_0x301d97,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x254393(0x127)}=_0x55065f;return{'store':_0x301d97,'namespace':namespace,'expires':expires};}[_0x40a48a(0x119)](_0x486438){const _0x1370a4=_0x40a48a;return this[_0x1370a4(0xfe)]?this['namespace']+'-'+_0x486438:_0x486438;}async[_0x40a48a(0x104)](_0xf07277){const _0x3fc139=_0x4f6d0b,_0x25c7e1=await this[_0x3fc139(0xa8)]['get'](_0xf07277);return _0x25c7e1;}async[_0x4f6d0b(0xb9)](_0x3de38c,_0x487e6b=this[_0x4f6d0b(0xc2)]){const _0x325930=_0x4f6d0b;await this[_0x325930(0xa8)][_0x325930(0xb2)](_0x3de38c['id'],_0x3de38c,_0x487e6b);}async['buildMessageFromParentMessageId'](_0x2c6004,_0x21ce8e){const _0x489d00=_0x40a48a,_0xdc4208=_0x4f6d0b;let {maxRounds:_0x7056ed,maxModelToken:_0x166294,maxResponseTokens:_0x55895d,systemMessage:systemMessage='',name:_0x242fce,imageUrl:_0x2aac55,model:_0x5a6675,activeModel:_0x5be3da}=_0x21ce8e,{parentMessageId:_0x35fdf3}=_0x21ce8e,_0x1f2131=[],_0x347eaa=0x0;if(systemMessage){const _0x7caf57=[_0xdc4208(0xa7),_0xdc4208(0xa3),_0xdc4208(0xaf)],_0x22ca47=_0x5be3da&&_0x7caf57['some'](_0x5900a3=>_0x5be3da[_0x489d00(0xf8)](_0x5900a3));_0x22ca47?(_0x1f2131[_0xdc4208(0xc8)]({'role':_0xdc4208(0xb8),'content':systemMessage,'name':_0x242fce}),_0x1f2131[_0xdc4208(0xc8)]({'role':_0xdc4208(0xce),'content':'好的','name':_0x242fce})):_0x1f2131[_0xdc4208(0xc8)]({'role':_0xdc4208(0xcf),'content':systemMessage,'name':_0x242fce});}const _0x3b8ea4=_0x1f2131[_0xdc4208(0xcd)];let _0x3e8204=0x0;const _0x12e9fe=[_0xdc4208(0xbc),_0xdc4208(0xb4),_0xdc4208(0xa4)];if(_0x12e9fe[_0xdc4208(0xb1)](_0x5be3da)&&_0x2aac55){const _0x13a1f3=[{'type':_0x489d00(0x128),'text':_0x2c6004},{'type':_0xdc4208(0xad),'image_url':{'url':_0x2aac55}}];_0x1f2131[_0xdc4208(0xc8)]({'role':_0x489d00(0x117),'content':_0x13a1f3,'name':_0x242fce});}else{if(_0x12e9fe[_0xdc4208(0xb1)](_0x5be3da)&&!_0x2aac55){const _0x5d538b=[{'type':'text','text':_0x2c6004}];_0x1f2131[_0xdc4208(0xc8)]({'role':_0xdc4208(0xb8),'content':_0x5d538b,'name':_0x242fce});}else(_0x5a6675===_0xdc4208(0xaa)||_0x5a6675===_0x489d00(0x101))&&_0x2aac55&&(_0x2c6004=_0x2aac55+'\x0a'+_0x2c6004),_0x1f2131[_0xdc4208(0xc8)]({'role':_0xdc4208(0xb8),'content':_0x2c6004,'name':_0x242fce});}let _0x20ddc8=_0x1f2131;do{if(!_0x35fdf3)break;const _0x5ac3da=await this[_0xdc4208(0xc1)](_0x35fdf3);if(!_0x5ac3da)break;const {text:_0x4d7fb4,name:_0x2b2ea5,role:_0x25e6c9,imageUrl:_0x435549}=_0x5ac3da;let _0x433e26=_0x4d7fb4;if(_0x435549)_0x12e9fe[_0x489d00(0xf8)](_0x5be3da)&&(_0x25e6c9===_0xdc4208(0xce)?_0x433e26=[{'type':_0xdc4208(0xca),'text':_0x4d7fb4}]:_0x433e26=[{'type':_0xdc4208(0xca),'text':_0x4d7fb4},{'type':_0xdc4208(0xad),'image_url':{'url':_0x435549}}]);else!_0x435549&&_0x12e9fe[_0xdc4208(0xb1)](_0x5be3da)&&(_0x433e26=[{'type':_0xdc4208(0xca),'text':_0x4d7fb4}]);_0x20ddc8=_0x20ddc8[_0xdc4208(0xd3)](0x0,_0x3b8ea4)[_0xdc4208(0xd2)]([{'role':_0x25e6c9,'content':_0x433e26,'name':_0x2b2ea5},..._0x20ddc8[_0xdc4208(0xd3)](_0x3b8ea4)]),_0x3e8204++;if(_0x7056ed&&_0x3e8204>=_0x7056ed)break;if(_0x166294&&_0x55895d){const _0x2081f7=_0x166294-_0x55895d;_0x347eaa=await this[_0xdc4208(0xb6)](_0x20ddc8);const _0x182e51=_0x347eaa+0xc8<=_0x2081f7;!_0x182e51&&(_0x20ddc8=this[_0xdc4208(0xa6)](_0x20ddc8,_0x2081f7,systemMessage));}_0x35fdf3=_0x5ac3da[_0xdc4208(0xd4)];}while(!![]);const _0x565902=Math[_0xdc4208(0xd1)](0x1,Math[_0xdc4208(0xd7)](_0x166294-_0x347eaa,_0x55895d));return console[_0xdc4208(0xba)](_0x489d00(0xff),_0x20ddc8[_0xdc4208(0xcd)],_0x347eaa),{'context':_0x20ddc8,'round':_0x20ddc8[_0xdc4208(0xcd)],'historyToken':_0x347eaa};}[_0x4f6d0b(0xb6)](_0x5727d9){const _0x1b1e3e=_0x40a48a,_0x467d61=_0x4f6d0b;let _0x184081=_0x5727d9[_0x1b1e3e(0x11a)]((_0x2ab011,_0x315328)=>{const _0x2395d8=_0x5b70;if(Array[_0x2395d8(0xb3)](_0x315328[_0x2395d8(0xb5)])){const _0x47f410=_0x315328[_0x2395d8(0xb5)][_0x2395d8(0xae)](_0x3de92f=>_0x3de92f[_0x2395d8(0xd5)]===_0x2395d8(0xca))[_0x2395d8(0xbd)](_0x41b870=>_0x41b870[_0x2395d8(0xca)])[_0x2395d8(0xbe)]('\x20');return _0x2ab011+_0x47f410;}else return _0x2ab011+(_0x315328[_0x2395d8(0xb5)]||'');},'');return _0x184081=_0x184081[_0x467d61(0xac)](/<\|endoftext\|>/g,''),tokenizer[_0x1b1e3e(0x10d)](_0x184081)[_0x467d61(0xcd)];}[_0x4f6d0b(0xa6)](_0x58c8cb,_0x4c8430,_0x339e04){const _0x3bf6ea=_0x4f6d0b,_0x195dc3=this['_getTokenCount'](_0x58c8cb);if(_0x195dc3<=_0x4c8430)return _0x58c8cb;return _0x58c8cb[_0x3bf6ea(0xd0)](_0x339e04?0x1:0x0,0x1),this[_0x3bf6ea(0xa6)](_0x58c8cb,_0x4c8430,_0x339e04);}[_0x40a48a(0x107)](){return(0x0,uuid_1['v4'])();}}exports[_0x4f6d0b(0xcb)]=NineStore;