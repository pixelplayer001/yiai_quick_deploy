'use strict';const _0xcb4d42=_0x2fcb;(function(_0x8f0b0b,_0x24e466){const _0x5513d5=_0x2fcb,_0x154dd8=_0x8f0b0b();while(!![]){try{const _0x2ef1b7=parseInt(_0x5513d5(0x170))/0x1+parseInt(_0x5513d5(0x151))/0x2+-parseInt(_0x5513d5(0x162))/0x3*(parseInt(_0x5513d5(0xce))/0x4)+parseInt(_0x5513d5(0xc2))/0x5*(-parseInt(_0x5513d5(0xf4))/0x6)+parseInt(_0x5513d5(0xa6))/0x7*(parseInt(_0x5513d5(0x10c))/0x8)+-parseInt(_0x5513d5(0xf2))/0x9*(-parseInt(_0x5513d5(0x14e))/0xa)+-parseInt(_0x5513d5(0xf8))/0xb;if(_0x2ef1b7===_0x24e466)break;else _0x154dd8['push'](_0x154dd8['shift']());}catch(_0x46137e){_0x154dd8['push'](_0x154dd8['shift']());}}}(_0x2fe1,0xe1be4));const _0x14868a=_0x1c31;(function(_0xfeb330,_0x11ddfc){const _0xb3e66a=_0x2fcb,_0x4e7c6f=_0x1c31,_0x303faa=_0xfeb330();while(!![]){try{const _0x584110=-parseInt(_0x4e7c6f(0x180))/0x1*(-parseInt(_0x4e7c6f(0x1bb))/0x2)+parseInt(_0x4e7c6f(0x1c3))/0x3*(-parseInt(_0x4e7c6f(0x23c))/0x4)+-parseInt(_0x4e7c6f(0x24f))/0x5*(-parseInt(_0x4e7c6f(0x255))/0x6)+-parseInt(_0x4e7c6f(0x223))/0x7+-parseInt(_0x4e7c6f(0x197))/0x8+-parseInt(_0x4e7c6f(0x266))/0x9+-parseInt(_0x4e7c6f(0x173))/0xa*(-parseInt(_0x4e7c6f(0x1f2))/0xb);if(_0x584110===_0x11ddfc)break;else _0x303faa['push'](_0x303faa['shift']());}catch(_0x18210d){_0x303faa[_0xb3e66a(0xae)](_0x303faa[_0xb3e66a(0x12a)]());}}}(_0x1ebf,0xd2f34));function _0x1ebf(){const _0xaf1bea=_0x2fcb,_0x373d13=[_0xaf1bea(0x135),_0xaf1bea(0xb9),_0xaf1bea(0xeb),_0xaf1bea(0x104),'当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',_0xaf1bea(0x12d),_0xaf1bea(0x13b),_0xaf1bea(0x14a),_0xaf1bea(0x97),'validateBalance',_0xaf1bea(0x157),_0xaf1bea(0xef),_0xaf1bea(0x186),'userService',_0xaf1bea(0xde),_0xaf1bea(0x12c),'detail',_0xaf1bea(0x173),_0xaf1bea(0xe5),_0xaf1bea(0xb6),'abortController','当前模型不是聊天模型',_0xaf1bea(0x181),_0xaf1bea(0x167),'setChatBox',_0xaf1bea(0xea),_0xaf1bea(0xee),_0xaf1bea(0x100),'appInfo',_0xaf1bea(0xf3),'typeorm',_0xaf1bea(0xc0),_0xaf1bea(0xed),_0xaf1bea(0x9f),'32k','Catch\x20Error\x20','服务异常、请重新试试吧！！！',_0xaf1bea(0x183),_0xaf1bea(0x14b),_0xaf1bea(0xc9),_0xaf1bea(0xfe),'112vQyNKj','sendMessageFromZhipu','update',_0xaf1bea(0xa2),_0xaf1bea(0xd4),_0xaf1bea(0x174),_0xaf1bea(0xfd),'draw',_0xaf1bea(0x127),'whiteListUser','from',_0xaf1bea(0xa8),_0xaf1bea(0xd0),'dall',_0xaf1bea(0xdd),_0xaf1bea(0x95),_0xaf1bea(0xcb),_0xaf1bea(0x164),_0xaf1bea(0xd9),_0xaf1bea(0x16d),_0xaf1bea(0x13a),'6771358lKOMSP','findOne',_0xaf1bea(0x17e),_0xaf1bea(0x119),_0xaf1bea(0x102),_0xaf1bea(0x16b),_0xaf1bea(0xe6),_0xaf1bea(0x15b),_0xaf1bea(0x161),_0xaf1bea(0xe7),'Content-type','object',_0xaf1bea(0x124),'keyv',_0xaf1bea(0x141),_0xaf1bea(0x12b),_0xaf1bea(0x190),_0xaf1bea(0xdb),_0xaf1bea(0x15c),_0xaf1bea(0xff),'当前请求已过载、请稍等会儿再试试吧！',_0xaf1bea(0x149),_0xaf1bea(0xfc),'statusText:',_0xaf1bea(0xf6),_0xaf1bea(0xd8),_0xaf1bea(0x155),_0xaf1bea(0xaa),_0xaf1bea(0x198),_0xaf1bea(0x116),_0xaf1bea(0xbd),_0xaf1bea(0x18e),_0xaf1bea(0x156),'env',_0xaf1bea(0x14c),'forEach','removeSpecialCharacters','checkAutoReply',_0xaf1bea(0x12a),_0xaf1bea(0x11e),_0xaf1bea(0x10b),_0xaf1bea(0x105),_0xaf1bea(0xb0),_0xaf1bea(0x10f),_0xaf1bea(0x15a),'@nestjs/common',_0xaf1bea(0x194),_0xaf1bea(0x197),_0xaf1bea(0xda),_0xaf1bea(0xb5),_0xaf1bea(0x17d),_0xaf1bea(0xbe),_0xaf1bea(0xcf),'\x20模型名称:\x20',_0xaf1bea(0x122),'./chatPre.entity',_0xaf1bea(0xc6),_0xaf1bea(0xc4),_0xaf1bea(0xa5),_0xaf1bea(0x9a),_0xaf1bea(0x110),'buildMessageFromParentMessageId',_0xaf1bea(0x195),_0xaf1bea(0xc8),_0xaf1bea(0xb3),_0xaf1bea(0x18a),_0xaf1bea(0xf1),'./helper',_0xaf1bea(0x163),'chatPreTypeEntity',_0xaf1bea(0x117),_0xaf1bea(0x175),_0xaf1bea(0x146),'is_end',_0xaf1bea(0xcd),_0xaf1bea(0x120),_0xaf1bea(0x112),_0xaf1bea(0x16a),_0xaf1bea(0x94),_0xaf1bea(0xec),'__param',_0xaf1bea(0xe9),_0xaf1bea(0x115),_0xaf1bea(0xb2),_0xaf1bea(0x182),_0xaf1bea(0x150),_0xaf1bea(0x192),_0xaf1bea(0x121),'openaiModel4MaxTokens32kRes','unifiedFormattingResponse','compileNetwork','systemMessage',_0xaf1bea(0x199),'10oGyGtu','./baidu',_0xaf1bea(0x136),_0xaf1bea(0xd7),_0xaf1bea(0x18b),_0xaf1bea(0x9c),_0xaf1bea(0x142),'checkBadWords',_0xaf1bea(0xe0),_0xaf1bea(0x13e),_0xaf1bea(0xd6),_0xaf1bea(0x128),_0xaf1bea(0x159),'chat-error\x20<----------------------------------------->',_0xaf1bea(0x144),'push',_0xaf1bea(0xe3),_0xaf1bea(0xac),'ChatBoxEntity',_0xaf1bea(0xd1),'当前分类下有未处理数据不可移除！',_0xaf1bea(0x166),_0xaf1bea(0x193),_0xaf1bea(0xcc),'appEntity',_0xaf1bea(0xf7),'fanyiService',_0xaf1bea(0xe2),_0xaf1bea(0x180),_0xaf1bea(0x111),_0xaf1bea(0x140),_0xaf1bea(0x153),_0xaf1bea(0x16f),_0xaf1bea(0x152),'openaiBaseUrl',_0xaf1bea(0x11f),_0xaf1bea(0xbf),_0xaf1bea(0x185),'getCurrentModelKeyInfo',_0xaf1bea(0xd3),_0xaf1bea(0x10e),_0xaf1bea(0x160),_0xaf1bea(0x9d),_0xaf1bea(0x11c),_0xaf1bea(0xca),_0xaf1bea(0x126),_0xaf1bea(0x113),_0xaf1bea(0xe4),'modelInfo',_0xaf1bea(0x14d),_0xaf1bea(0xf9),_0xaf1bea(0x13c),'10qyCMZw',_0xaf1bea(0x145),_0xaf1bea(0x123),_0xaf1bea(0x148),_0xaf1bea(0xf5),_0xaf1bea(0x187),_0xaf1bea(0x171),_0xaf1bea(0x11a),_0xaf1bea(0x114),'绘制图片失败，请检查你的提示词是否有非法描述！',_0xaf1bea(0x99),'toLowerCase',_0xaf1bea(0xa7),'1241543pSJjuH','assign','__esModule',_0xaf1bea(0x101),'onModuleInit',_0xaf1bea(0x10a),_0xaf1bea(0xd2),_0xaf1bea(0xbc),'PAYMENT_REQUIRED','conversationId',_0xaf1bea(0x18c),_0xaf1bea(0x129),_0xaf1bea(0x98),'AppEntity',_0xaf1bea(0xa3),_0xaf1bea(0x17a),_0xaf1bea(0x137),_0xaf1bea(0x17f),_0xaf1bea(0xba),_0xaf1bea(0x125),_0xaf1bea(0x168),_0xaf1bea(0x107),_0xaf1bea(0x196),_0xaf1bea(0x17c),_0xaf1bea(0x176),'default',_0xaf1bea(0xd5),_0xaf1bea(0xdf),'用户ID:\x20',_0xaf1bea(0x14f),_0xaf1bea(0x138),_0xaf1bea(0xc5),_0xaf1bea(0x9b),_0xaf1bea(0x134),'uploadFile',_0xaf1bea(0xc3),_0xaf1bea(0x188),'getUuid',_0xaf1bea(0x10d),_0xaf1bea(0x179),_0xaf1bea(0xa1),_0xaf1bea(0xe8),'./chatBoxType.entity',_0xaf1bea(0x15e),_0xaf1bea(0x154),_0xaf1bea(0x16e),_0xaf1bea(0x13f),_0xaf1bea(0x131),_0xaf1bea(0xc7),'queryChatPre',_0xaf1bea(0x12e),_0xaf1bea(0xb1)];return _0x1ebf=function(){return _0x373d13;},_0x1ebf();}const _0x42605f=_0xc40d;(function(_0xee5a64,_0x1ce7da){const _0x714ac4=_0x1c31,_0x5040ec=_0xc40d,_0xec2100=_0xee5a64();while(!![]){try{const _0x1b9fdd=parseInt(_0x5040ec(0x165))/0x1+parseInt(_0x5040ec(0x1f4))/0x2*(parseInt(_0x5040ec(0x202))/0x3)+parseInt(_0x5040ec(0x139))/0x4+parseInt(_0x5040ec(0x1fb))/0x5+parseInt(_0x5040ec(0x15d))/0x6+parseInt(_0x5040ec(0x129))/0x7*(-parseInt(_0x5040ec(0x163))/0x8)+-parseInt(_0x5040ec(0x1f5))/0x9*(parseInt(_0x5040ec(0x17d))/0xa);if(_0x1b9fdd===_0x1ce7da)break;else _0xec2100[_0x714ac4(0x25e)](_0xec2100[_0x714ac4(0x218)]());}catch(_0x244fdb){_0xec2100[_0x714ac4(0x25e)](_0xec2100[_0x714ac4(0x218)]());}}}(_0x42c4,0x20595));function _0xc40d(_0x30a283,_0x2a29c1){const _0x20a6a2=_0x42c4();return _0xc40d=function(_0x1772e2,_0x307f5a){_0x1772e2=_0x1772e2-0xfc;let _0xf0b7c4=_0x20a6a2[_0x1772e2];return _0xf0b7c4;},_0xc40d(_0x30a283,_0x2a29c1);}function _0x2fcb(_0x29bfd8,_0x75dab9){const _0x2fe11c=_0x2fe1();return _0x2fcb=function(_0x2fcb42,_0x412246){_0x2fcb42=_0x2fcb42-0x94;let _0x5440dc=_0x2fe11c[_0x2fcb42];return _0x5440dc;},_0x2fcb(_0x29bfd8,_0x75dab9);}var __decorate=this&&this[_0x42605f(0x159)]||function(_0x3dd733,_0x23024f,_0x55b4d1,_0x256097){const _0x102e08=_0x2fcb,_0xb1db06=_0x1c31,_0x185554=_0x42605f;var _0x3404b3=arguments[_0xb1db06(0x19b)],_0x9d2d01=_0x3404b3<0x3?_0x23024f:_0x256097===null?_0x256097=Object[_0x185554(0x1b0)](_0x23024f,_0x55b4d1):_0x256097,_0x20ab46;if(typeof Reflect===_0x185554(0x1de)&&typeof Reflect[_0x185554(0x1ea)]===_0x102e08(0x16a))_0x9d2d01=Reflect[_0x185554(0x1ea)](_0x3dd733,_0x23024f,_0x55b4d1,_0x256097);else{for(var _0x2487cb=_0x3dd733[_0x185554(0x13a)]-0x1;_0x2487cb>=0x0;_0x2487cb--)if(_0x20ab46=_0x3dd733[_0x2487cb])_0x9d2d01=(_0x3404b3<0x3?_0x20ab46(_0x9d2d01):_0x3404b3>0x3?_0x20ab46(_0x23024f,_0x55b4d1,_0x9d2d01):_0x20ab46(_0x23024f,_0x55b4d1))||_0x9d2d01;}return _0x3404b3>0x3&&_0x9d2d01&&Object[_0x185554(0x1c2)](_0x23024f,_0x55b4d1,_0x9d2d01),_0x9d2d01;},__metadata=this&&this[_0x42605f(0x131)]||function(_0x37639b,_0xffd00b){const _0x2863eb=_0x42605f;if(typeof Reflect===_0x2863eb(0x1de)&&typeof Reflect[_0x2863eb(0x1d6)]===_0x2863eb(0x171))return Reflect[_0x2863eb(0x1d6)](_0x37639b,_0xffd00b);},__param=this&&this[_0x14868a(0x242)]||function(_0x238c4c,_0x3dd13a){return function(_0x320049,_0x1f65c0){_0x3dd13a(_0x320049,_0x1f65c0,_0x238c4c);};};function _0x42c4(){const _0x4e2b75=_0x2fcb,_0x5f59cd=_0x14868a,_0x40d287=[_0x4e2b75(0x13d),_0x5f59cd(0x205),_0x4e2b75(0xfb),_0x5f59cd(0x1d6),_0x5f59cd(0x1c1),_0x5f59cd(0x220),_0x4e2b75(0xbb),_0x5f59cd(0x1d7),_0x5f59cd(0x261),_0x5f59cd(0x257),_0x5f59cd(0x19c),_0x4e2b75(0x11b),_0x5f59cd(0x18d),'ceil',_0x5f59cd(0x185),_0x5f59cd(0x238),_0x5f59cd(0x1ab),_0x5f59cd(0x1a7),_0x5f59cd(0x20c),_0x5f59cd(0x1a1),_0x4e2b75(0x184),_0x5f59cd(0x198),_0x5f59cd(0x25d),_0x5f59cd(0x23b),_0x5f59cd(0x1d5),_0x5f59cd(0x26e),'https://api.openai.com',_0x5f59cd(0x273),_0x4e2b75(0xdc),_0x4e2b75(0x132),_0x5f59cd(0x19e),_0x5f59cd(0x21c),_0x5f59cd(0x1b4),_0x5f59cd(0x25c),_0x4e2b75(0x96),_0x5f59cd(0x1dd),_0x5f59cd(0x16c),_0x5f59cd(0x1ca),_0x5f59cd(0x236),_0x5f59cd(0x1ce),_0x5f59cd(0x25f),_0x5f59cd(0x168),_0x5f59cd(0x194),_0x5f59cd(0x1eb),'../../common/constants/errorMessage.constant',_0x4e2b75(0xa0),_0x4e2b75(0x118),_0x5f59cd(0x1f7),_0x5f59cd(0x165),_0x5f59cd(0x23f),_0x4e2b75(0x178),_0x5f59cd(0x25a),_0x4e2b75(0x191),_0x5f59cd(0x190),_0x5f59cd(0x248),_0x5f59cd(0x176),_0x5f59cd(0x21d),_0x5f59cd(0x17a),_0x5f59cd(0x1e0),_0x5f59cd(0x1e5),_0x5f59cd(0x243),_0x5f59cd(0x202),_0x5f59cd(0x22d),_0x5f59cd(0x225),_0x4e2b75(0x169),_0x4e2b75(0x12f),_0x5f59cd(0x1f8),_0x4e2b75(0xaf),_0x5f59cd(0x256),_0x5f59cd(0x1c0),_0x5f59cd(0x199),_0x5f59cd(0x1ec),_0x5f59cd(0x252),_0x5f59cd(0x217),_0x5f59cd(0x20b),_0x5f59cd(0x1e4),_0x5f59cd(0x1b9),_0x5f59cd(0x18b),_0x5f59cd(0x1a8),_0x5f59cd(0x214),_0x4e2b75(0x189),_0x5f59cd(0x200),_0x5f59cd(0x22f),_0x5f59cd(0x1ff),_0x5f59cd(0x1ae),_0x5f59cd(0x16a),_0x5f59cd(0x201),_0x5f59cd(0x16d),_0x4e2b75(0xcb),_0x5f59cd(0x213),_0x5f59cd(0x170),_0x5f59cd(0x16b),_0x5f59cd(0x1c6),_0x5f59cd(0x251),_0x5f59cd(0x169),_0x5f59cd(0x1f3),_0x5f59cd(0x244),_0x5f59cd(0x210),_0x5f59cd(0x20d),_0x4e2b75(0x175),_0x4e2b75(0xb8),_0x4e2b75(0x15d),_0x5f59cd(0x1d8),_0x4e2b75(0x197),_0x4e2b75(0x130),_0x5f59cd(0x1f9),_0x5f59cd(0x1e3),_0x5f59cd(0x1bf),'standard','quality',_0x5f59cd(0x1a0),_0x5f59cd(0x1e6),_0x5f59cd(0x18e),_0x5f59cd(0x1cc),_0x5f59cd(0x189),'getMaxTokenFromModelWithOpenAi',_0x5f59cd(0x19d),_0x5f59cd(0x249),_0x5f59cd(0x269),_0x5f59cd(0x1cd),_0x5f59cd(0x1c9),_0x5f59cd(0x21b),_0x5f59cd(0x19a),_0x4e2b75(0x125),_0x5f59cd(0x16f),_0x5f59cd(0x237),_0x5f59cd(0x1dc),_0x5f59cd(0x1b7),_0x5f59cd(0x1c5),_0x5f59cd(0x1e2),_0x5f59cd(0x245),_0x5f59cd(0x233),_0x4e2b75(0x165),'当前Key余额已不足、请重新再试一次吧！',_0x5f59cd(0x17f),_0x4e2b75(0xa4),'ConfigEntity',_0x5f59cd(0x1ef),_0x5f59cd(0x1aa),_0x5f59cd(0x24d),_0x5f59cd(0x21a),_0x4e2b75(0x158),'ChatgptService',_0x4e2b75(0x198),_0x5f59cd(0x22a),'./openai',_0x5f59cd(0x1ad),_0x5f59cd(0x1b1),_0x5f59cd(0x240),_0x4e2b75(0x15c),_0x5f59cd(0x246),_0x5f59cd(0x1e9),_0x4e2b75(0xfa),_0x5f59cd(0x228),'PAINT_TYPE',_0x5f59cd(0x271),'../globalConfig/config.entity',_0x5f59cd(0x23a),_0x5f59cd(0x1fd),_0x5f59cd(0x226),_0x5f59cd(0x1e8),_0x4e2b75(0x18d),_0x5f59cd(0x1fc),_0x5f59cd(0x1c4),_0x5f59cd(0x234),_0x5f59cd(0x211),_0x5f59cd(0x1e7),_0x5f59cd(0x216),_0x5f59cd(0x19f),_0x5f59cd(0x1a2),_0x5f59cd(0x18c),_0x5f59cd(0x1d2),_0x5f59cd(0x25e),_0x5f59cd(0x259),_0x5f59cd(0x174),_0x5f59cd(0x24c),_0x4e2b75(0x139),_0x5f59cd(0x212),_0x5f59cd(0x166),'validateBalance',_0x5f59cd(0x177),_0x5f59cd(0x219),_0x5f59cd(0x20a),_0x5f59cd(0x1a6),_0x4e2b75(0x18b),_0x5f59cd(0x184),_0x4e2b75(0x9e),_0x5f59cd(0x17b),'lockKey',_0x5f59cd(0x1a9),_0x5f59cd(0x265),_0x5f59cd(0x22e),_0x4e2b75(0xad),_0x4e2b75(0x133),_0x5f59cd(0x1ac),'queryChatBox',_0x5f59cd(0x17c),_0x5f59cd(0x21f),_0x5f59cd(0x230),'chatgpt-ai-web',_0x5f59cd(0x1b3),_0x5f59cd(0x1de),_0x5f59cd(0x1f4),_0x5f59cd(0x1be),'appEntity',_0x5f59cd(0x264),_0x5f59cd(0x178),_0x5f59cd(0x268),_0x5f59cd(0x1ee),_0x5f59cd(0x167),_0x5f59cd(0x1fb),_0x5f59cd(0x1f6),_0x5f59cd(0x1ea),_0x5f59cd(0x1d1),_0x5f59cd(0x26a),_0x5f59cd(0x196),_0x5f59cd(0x23d),_0x5f59cd(0x260),_0x5f59cd(0x1ba),_0x5f59cd(0x209),'statusCode',_0x5f59cd(0x192),_0x5f59cd(0x1b8),_0x5f59cd(0x1cb),_0x5f59cd(0x235),'你当前使用的应用已被下架、请删除当前对话开启新的对话吧！',_0x5f59cd(0x1fe),_0x4e2b75(0xe4),_0x5f59cd(0x206),_0x5f59cd(0x26d),_0x4e2b75(0xf0),_0x4e2b75(0xab),_0x5f59cd(0x1b0),_0x5f59cd(0x1fa),_0x5f59cd(0x241),_0x5f59cd(0x270),_0x4e2b75(0xe1),_0x5f59cd(0x215),_0x5f59cd(0x1d9),_0x5f59cd(0x17e),_0x5f59cd(0x1c7),_0x5f59cd(0x263),_0x5f59cd(0x22c),_0x5f59cd(0x1da),_0x5f59cd(0x1a5),'setChatPreType','update',_0x5f59cd(0x232),_0x4e2b75(0x18f),_0x5f59cd(0x1b6),_0x5f59cd(0x1b5),_0x5f59cd(0x23e),_0x4e2b75(0xb7),_0x4e2b75(0xed),_0x4e2b75(0x103),_0x5f59cd(0x26f),'assign',_0x5f59cd(0x203),_0x5f59cd(0x1b2),_0x5f59cd(0x272),_0x4e2b75(0x106),_0x5f59cd(0x207),_0x5f59cd(0x1f5),_0x5f59cd(0x25b),_0x5f59cd(0x19b),_0x4e2b75(0xb4),_0x5f59cd(0x24e),_0x5f59cd(0x26c),_0x5f59cd(0x172),_0x5f59cd(0x1db)];return _0x42c4=function(){return _0x40d287;},_0x42c4();}Object[_0x42605f(0x1c2)](exports,_0x14868a(0x182),{'value':!![]}),exports[_0x42605f(0x1ce)]=void 0x0;const upload_service_1=require(_0x14868a(0x171)),user_service_1=require(_0x42605f(0x160)),nestjs_config_1=require(_0x42605f(0x188)),common_1=require(_0x42605f(0x205)),errorMessage_constant_1=require(_0x42605f(0x16c)),utils_1=require(_0x42605f(0x109)),axios_1=require(_0x42605f(0x1b5)),userBalance_service_1=require(_0x14868a(0x186)),balance_constant_1=require(_0x42605f(0x1be)),chatLog_service_1=require(_0x42605f(0x1bf)),uuid=require(_0x42605f(0x10a)),config_entity_1=require(_0x42605f(0x1dc)),typeorm_1=require(_0x42605f(0x1eb)),typeorm_2=require(_0x42605f(0x1d9)),badwords_service_1=require(_0x42605f(0x1e8)),autoreply_service_1=require(_0x42605f(0x19d)),gptkeys_entity_1=require(_0x42605f(0x154)),globalConfig_service_1=require(_0x14868a(0x258)),fanyi_service_1=require(_0x42605f(0x1c6)),app_entity_1=require(_0x42605f(0x1b9)),chatGroup_service_1=require(_0x42605f(0x11e)),models_service_1=require(_0x42605f(0x18c)),baidu_1=require(_0x14868a(0x250)),helper_1=require(_0x42605f(0x112)),store_1=require(_0x42605f(0x1a8)),zhipu_1=require(_0x42605f(0x12a)),openai_1=require(_0x42605f(0x1d1)),chatBoxType_entity_1=require(_0x42605f(0x1ca)),chatBox_entity_1=require(_0x42605f(0x176)),chatPre_entity_1=require(_0x14868a(0x229)),chatPreType_entity_1=require(_0x42605f(0x1ab));let ChatgptService=class ChatgptService{constructor(_0x2e898f,_0x26e73a,_0x3ba4f1,_0x36da4c,_0x119c2a,_0x33ba0d,_0x2adb20,_0x4c1319,_0x39b7e5,_0x1816ad,_0x4e0ff7,_0x2ef272,_0x4e7c44,_0x2a014a,_0x1f76ea,_0x224ef5,_0x3d3772,_0x21c0d0){const _0x44ee1d=_0x2fcb,_0x4064fe=_0x14868a,_0x14916f=_0x42605f;this[_0x14916f(0x201)]=_0x2e898f,this[_0x14916f(0x1fd)]=_0x26e73a,this[_0x4064fe(0x212)]=_0x3ba4f1,this[_0x4064fe(0x1ec)]=_0x36da4c,this[_0x14916f(0xfe)]=_0x119c2a,this[_0x14916f(0x1bd)]=_0x33ba0d,this[_0x14916f(0x196)]=_0x2adb20,this[_0x14916f(0x174)]=_0x4c1319,this[_0x4064fe(0x1b5)]=_0x39b7e5,this[_0x14916f(0x15f)]=_0x1816ad,this[_0x14916f(0x144)]=_0x4e0ff7,this[_0x14916f(0x141)]=_0x2ef272,this[_0x4064fe(0x17d)]=_0x4e7c44,this[_0x44ee1d(0x15d)]=_0x2a014a,this[_0x14916f(0x1c0)]=_0x1f76ea,this[_0x14916f(0x1b6)]=_0x224ef5,this[_0x14916f(0x145)]=_0x3d3772,this[_0x14916f(0x124)]=_0x21c0d0,this[_0x14916f(0x104)]=null,this[_0x14916f(0x1af)]=[],this[_0x14916f(0x1fa)]={'list3':[],'list4':[]};}async[_0x42605f(0x1f9)](){const _0x53544b=_0x2fcb,_0x5c6ce0=_0x14868a,_0x233ee9=_0x42605f;let _0x5e8395=await(0x0,utils_1[_0x233ee9(0x1f7)])(_0x233ee9(0x207)),_0x559062=await(0x0,utils_1[_0x233ee9(0x1f7)])(_0x5c6ce0(0x262)),_0x4a8af2=await(0x0,utils_1[_0x233ee9(0x1f7)])(_0x233ee9(0x193));_0x5e8395=(_0x5e8395===null||_0x5e8395===void 0x0?void 0x0:_0x5e8395[_0x233ee9(0x186)])?_0x5e8395[_0x233ee9(0x186)]:_0x5e8395,_0x559062=(_0x559062===null||_0x559062===void 0x0?void 0x0:_0x559062[_0x233ee9(0x186)])?_0x559062[_0x233ee9(0x186)]:_0x559062,_0x4a8af2=(_0x4a8af2===null||_0x4a8af2===void 0x0?void 0x0:_0x4a8af2[_0x233ee9(0x186)])?_0x4a8af2[_0x233ee9(0x186)]:_0x4a8af2;const {ChatGPTAPI:_0x5d2d7a,ChatGPTError:_0x44a3d2,ChatGPTUnofficialProxyAPI:_0x5439e6}=_0x5e8395,_0x2f7a0b=+process[_0x233ee9(0x199)][_0x233ee9(0x180)],_0x53ee58=process[_0x233ee9(0x199)][_0x233ee9(0xfd)],_0x54eb7b=process[_0x5c6ce0(0x213)][_0x233ee9(0x12b)],_0x5061f5=process[_0x233ee9(0x199)][_0x233ee9(0x155)],_0x13c4af=_0x53544b(0x15f)+(_0x5061f5||'')+':'+(_0x54eb7b||'')+'@'+_0x53ee58+':'+_0x2f7a0b,_0xfaa20a=new _0x559062(_0x13c4af),_0x3b3b63=new _0x4a8af2({'store':_0xfaa20a,'namespace':_0x233ee9(0x16b)});this[_0x233ee9(0x104)]=new store_1[(_0x233ee9(0x120))]({'store':_0x3b3b63,'namespace':_0x5c6ce0(0x208)});}async[_0x14868a(0x1d4)](_0x4f0b94,_0x3d3978,_0x3026a2,_0xaa8ab5=null){const _0x293bd6=_0x14868a,_0x259532=_0x42605f;var _0x746fb6;!_0xaa8ab5&&(_0xaa8ab5=(_0x746fb6=await this[_0x259532(0x124)][_0x293bd6(0x18b)]())===null||_0x746fb6===void 0x0?void 0x0:_0x746fb6[_0x259532(0x1bc)]);const {timeout:timeout=0x3c}=_0x3026a2,{topN:_0x455369,model:_0x159fd2}=_0xaa8ab5,{parentMessageId:parentMessageId=0x0}=_0x4f0b94,_0x590120=await this[_0x259532(0x1c0)][_0x259532(0x13f)]([_0x259532(0x17f)]),_0x4f8cc6=timeout*0x3e8||_0x590120||0x64*0x3e8,_0x35403d={'parentMessageId':parentMessageId,'timeoutMs':+_0x4f8cc6,'completionParams':{'model':_0x159fd2,'temperature':_0x455369}};return _0x3d3978&&(_0x35403d[_0x259532(0x1cb)]=_0x3d3978),_0x35403d;}async[_0x42605f(0x103)](_0x155244){const _0x1b06b0=_0x14868a,_0x5db7b2=_0x42605f,_0x42a90f=await this[_0x1b06b0(0x22c)][_0x5db7b2(0x1a9)](),_0x9638cd=await this[_0x5db7b2(0x1c0)][_0x1b06b0(0x1db)]([_0x5db7b2(0x194)]),{maxModelTokens:maxModelTokens=0x1f40,maxResponseTokens:maxResponseTokens=0x1000,key:_0xb24e18,model:_0x44bbaa}=_0x42a90f,_0x1b5329=await this[_0x5db7b2(0x1f2)](_0x42a90f),{context:_0x29048f}=await this[_0x5db7b2(0x104)][_0x5db7b2(0x192)](_0x155244,{'parentMessageId':'','systemMessage':_0x9638cd});try{const _0x48da22=await(0x0,openai_1[_0x5db7b2(0x111)])(_0x29048f,{'apiKey':(0x0,utils_1[_0x5db7b2(0x1e7)])(_0xb24e18),'model':_0x44bbaa,'proxyUrl':_0x1b5329,'onProgress':null});return _0x48da22===null||_0x48da22===void 0x0?void 0x0:_0x48da22[_0x1b06b0(0x1f8)];}catch(_0x506775){console[_0x5db7b2(0x1ba)](_0x5db7b2(0x1ee),_0x506775);}}async[_0x42605f(0x153)](_0xc90d9,_0x1c55eb,_0x5320d7){const _0x16f3f4=_0x2fcb,_0x3896d7=_0x14868a,_0x2df1b7=_0x42605f;var _0x19d08d,_0x3bfa3a,_0x1352c2,_0x5df490;const _0x8348b1=_0x1c55eb[_0x3896d7(0x1c8)],{options:options={},appId:_0xe0cc7a,cusromPrompt:_0x3adeaa,systemMessage:systemMessage=''}=_0xc90d9;let _0x33e9ba=systemMessage;const {parentMessageId:_0x26a182}=options,{prompt:_0x334aeb,imageUrl:_0xa5fddf,model:_0x43840f}=_0xc90d9,{groupId:_0x25ccaf,usingNetwork:_0x4ff10e}=options,_0x5e4e83=await this[_0x2df1b7(0x145)][_0x16f3f4(0x172)](_0x25ccaf),_0x2931d8=(_0x5e4e83===null||_0x5e4e83===void 0x0?void 0x0:_0x5e4e83[_0x2df1b7(0x1cf)])?JSON[_0x2df1b7(0x13c)](_0x5e4e83[_0x3896d7(0x20e)]):await this[_0x16f3f4(0xa5)][_0x2df1b7(0x18d)](),{keyType:_0x15167a,model:_0x438808,topN:_0x2481a2,systemMessage:_0x520bd9,rounds:_0x2fe03b}=_0x2931d8[_0x16f3f4(0x11d)];let _0x4ec4f7=null;!_0x3adeaa?_0x4ec4f7=await this[_0x2df1b7(0x124)][_0x2df1b7(0x170)](_0x438808):_0x4ec4f7=await this[_0x3896d7(0x22c)][_0x3896d7(0x1f9)]();if(!_0x4ec4f7)throw new common_1[(_0x2df1b7(0x1e0))](_0x3896d7(0x175),common_1[_0x16f3f4(0x125)][_0x2df1b7(0x19a)]);const {deduct:_0x31040a,isTokenBased:_0xef8a7b,tokenFeeRatio:_0x145339,deductType:_0x54b1ee,key:_0x573397,secret:_0x26aada,modelName:_0x1228c7,id:_0x5b54a0,accessToken:_0x500235}=_0x4ec4f7;await this[_0x16f3f4(0x143)][_0x2df1b7(0x1c7)](_0x1c55eb[_0x3896d7(0x1f5)]),await this[_0x2df1b7(0x12c)][_0x3896d7(0x1bd)](_0x1c55eb,_0x54b1ee===0x1?_0x2df1b7(0x1a2):_0x2df1b7(0x11c),_0x31040a),_0x5320d7&&_0x5320d7[_0x3896d7(0x1d3)](_0x2df1b7(0x1e2),_0x2df1b7(0x108)),await this[_0x16f3f4(0x99)][_0x3896d7(0x256)](_0x334aeb,_0x1c55eb[_0x16f3f4(0x119)]['id']);const _0x400d70=await this[_0x2df1b7(0x1a5)][_0x2df1b7(0x189)](_0x334aeb);if(_0x400d70&&_0x5320d7){const _0x1a3f99={'message':_0x400d70,'code':0x1f4};return _0x5320d7[_0x3896d7(0x221)](JSON[_0x2df1b7(0x1a3)](_0x1a3f99)),_0x5320d7[_0x3896d7(0x22a)]();}if(_0xe0cc7a){const _0x4f0d19=await this[_0x2df1b7(0xfe)][_0x2df1b7(0x19f)]({'where':{'id':_0xe0cc7a,'status':(0x0,typeorm_1['In'])([0x1,0x3,0x4,0x5])}});if(!_0x4f0d19)throw new common_1[(_0x2df1b7(0x1e0))](_0x2df1b7(0x113),common_1[_0x2df1b7(0x1bb)][_0x2df1b7(0x19a)]);_0x4f0d19[_0x2df1b7(0x17a)]&&(_0x33e9ba=_0x4f0d19[_0x2df1b7(0x17a)]);}else{if(_0x3adeaa)_0x33e9ba=systemMessage;else{if(_0x520bd9)_0x33e9ba=_0x520bd9;else{const _0x373e7d=new Date()[_0x2df1b7(0x10c)]()[_0x3896d7(0x1ed)]('T')[0x0],_0x328466=await this[_0x2df1b7(0x1c0)][_0x2df1b7(0x13f)]([_0x3896d7(0x1ae)]);_0x33e9ba=_0x328466+(_0x2df1b7(0x117)+_0x373e7d);}}}let _0x41e45='';if(_0x4ff10e){_0x41e45=await(0x0,utils_1[_0x2df1b7(0x1ef)])(_0x334aeb);const _0x6c1a40=new Date()[_0x2df1b7(0x10c)]()[_0x2df1b7(0x198)]('T')[0x0],_0x3b7a08=await this[_0x2df1b7(0x1c0)][_0x2df1b7(0x13f)]([_0x3896d7(0x1ae)]);_0x33e9ba=_0x3b7a08+(_0x2df1b7(0x117)+_0x6c1a40);}const _0x56082b=await this[_0x2df1b7(0x12f)](options,_0x33e9ba,_0x4ec4f7,_0x2931d8[_0x2df1b7(0x1bc)]),{maxModelTokens:maxModelTokens=0x1f40,maxResponseTokens:maxResponseTokens=0x1000,key:_0x11d5bb}=_0x4ec4f7;_0x5320d7&&_0x5320d7[_0x2df1b7(0x1a0)](0xc8);let _0x3ff08e=null,_0x2a82d4=null;try{if(_0x5320d7){let _0x35c0bd=null,_0x4fa812=![];_0x5320d7['on'](_0x3896d7(0x195),async()=>{const _0x15c0ba=_0x16f3f4,_0x3da243=_0x3896d7,_0x545b7c=_0x2df1b7;if(_0x4fa812)return;_0x8348b1[_0x545b7c(0x14e)]();const _0x5b4ef3=await(0x0,openai_1[_0x3da243(0x16e)])(_0x334aeb)||0x0,_0x214955=await(0x0,openai_1[_0x545b7c(0x115)])(_0x35c0bd===null||_0x35c0bd===void 0x0?void 0x0:_0x35c0bd[_0x545b7c(0x182)])||0x0,_0x159509=_0x5b4ef3+_0x214955,_0x5df7df=(0x0,utils_1[_0x545b7c(0x1f6)])(_0x1c55eb);await this[_0x3da243(0x21c)][_0x3da243(0x1c7)]({'appId':_0xe0cc7a,'curIp':_0x5df7df,'userId':_0x1c55eb[_0x545b7c(0x138)]['id'],'type':balance_constant_1[_0x3da243(0x25a)][_0x15c0ba(0x13d)],'prompt':_0x334aeb,'imageUrl':_0xa5fddf,'activeModel':_0x43840f,'answer':'','promptTokens':_0x5b4ef3,'completionTokens':0x0,'totalTokens':_0x5b4ef3,'model':_0x438808,'role':_0x545b7c(0x138),'groupId':_0x25ccaf,'requestOptions':JSON[_0x545b7c(0x1a3)]({'options':null,'prompt':_0x334aeb})}),await this[_0x545b7c(0x15f)][_0x3da243(0x1c7)]({'appId':_0xe0cc7a,'curIp':_0x5df7df,'userId':_0x1c55eb[_0x15c0ba(0x119)]['id'],'type':balance_constant_1[_0x545b7c(0x173)][_0x545b7c(0x140)],'prompt':_0x334aeb,'answer':_0x35c0bd===null||_0x35c0bd===void 0x0?void 0x0:_0x35c0bd[_0x545b7c(0x182)],'promptTokens':_0x5b4ef3,'completionTokens':_0x214955,'totalTokens':_0x159509,'model':_0x438808,'role':_0x545b7c(0x200),'groupId':_0x25ccaf,'requestOptions':JSON[_0x3da243(0x239)]({'options':{'model':_0x438808,'temperature':_0x2481a2},'prompt':_0x334aeb}),'conversationOptions':JSON[_0x545b7c(0x1a3)]({'conversationId':_0x35c0bd===null||_0x35c0bd===void 0x0?void 0x0:_0x35c0bd[_0x15c0ba(0x147)],'model':_0x438808,'parentMessageId':_0x35c0bd===null||_0x35c0bd===void 0x0?void 0x0:_0x35c0bd['id'],'temperature':_0x2481a2})});let _0x424609=_0x31040a;_0xef8a7b===!![]&&(_0x424609=Math[_0x3da243(0x1f1)](_0x31040a*_0x159509/_0x145339)),await this[_0x3da243(0x1b5)][_0x545b7c(0xff)](_0x1c55eb[_0x545b7c(0x138)]['id'],_0x3da243(0x1d5)+(_0x54b1ee===0x1?0x3:0x4),_0x424609,_0x159509);});if(Number(_0x15167a)===0x1){const {key:_0x540e8d,maxToken:_0x49546a,maxTokenRes:_0x2d83bc,proxyResUrl:_0x4953bc}=await this[_0x2df1b7(0x166)](_0x4ec4f7),{parentMessageId:_0x3070e1,completionParams:_0x10cf3e,systemMessage:_0x435908}=_0x56082b,{model:_0x451942,temperature:_0xa2cfc6}=_0x10cf3e,{context:_0x1ae3be}=await this[_0x2df1b7(0x104)][_0x2df1b7(0x192)](_0x4ff10e?_0x41e45:_0x334aeb,{'parentMessageId':_0x3070e1,'systemMessage':_0x435908,'maxModelToken':_0x49546a,'maxResponseTokens':_0x2d83bc,'maxRounds':(0x0,helper_1[_0x2df1b7(0x19c)])(_0x2fe03b),'imageUrl':_0xa5fddf,'activeModel':_0x43840f});let _0xf9461f=!![];_0x3ff08e=await(0x0,openai_1[_0x2df1b7(0x111)])(_0x1ae3be,{'maxToken':_0x49546a,'maxTokenRes':_0x2d83bc,'apiKey':_0x573397,'model':_0x451942,'prompt':_0x334aeb,'activeModel':_0x43840f,'imageUrl':_0xa5fddf,'temperature':_0xa2cfc6,'proxyUrl':_0x4953bc,'onProgress':_0x7571e2=>{const _0x25fba7=_0x3896d7,_0x2388bc=_0x2df1b7;_0x5320d7[_0x2388bc(0x1a7)](_0xf9461f?JSON[_0x25fba7(0x239)](_0x7571e2):'\x0a'+JSON[_0x2388bc(0x1a3)](_0x7571e2)),_0x35c0bd=_0x7571e2,_0xf9461f=![];}},this[_0x2df1b7(0x141)]),_0x4fa812=!![];}if(Number(_0x15167a)===0x2){let _0x2feb54=!![];const {context:_0x50ac00}=await this[_0x2df1b7(0x104)][_0x2df1b7(0x192)](_0x4ff10e?_0x41e45:_0x334aeb,{'parentMessageId':_0x26a182,'maxRounds':(0x0,helper_1[_0x2df1b7(0x19c)])(_0x2fe03b)});_0x3ff08e=await(0x0,baidu_1[_0x2df1b7(0x16d)])(_0x4ff10e?_0x41e45:_0x50ac00,{'temperature':_0x2481a2,'accessToken':_0x500235,'model':_0x438808,'onProgress':_0x4534fc=>{const _0x460357=_0x3896d7,_0x514835=_0x2df1b7;_0x5320d7[_0x514835(0x1a7)](_0x2feb54?JSON[_0x514835(0x1a3)](_0x4534fc):'\x0a'+JSON[_0x460357(0x239)](_0x4534fc)),_0x2feb54=![],_0x35c0bd=_0x4534fc;}}),_0x4fa812=!![];}if(Number(_0x15167a)===0x3){let _0x4b73c1=!![];const {context:_0x1acad1}=await this[_0x2df1b7(0x104)][_0x2df1b7(0x192)](_0x4ff10e?_0x41e45:_0x334aeb,{'parentMessageId':_0x26a182,'maxRounds':(0x0,helper_1[_0x2df1b7(0x19c)])(_0x2fe03b)});_0x3ff08e=await(0x0,zhipu_1[_0x2df1b7(0x209)])(_0x4ff10e?_0x41e45:_0x1acad1,{'temperature':_0x2481a2,'key':_0x11d5bb,'model':_0x438808,'onProgress':_0x16297d=>{const _0x42d3a7=_0x2df1b7;_0x5320d7[_0x42d3a7(0x1a7)](_0x4b73c1?JSON[_0x42d3a7(0x1a3)](_0x16297d):'\x0a'+JSON[_0x42d3a7(0x1a3)](_0x16297d)),_0x4b73c1=![],_0x35c0bd=_0x16297d;}}),_0x4fa812=!![];}const _0x274a64={'id':this[_0x2df1b7(0x104)][_0x2df1b7(0x126)](),'text':_0x334aeb,'role':_0x2df1b7(0x138),'name':undefined,'usage':null,'imageUrl':_0xa5fddf,'activeModel':_0x43840f,'parentMessageId':_0x26a182,'conversationId':_0x3ff08e===null||_0x3ff08e===void 0x0?void 0x0:_0x3ff08e[_0x2df1b7(0x1b2)]};_0x2a82d4={'model':_0x438808,'parentMessageId':_0x26a182},await this[_0x2df1b7(0x104)][_0x2df1b7(0x10f)](_0x274a64);const _0x28f69e={'id':_0x3ff08e['id'],'text':_0x3ff08e[_0x2df1b7(0x182)],'role':_0x2df1b7(0x200),'name':undefined,'usage':_0x3ff08e===null||_0x3ff08e===void 0x0?void 0x0:_0x3ff08e[_0x2df1b7(0x16a)],'imageUrl':_0xa5fddf,'parentMessageId':_0x274a64['id'],'conversationId':_0x3ff08e===null||_0x3ff08e===void 0x0?void 0x0:_0x3ff08e[_0x2df1b7(0x1b2)]};await this[_0x2df1b7(0x104)][_0x2df1b7(0x10f)](_0x28f69e),_0x2a82d4={'model':_0x438808,'parentMessageId':_0x274a64['id']};}else{const {key:_0x2e29da,maxToken:_0x5f12ba,maxTokenRes:_0xce4e32,proxyResUrl:_0x5deb24}=await this[_0x2df1b7(0x166)](_0x4ec4f7),{parentMessageId:_0x47a22a,completionParams:_0x590174,systemMessage:_0x286296}=_0x56082b,{model:_0x5cf4a1,temperature:_0x4a3273}=_0x590174,{context:_0x488396}=await this[_0x2df1b7(0x104)][_0x2df1b7(0x192)](_0x4ff10e?_0x41e45:_0x334aeb,{'parentMessageId':_0x47a22a,'systemMessage':_0x286296,'maxRounds':(0x0,helper_1[_0x3896d7(0x1c6)])(_0x2fe03b)});_0x3ff08e=await(0x0,openai_1[_0x2df1b7(0x111)])(_0x488396,{'apiKey':_0x573397,'model':_0x5cf4a1,'temperature':_0x4a3273,'proxyUrl':_0x5deb24,'onProgress':null,'prompt':_0x334aeb});}let _0x3632eb=null,_0x216b10=null;_0x438808[_0x2df1b7(0x13d)](_0x2df1b7(0x106))?_0x3632eb=((_0x19d08d=_0x3ff08e[_0x2df1b7(0x1e3)])===null||_0x19d08d===void 0x0?void 0x0:_0x19d08d[_0x2df1b7(0x16a)])||{'prompt_tokens':0x1,'completion_tokens':0x1,'total_tokens':0x2}:_0x216b10=await(0x0,helper_1[_0x3896d7(0x24b)])(_0x15167a,_0x3ff08e,_0x2a82d4);const {prompt_tokens:_0x385693,completion_tokens:_0x5eb685,total_tokens:_0xcd82e6}=_0x438808[_0x2df1b7(0x13d)](_0x2df1b7(0x106))?_0x3632eb:_0x216b10[_0x2df1b7(0x16a)];let _0x4fe534=_0x31040a;_0xef8a7b===!![]&&(_0x4fe534=Math[_0x2df1b7(0x14d)](_0x31040a*_0xcd82e6/_0x145339)),(await this[_0x2df1b7(0x12c)][_0x2df1b7(0xff)](_0x1c55eb[_0x2df1b7(0x138)]['id'],_0x2df1b7(0x158)+(_0x54b1ee===0x1?0x3:0x4),_0x4fe534,_0xcd82e6),await this[_0x2df1b7(0x124)][_0x2df1b7(0x1e1)](_0x5b54a0,_0xcd82e6));const _0x13b6ea=(0x0,utils_1[_0x16f3f4(0xf6)])(_0x1c55eb);await this[_0x2df1b7(0x15f)][_0x2df1b7(0x122)]({'appId':_0xe0cc7a,'curIp':_0x13b6ea,'userId':_0x1c55eb[_0x2df1b7(0x138)]['id'],'type':balance_constant_1[_0x2df1b7(0x173)][_0x16f3f4(0x13d)],'prompt':_0x334aeb,'imageUrl':_0xa5fddf,'activeModel':_0x43840f,'answer':'','promptTokens':_0x385693,'completionTokens':0x0,'totalTokens':_0xcd82e6,'model':_0x438808,'role':_0x2df1b7(0x138),'groupId':_0x25ccaf,'requestOptions':JSON[_0x2df1b7(0x1a3)]({'options':null,'prompt':_0x334aeb})}),await this[_0x3896d7(0x21c)][_0x2df1b7(0x122)]({'appId':_0xe0cc7a,'curIp':_0x13b6ea,'userId':_0x1c55eb[_0x2df1b7(0x138)]['id'],'type':balance_constant_1[_0x2df1b7(0x173)][_0x2df1b7(0x140)],'prompt':_0x334aeb,'imageUrl':_0x3ff08e===null||_0x3ff08e===void 0x0?void 0x0:_0x3ff08e[_0x2df1b7(0x14b)],'answer':_0x3ff08e[_0x2df1b7(0x182)],'promptTokens':_0x385693,'completionTokens':_0x5eb685,'totalTokens':_0xcd82e6,'model':_0x438808,'role':_0x2df1b7(0x200),'groupId':_0x25ccaf,'requestOptions':JSON[_0x16f3f4(0x175)]({'options':{'model':_0x438808,'temperature':_0x2481a2},'prompt':_0x334aeb}),'conversationOptions':JSON[_0x3896d7(0x239)]({'conversationId':_0x3ff08e[_0x2df1b7(0x1b2)],'model':_0x438808,'parentMessageId':_0x3ff08e['id'],'temperature':_0x2481a2})}),common_1[_0x2df1b7(0x130)][_0x3896d7(0x222)](_0x2df1b7(0x14a)+_0x1c55eb[_0x2df1b7(0x138)]['id']+_0x3896d7(0x227)+_0x1228c7+'-'+_0x43840f+_0x3896d7(0x21e)+_0xcd82e6+_0x3896d7(0x1f0)+_0x4fe534,_0x2df1b7(0x1ce));const _0x4bd85a=await this[_0x3896d7(0x1b5)][_0x2df1b7(0x146)](_0x1c55eb[_0x2df1b7(0x138)]['id']);return _0x3ff08e[_0x2df1b7(0x102)]=Object[_0x2df1b7(0x132)]({},_0x4bd85a),_0x3ff08e[_0x2df1b7(0x1d7)]&&(_0x3ff08e[_0x2df1b7(0x1d7)]=''),_0x3ff08e[_0x2df1b7(0x157)]=!![],_0x5320d7?_0x5320d7[_0x2df1b7(0x1a7)]('\x0a'+JSON[_0x2df1b7(0x1a3)](_0x3ff08e)):_0x3ff08e[_0x2df1b7(0x182)];}catch(_0x187982){console[_0x2df1b7(0x1ba)](_0x2df1b7(0x161),_0x573397,_0x187982);const _0x48e599=(_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x10e)])||0x190,_0x5c7e44=((_0x3bfa3a=_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x1cd)])===null||_0x3bfa3a===void 0x0?void 0x0:_0x3bfa3a[_0x2df1b7(0x1a0)])||(_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x10e)])||0x190;console[_0x3896d7(0x19a)](_0x2df1b7(0x156),'code:\x20',_0x48e599,_0x2df1b7(0x1fe),_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x1fe)],_0x2df1b7(0x10d),(_0x1352c2=_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x1cd)])===null||_0x1352c2===void 0x0?void 0x0:_0x1352c2[_0x3896d7(0x210)],_0x2df1b7(0x1a0),(_0x5df490=_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x1cd)])===null||_0x5df490===void 0x0?void 0x0:_0x5df490[_0x2df1b7(0x1a0)]);if(_0x187982[_0x2df1b7(0x1a0)]&&_0x187982[_0x3896d7(0x244)]===0x192){const _0x340f99={'message':_0x2df1b7(0x147)+_0x187982[_0x2df1b7(0x1fe)],'code':0x192};if(_0x5320d7)return _0x5320d7[_0x2df1b7(0x1a7)](JSON[_0x2df1b7(0x1a3)](_0x340f99));else throw new common_1[(_0x2df1b7(0x1e0))](_0x187982[_0x2df1b7(0x1fe)],common_1['HttpStatus'][_0x3896d7(0x188)]);}if(!_0x5c7e44){if(_0x5320d7)return _0x5320d7[_0x2df1b7(0x1a7)](JSON[_0x2df1b7(0x1a3)]({'message':_0x187982[_0x2df1b7(0x1fe)],'code':0x1f4}));else throw new common_1[(_0x3896d7(0x1e8))](_0x187982[_0x2df1b7(0x1fe)],common_1[_0x2df1b7(0x1bb)][_0x2df1b7(0x19a)]);}let _0x3028a5=errorMessage_constant_1[_0x2df1b7(0x15c)][_0x5c7e44]?errorMessage_constant_1[_0x2df1b7(0x15c)][_0x5c7e44]:_0x2df1b7(0x1a6);(_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x1fe)][_0x2df1b7(0x13d)](_0x2df1b7(0x197)))&&Number(_0x15167a)===0x1&&(await this[_0x2df1b7(0x124)][_0x3896d7(0x183)](_0x5b54a0,_0x2df1b7(0x110),-0x1),_0x3028a5=_0x2df1b7(0x18f)),(_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x10e)])===0x1ad&&_0x187982[_0x2df1b7(0x1fe)][_0x16f3f4(0x111)](_0x3896d7(0x164))&&Number(_0x15167a)===0x1&&(await this[_0x2df1b7(0x124)][_0x2df1b7(0x1fc)](_0x5b54a0,_0x2df1b7(0x13b),-0x3),_0x3028a5=_0x2df1b7(0x190)),(_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x16f3f4(0x17b)])===0x1ad&&(_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x1a1)])===_0x2df1b7(0x169)&&(_0x3028a5=_0x2df1b7(0x195)),(_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x16f3f4(0x17b)])===0x191&&_0x187982[_0x2df1b7(0x1fe)][_0x2df1b7(0x13d)](_0x2df1b7(0x179))&&Number(_0x15167a)===0x1&&(await this[_0x3896d7(0x22c)][_0x2df1b7(0x1fc)](_0x5b54a0,_0x2df1b7(0x151),-0x2),_0x3028a5=_0x3896d7(0x1c2)),(_0x187982===null||_0x187982===void 0x0?void 0x0:_0x187982[_0x2df1b7(0x10e)])===0x194&&_0x187982[_0x2df1b7(0x1fe)][_0x2df1b7(0x13d)](_0x2df1b7(0x150))&&Number(_0x15167a)===0x1&&(await this[_0x2df1b7(0x124)][_0x3896d7(0x183)](_0x5b54a0,_0x2df1b7(0x1b8),-0x4),_0x3028a5=_0x2df1b7(0x101)),_0x48e599===0x190&&console[_0x2df1b7(0x1ba)](_0x2df1b7(0x181),_0x187982,_0x187982[_0x2df1b7(0x1fe)]);const _0x5e7976={'message':_0x3028a5||_0x2df1b7(0x125),'code':_0x48e599===0x191?0x190:_0x48e599||0x1f4};if(_0x5320d7)return _0x5320d7[_0x16f3f4(0x197)](JSON[_0x3896d7(0x239)](_0x5e7976));else throw new common_1[(_0x2df1b7(0x1e0))](_0x5e7976[_0x2df1b7(0x1fe)],common_1[_0x2df1b7(0x1bb)][_0x2df1b7(0x19a)]);}finally{_0x5320d7&&_0x5320d7[_0x2df1b7(0x1d0)]();}}async[_0x42605f(0x18b)](_0x15e10c,_0x4c31a4){const _0x55b2da=_0x2fcb,_0x3cd6b6=_0x14868a,_0x2bc58a=_0x42605f;var _0x11a624,_0x3b63ec,_0x50e3e0,_0x5b6828;await this[_0x3cd6b6(0x17d)][_0x2bc58a(0x184)](_0x15e10c[_0x3cd6b6(0x230)],_0x4c31a4[_0x2bc58a(0x138)]['id']),await this[_0x2bc58a(0x144)][_0x2bc58a(0x1c7)](_0x4c31a4[_0x2bc58a(0x138)]);const _0x2bd913=(_0x15e10c===null||_0x15e10c===void 0x0?void 0x0:_0x15e10c[_0x55b2da(0x177)])==='hd'?0x4:0x2;await this[_0x2bc58a(0x12c)][_0x2bc58a(0x1f3)](_0x4c31a4,_0x3cd6b6(0x18a),_0x2bd913);let _0x31ceab=[];const _0x3ad795=await this[_0x2bc58a(0x124)][_0x2bc58a(0x170)](_0x55b2da(0xf3)),_0x41fec4=_0x3ad795===null||_0x3ad795===void 0x0?void 0x0:_0x3ad795['id'],{key:_0x2df5c8,proxyResUrl:_0x1daf34}=await this[_0x2bc58a(0x166)](_0x3ad795);common_1[_0x2bc58a(0x130)][_0x2bc58a(0x1ba)](_0x2bc58a(0x1df)+_0x15e10c[_0x2bc58a(0x206)]+_0x3cd6b6(0x18f)+_0x2df5c8,_0x2bc58a(0x18a));try{const _0x12ae0e=_0x1daf34+_0x2bc58a(0x162),_0x3af722=Object[_0x2bc58a(0x132)](Object[_0x3cd6b6(0x181)]({},_0x15e10c),{'model':_0x2bc58a(0x107)});console[_0x2bc58a(0x1ba)](_0x2bc58a(0x164),_0x3af722);const _0x3a232a=await axios_1[_0x2bc58a(0x186)][_0x3cd6b6(0x26b)](_0x12ae0e,Object[_0x2bc58a(0x132)](Object[_0x2bc58a(0x132)]({},_0x3af722),{'response_format':_0x2bc58a(0x137)}),{'headers':{'Authorization':_0x3cd6b6(0x187)+_0x2df5c8}});_0x31ceab=_0x3a232a[_0x3cd6b6(0x178)][_0x3cd6b6(0x178)];const _0x238b6e=[];for(const _0x58d852 of _0x31ceab){const _0x46b2d3=uuid['v4']()[_0x2bc58a(0x118)](0x0,0xa)+_0x2bc58a(0x185),_0x28d6b7=Buffer[_0x2bc58a(0x1e6)](_0x58d852[_0x2bc58a(0x137)],_0x2bc58a(0x1d8));_0x238b6e[_0x2bc58a(0x1ec)](this[_0x3cd6b6(0x205)][_0x2bc58a(0x1e9)]({'filename':_0x46b2d3,'buffer':_0x28d6b7}));}const _0x4a2281=await Promise[_0x2bc58a(0x1b4)](_0x238b6e);await this[_0x3cd6b6(0x1b5)][_0x2bc58a(0xff)](_0x4c31a4[_0x2bc58a(0x138)]['id'],_0x3cd6b6(0x18a),(_0x3af722===null||_0x3af722===void 0x0?void 0x0:_0x3af722[_0x2bc58a(0x1ad)])===_0x2bc58a(0x1ac)?0x2:0x4,_0x2bd913);const _0x2a8e01=(0x0,utils_1[_0x2bc58a(0x1f6)])(_0x4c31a4),_0x1b8b50=[],_0x112bd3=await this[_0x3cd6b6(0x205)][_0x3cd6b6(0x231)](),[_0x489798,_0x30e91d]=_0x15e10c[_0x2bc58a(0x178)][_0x3cd6b6(0x1ed)]('x');return _0x4a2281[_0x2bc58a(0x11f)](_0x2611d5=>{const _0x5a25c2=_0x3cd6b6,_0x2d9c3b=_0x2bc58a;_0x1b8b50[_0x2d9c3b(0x1ec)](this[_0x2d9c3b(0x15f)][_0x2d9c3b(0x122)]({'curIp':_0x2a8e01,'userId':_0x4c31a4[_0x5a25c2(0x1f5)]['id'],'type':balance_constant_1[_0x2d9c3b(0x173)][_0x2d9c3b(0x1da)],'prompt':_0x15e10c[_0x2d9c3b(0x206)],'answer':_0x2611d5,'fileInfo':JSON[_0x2d9c3b(0x1a3)]({'cosType':_0x112bd3,'width':_0x489798,'height':_0x30e91d,'cosUrl':_0x2611d5}),'promptTokens':0x0,'completionTokens':0x0,'totalTokens':0x0,'model':_0x2d9c3b(0x107)}));}),await Promise[_0x2bc58a(0x1b4)](_0x1b8b50),_0x4a2281;}catch(_0x187ed6){const _0x18dbb7=((_0x11a624=_0x187ed6===null||_0x187ed6===void 0x0?void 0x0:_0x187ed6[_0x2bc58a(0x1cd)])===null||_0x11a624===void 0x0?void 0x0:_0x11a624[_0x2bc58a(0x1a0)])||0x1f4;console[_0x2bc58a(0x1ba)](_0x2bc58a(0x15e),JSON[_0x2bc58a(0x1a3)](_0x187ed6),_0x2df5c8,_0x18dbb7);const _0x2a08ec=(_0x5b6828=(_0x50e3e0=(_0x3b63ec=_0x187ed6===null||_0x187ed6===void 0x0?void 0x0:_0x187ed6[_0x2bc58a(0x1cd)])===null||_0x3b63ec===void 0x0?void 0x0:_0x3b63ec[_0x2bc58a(0x100)])===null||_0x50e3e0===void 0x0?void 0x0:_0x50e3e0[_0x3cd6b6(0x191)])===null||_0x5b6828===void 0x0?void 0x0:_0x5b6828[_0x55b2da(0x193)];if(_0x18dbb7===0x1ad)throw new common_1[(_0x3cd6b6(0x1e8))](_0x2bc58a(0x116),common_1[_0x2bc58a(0x1bb)][_0x2bc58a(0x19a)]);if(_0x18dbb7===0x190&&_0x2a08ec[_0x3cd6b6(0x26c)](_0x2bc58a(0x1b7)))throw new common_1[(_0x2bc58a(0x1e0))](_0x2bc58a(0xfc),common_1[_0x2bc58a(0x1bb)][_0x2bc58a(0x19a)]);if(_0x18dbb7===0x190&&_0x2a08ec[_0x2bc58a(0x13d)](_0x2bc58a(0x1ff))){await this[_0x2bc58a(0x124)][_0x2bc58a(0x1fc)](_0x41fec4,_0x3cd6b6(0x1b8),-0x1);throw new common_1[(_0x2bc58a(0x1e0))](_0x2bc58a(0x1c5),common_1[_0x3cd6b6(0x193)][_0x2bc58a(0x19a)]);}if(_0x18dbb7===0x1f4)throw new common_1[(_0x2bc58a(0x1e0))](_0x2bc58a(0x204),common_1[_0x2bc58a(0x1bb)][_0x3cd6b6(0x170)]);if(_0x18dbb7===0x191)throw new common_1[(_0x2bc58a(0x1e0))](_0x2bc58a(0x149),common_1[_0x2bc58a(0x1bb)][_0x2bc58a(0x19a)]);throw new common_1[(_0x3cd6b6(0x1e8))](_0x2bc58a(0x136),common_1[_0x2bc58a(0x1bb)][_0x2bc58a(0x19a)]);}}async[_0x14868a(0x22b)](){const _0x57af5e=_0x14868a,_0x4118d2=_0x42605f,_0x202605=await this['gptKeysEntity'][_0x4118d2(0x11a)]({'where':{'status':0x1},'select':['id',_0x4118d2(0x13e),_0x4118d2(0x114),_0x4118d2(0x158),_0x4118d2(0x14f),_0x4118d2(0x19b),_0x4118d2(0x177),_0x4118d2(0x17f)]}),_0x48135a=_0x202605[_0x4118d2(0x11d)](_0x408b88=>_0x408b88[_0x4118d2(0x158)][_0x57af5e(0x26c)](_0x4118d2(0x152))),_0x499521=_0x202605[_0x4118d2(0x11d)](_0x547911=>_0x547911[_0x4118d2(0x158)][_0x4118d2(0x13d)](_0x4118d2(0x17b)));this[_0x4118d2(0x1fa)]={'list3':_0x48135a,'list4':_0x499521};}async[_0x42605f(0x1f2)](_0x416590){const _0x22159d=_0x14868a,_0x2c4ea6=_0x42605f,_0x5e644c=await this[_0x2c4ea6(0x1c0)][_0x22159d(0x1db)]([_0x2c4ea6(0x1db)]);return(_0x416590===null||_0x416590===void 0x0?void 0x0:_0x416590[_0x2c4ea6(0x134)])||_0x5e644c||_0x2c4ea6(0x15a);}async[_0x42605f(0x166)](_0x326396){const _0x35441f=_0x2fcb,_0x58e29d=_0x14868a,_0x248aae=_0x42605f,{openaiModel3MaxTokens:openaiModel3MaxTokens=0x0,openaiModel3MaxTokensRes:openaiModel3MaxTokensRes=0x0,openaiModel3MaxTokens16k:openaiModel3MaxTokens16k=0x0,openaiModel3MaxTokens16kRes:openaiModel3MaxTokens16kRes=0x0,openaiModel4MaxTokens:openaiModel4MaxTokens=0x0,openaiModel4MaxTokensRes:openaiModel4MaxTokensRes=0x0,openaiModel4MaxTokens32k:openaiModel4MaxTokens32k=0x0,openaiModel4MaxTokens32kRes:openaiModel4MaxTokens32kRes=0x0,openaiBaseUrl:openaiBaseUrl=''}=await this[_0x248aae(0x1c0)][_0x248aae(0x13f)]([_0x58e29d(0x247),_0x248aae(0x1ae),_0x248aae(0x16f),_0x35441f(0x109),_0x248aae(0x105),_0x248aae(0x183),_0x248aae(0x168),_0x58e29d(0x24a),_0x248aae(0x1db)]);let _0x4e5a4f=null,_0x504bdc=null,_0x26b8a3=null,{model:_0x1555c5,maxModelTokens:maxModelTokens=0x0,maxResponseTokens:maxResponseTokens=0x0,proxyUrl:proxyUrl='',key:_0x4f7400}=_0x326396;return _0x1555c5[_0x248aae(0x121)]()[_0x248aae(0x13d)](_0x248aae(0x17b))&&(maxModelTokens>=0x2000&&(maxModelTokens=0x2000),_0x504bdc>=0x1000&&(maxModelTokens=0x1000),_0x4e5a4f=maxModelTokens||openaiModel4MaxTokens||0x2000,_0x504bdc=maxResponseTokens||openaiModel4MaxTokensRes||0x1000,_0x1555c5[_0x248aae(0x121)]()[_0x248aae(0x13d)](_0x248aae(0x143))&&(maxModelTokens>=0x8000&&(maxModelTokens=0x8000),_0x504bdc>=0x4000&&(maxModelTokens=0x4000),_0x4e5a4f=maxModelTokens||openaiModel4MaxTokens32k||0x8000,_0x504bdc=maxResponseTokens||openaiModel4MaxTokens32kRes||0x4000),_0x1555c5[_0x248aae(0x121)]()[_0x248aae(0x13d)](_0x248aae(0x1c3))&&(maxModelTokens>=0x3ffc&&(maxModelTokens=0x3ffc),_0x504bdc>=0x1000&&(maxModelTokens=0x1000),_0x4e5a4f=maxModelTokens||0x3ffc,_0x504bdc=maxResponseTokens||0x1000)),_0x1555c5[_0x248aae(0x121)]()[_0x248aae(0x13d)](_0x58e29d(0x20c))&&(maxModelTokens>=0x1000&&(maxModelTokens=0x1000),_0x504bdc>=0x7d0&&(maxModelTokens=0x7d0),_0x4e5a4f=maxModelTokens||openaiModel3MaxTokens||0x1000,_0x504bdc=maxResponseTokens||openaiModel3MaxTokensRes||0x7d0,_0x1555c5[_0x58e29d(0x17e)]()[_0x248aae(0x13d)](_0x58e29d(0x1ce))&&(maxModelTokens>=0x4000&&(maxModelTokens=0x4000),_0x504bdc>=0x2000&&(maxModelTokens=0x2000),_0x4e5a4f=maxModelTokens||openaiModel3MaxTokens16k||0x4000,_0x504bdc=maxResponseTokens||openaiModel3MaxTokens16kRes||0x2000),_0x1555c5[_0x248aae(0x121)]()[_0x248aae(0x13d)](_0x58e29d(0x233))&&(maxModelTokens>=0x4000&&(maxModelTokens=0x4000),_0x504bdc>=0x1000&&(maxModelTokens=0x1000),_0x4e5a4f=maxModelTokens||0x4000,_0x504bdc=maxResponseTokens||0x1000)),_0x26b8a3=proxyUrl||openaiBaseUrl||_0x58e29d(0x1af),_0x504bdc>=_0x4e5a4f&&(_0x504bdc=Math[_0x248aae(0x1f0)](_0x4e5a4f/0x2)),{'key':_0x4f7400,'maxToken':_0x4e5a4f,'maxTokenRes':_0x504bdc,'proxyResUrl':_0x26b8a3};}async[_0xcb4d42(0x108)](_0x2865c4,_0x44f88a){const _0x2c36c2=_0x14868a,_0x16ab54=_0x42605f;try{const {name:_0x33df77,icon:_0x55094f,order:_0x158120,id:_0x26159b,status:_0x3f9512}=_0x44f88a;return _0x26159b?await this[_0x16ab54(0x1f1)][_0x16ab54(0x128)]({'id':_0x26159b},{'name':_0x33df77,'icon':_0x55094f,'order':_0x158120,'status':_0x3f9512}):await this[_0x2c36c2(0x212)][_0x16ab54(0x12d)]({'name':_0x33df77,'icon':_0x55094f,'order':_0x158120,'status':_0x3f9512});}catch(_0x2d6cd0){console[_0x16ab54(0x1ba)](_0x16ab54(0x1ee),_0x2d6cd0);}}async[_0x14868a(0x1cf)](_0x26c7e8,_0xd8662d){const _0x2d9d3f=_0x14868a,_0x5cddf7=_0x42605f,{id:_0x198f58}=_0xd8662d;if(!_0x198f58)throw new common_1[(_0x5cddf7(0x1e0))](_0x2d9d3f(0x234),common_1[_0x5cddf7(0x1bb)][_0x2d9d3f(0x170)]);const _0x4bef84=await this[_0x5cddf7(0x187)][_0x5cddf7(0x1c9)]({'where':{'typeId':_0x198f58}});if(_0x4bef84)throw new common_1[(_0x5cddf7(0x1e0))](_0x5cddf7(0x123),common_1[_0x5cddf7(0x1bb)][_0x5cddf7(0x19a)]);return await this[_0x5cddf7(0x1f1)][_0x5cddf7(0x1e5)]({'id':_0x198f58});}async[_0x14868a(0x254)](){const _0x54dd29=_0x14868a,_0x7b2895=_0x42605f;return await this[_0x54dd29(0x212)][_0x7b2895(0x11a)]({'order':{'order':_0x7b2895(0x11b)}});}async[_0x42605f(0x1b1)](_0xd3ba6d,_0x5d69b5){const _0x54f3f9=_0x14868a,_0x5f95de=_0x42605f,{title:_0x26d686,prompt:_0xde2386,appId:_0x15a2d3,order:_0x448c86,status:_0x4847da,typeId:_0x3c910d,id:_0x896fb8,url:_0x4c60a7}=_0x5d69b5;if(!_0x3c910d)throw new common_1[(_0x54f3f9(0x1e8))](_0x5f95de(0x17e),common_1[_0x5f95de(0x1bb)][_0x5f95de(0x19a)]);try{const _0x24634f={'title':_0x26d686,'order':_0x448c86,'status':_0x4847da,'typeId':_0x3c910d,'url':_0x4c60a7};return _0x24634f[_0x5f95de(0x208)]=_0x15a2d3||0x0,_0x24634f[_0x5f95de(0x206)]=_0xde2386||'',_0x896fb8?await this[_0x5f95de(0x187)][_0x54f3f9(0x1df)]({'id':_0x896fb8},_0x24634f):await this[_0x5f95de(0x187)][_0x5f95de(0x12d)](_0x24634f);}catch(_0x14333e){console[_0x5f95de(0x1ba)](_0x5f95de(0x1ee),_0x14333e);}}async[_0x42605f(0x18e)](_0xb0c37c,_0x3050bd){const _0x1bb9c2=_0xcb4d42,_0xcacb03=_0x14868a,_0x4912d7=_0x42605f,{id:_0x5071ad}=_0x3050bd;if(!_0x5071ad)throw new common_1[(_0xcacb03(0x1e8))](_0x4912d7(0x1e4),common_1[_0x4912d7(0x1bb)][_0x1bb9c2(0x14d)]);return await this[_0x4912d7(0x187)][_0x4912d7(0x1e5)]({'id':_0x5071ad});}async[_0x42605f(0x203)](){const _0x467bd8=_0x14868a,_0x469064=_0x42605f,_0xc95262=await this[_0x467bd8(0x1ec)][_0x469064(0x11a)]({'order':{'order':_0x467bd8(0x1fa)}}),_0x1ae4c0=[...new Set(_0xc95262[_0x469064(0x175)](_0x18eb02=>_0x18eb02[_0x469064(0x1c1)]))],_0x5e1026=[...new Set(_0xc95262[_0x469064(0x175)](_0x27827d=>_0x27827d[_0x469064(0x208)]))],_0x414dbb=await this[_0x469064(0x1f1)][_0x467bd8(0x1b0)]({'where':{'id':(0x0,typeorm_1['In'])(_0x1ae4c0)}}),_0x148430=await this[_0x467bd8(0x267)][_0x469064(0x11a)]({'where':{'id':(0x0,typeorm_1['In'])(_0x5e1026)}});return _0xc95262[_0x469064(0x175)](_0x235483=>{const _0x11f529=_0x467bd8,_0x9e0c49=_0x469064,{typeId:_0x15f96c,appId:_0x2e90b5}=_0x235483;return _0x235483[_0x11f529(0x253)]=_0x414dbb[_0x11f529(0x1b0)](_0x3e7822=>_0x3e7822['id']===_0x15f96c),_0x235483[_0x11f529(0x1d0)]=_0x148430[_0x9e0c49(0x11a)](_0x417fd4=>_0x417fd4['id']===_0x2e90b5),_0x235483;});}async[_0x42605f(0x16e)](){const _0x2470b0=_0xcb4d42,_0x20077b=_0x14868a,_0x50901c=_0x42605f,_0x43ff0c=await this[_0x2470b0(0x156)][_0x50901c(0x11a)]({'order':{'order':_0x50901c(0x11b)},'where':{'status':!![]}}),_0x3f24c6=await this[_0x50901c(0x187)][_0x50901c(0x11a)]({'where':{'status':!![]}}),_0x379178=[...new Set(_0x3f24c6[_0x50901c(0x175)](_0x1279a0=>_0x1279a0[_0x2470b0(0xb1)]))],_0x4a4b04=await this[_0x50901c(0xfe)][_0x20077b(0x1b0)]({'where':{'id':(0x0,typeorm_1['In'])(_0x379178)}});return _0x3f24c6[_0x50901c(0x11f)](_0x9a7f3e=>{const _0x454f75=_0x20077b,_0x1341a6=_0x50901c,_0x1d8e62=_0x4a4b04['find'](_0x7a25fa=>_0x7a25fa['id']===_0x9a7f3e[_0x1341a6(0x208)]);return _0x9a7f3e[_0x1341a6(0x1d5)]=_0x1d8e62===null||_0x1d8e62===void 0x0?void 0x0:_0x1d8e62[_0x454f75(0x204)],_0x9a7f3e;}),_0x43ff0c[_0x50901c(0x175)](_0x797319=>{const _0x3b3c71=_0x50901c;return _0x797319[_0x3b3c71(0x19e)]=_0x3f24c6[_0x3b3c71(0x11d)](_0x25edee=>_0x25edee[_0x3b3c71(0x1c1)]===_0x797319['id']&&_0x25edee[_0x3b3c71(0x1a0)]),_0x797319;});}async[_0x42605f(0x127)](_0x4010b6,_0x1588fd){const _0x3fb2d9=_0x14868a,_0x5f425c=_0x42605f;try{const {name:_0x1d954f,icon:_0xf9e70b,order:_0x49552d,id:_0x42db59,status:_0x70231e}=_0x1588fd;return _0x42db59?await this[_0x5f425c(0x1bd)][_0x5f425c(0x128)]({'id':_0x42db59},{'name':_0x1d954f,'icon':_0xf9e70b,'order':_0x49552d,'status':_0x70231e}):await this[_0x3fb2d9(0x237)][_0x5f425c(0x12d)]({'name':_0x1d954f,'icon':_0xf9e70b,'order':_0x49552d,'status':_0x70231e});}catch(_0x2a5d73){console[_0x5f425c(0x1ba)](_0x3fb2d9(0x174),_0x2a5d73);}}async[_0x42605f(0x12e)](_0x487083,_0x13d556){const _0x1e1a37=_0xcb4d42,_0x2563bd=_0x14868a,_0x3f4992=_0x42605f,{id:_0x378301}=_0x13d556;if(!_0x378301)throw new common_1[(_0x3f4992(0x1e0))](_0x1e1a37(0xf1),common_1[_0x3f4992(0x1bb)][_0x3f4992(0x19a)]);const _0x3a7317=await this[_0x3f4992(0x187)][_0x3f4992(0x1c9)]({'where':{'typeId':_0x378301}});if(_0x3a7317)throw new common_1[(_0x3f4992(0x1e0))](_0x3f4992(0x123),common_1[_0x3f4992(0x1bb)][_0x2563bd(0x170)]);return await this[_0x3f4992(0x1bd)][_0x3f4992(0x1e5)]({'id':_0x378301});}async[_0xcb4d42(0x16c)](){const _0x445da0=_0x42605f;return await this[_0x445da0(0x1bd)][_0x445da0(0x11a)]({'order':{'order':_0x445da0(0x11b)}});}async[_0x42605f(0x1cc)](_0x56dc27,_0x203426){const _0x11d69b=_0x42605f,{title:_0x4cdc07,prompt:_0x214135,appId:_0x5ad4cd,order:_0xe94f59,status:_0x555dc0,typeId:_0x1465ac,id:_0x362fac,url:_0x5cf514}=_0x203426;if(!_0x1465ac)throw new common_1[(_0x11d69b(0x1e0))](_0x11d69b(0x17e),common_1[_0x11d69b(0x1bb)][_0x11d69b(0x19a)]);try{const _0x245bb2={'title':_0x4cdc07,'prompt':_0x214135,'order':_0xe94f59,'status':_0x555dc0,'typeId':_0x1465ac,'url':_0x5cf514};return _0x362fac?await this[_0x11d69b(0x196)][_0x11d69b(0x128)]({'id':_0x362fac},_0x245bb2):await this[_0x11d69b(0x196)][_0x11d69b(0x12d)](_0x245bb2);}catch(_0x469a67){console[_0x11d69b(0x1ba)](_0x11d69b(0x1ee),_0x469a67);}}async[_0x14868a(0x179)](_0x520480,_0x4c0ef4){const _0x2bea68=_0xcb4d42,_0x73cfef=_0x42605f,{id:_0x44b757}=_0x4c0ef4;if(!_0x44b757)throw new common_1[(_0x73cfef(0x1e0))](_0x73cfef(0x1e4),common_1['HttpStatus'][_0x73cfef(0x19a)]);return await this[_0x73cfef(0x196)][_0x2bea68(0x18e)]({'id':_0x44b757});}async[_0x42605f(0x1d3)](){const _0x4668cf=_0xcb4d42,_0x3dcbd7=_0x14868a,_0x3e373f=_0x42605f,_0x149899=await this[_0x4668cf(0x12b)][_0x3dcbd7(0x1b0)]({'order':{'order':_0x3e373f(0x11b)}}),_0x257ab7=[...new Set(_0x149899[_0x3e373f(0x175)](_0x4c259d=>_0x4c259d[_0x3e373f(0x1c1)]))],_0x3dc6c2=await this[_0x4668cf(0xa9)][_0x3e373f(0x11a)]({'where':{'id':(0x0,typeorm_1['In'])(_0x257ab7)}});return _0x149899[_0x3dcbd7(0x190)](_0x471877=>{const _0x477a7a=_0x3e373f,{typeId:_0x55dbf6,appId:_0x5771e3}=_0x471877;return _0x471877[_0x477a7a(0x1f8)]=_0x3dc6c2[_0x477a7a(0x11a)](_0x2c2e12=>_0x2c2e12['id']===_0x55dbf6),_0x471877;});}async[_0x42605f(0x1d4)](){const _0x1d4efb=_0xcb4d42,_0x4912bd=_0x42605f,_0x13b881=await this[_0x4912bd(0x1bd)][_0x4912bd(0x11a)]({'order':{'order':_0x4912bd(0x11b)},'where':{'status':!![]}}),_0x3f815c=await this[_0x4912bd(0x196)][_0x1d4efb(0xc7)]({'where':{'status':!![]}});return _0x13b881[_0x4912bd(0x175)](_0x4f1cd5=>{const _0x3e9b75=_0x1c31,_0x1efe7b=_0x4912bd;return _0x4f1cd5[_0x1efe7b(0x19e)]=_0x3f815c[_0x1efe7b(0x11d)](_0x21aa65=>_0x21aa65[_0x1efe7b(0x1c1)]===_0x4f1cd5['id']&&_0x21aa65[_0x3e9b75(0x244)]),_0x4f1cd5;});}async[_0x42605f(0x1b3)](_0x1a6239,_0x93f663,_0x5ac85b){const _0x302737=_0xcb4d42,_0x1105c1=_0x14868a,_0x184349=_0x42605f;let _0x3d9331=0x1000,_0x1a889b=0x800;return _0x1a6239[_0x1105c1(0x17e)]()[_0x184349(0x13d)](_0x184349(0x17b))&&(_0x3d9331=_0x93f663>=0x2004?0x2004:_0x93f663,_0x1a889b=_0x5ac85b>=0x1000?0x1000:_0x5ac85b,_0x1a6239[_0x1105c1(0x17e)]()[_0x1105c1(0x26c)](_0x184349(0x143))&&(_0x3d9331=_0x93f663>=0x8000?0x8000:_0x93f663,_0x1a889b=_0x5ac85b>=0x3e80?0x3e80:_0x5ac85b),(_0x1a6239[_0x184349(0x121)]()[_0x184349(0x13d)](_0x1105c1(0x1a4))||_0x1a6239[_0x302737(0xc1)]()[_0x184349(0x13d)](_0x1105c1(0x224)))&&(_0x3d9331=_0x93f663>=0x1f400?0x1f400:_0x93f663,_0x1a889b=_0x5ac85b>=0x1000?0x1000:_0x5ac85b)),_0x1a6239[_0x184349(0x121)]()[_0x184349(0x13d)](_0x184349(0x152))&&(_0x3d9331=_0x93f663>=0x1000?0x1000:_0x93f663,_0x1a889b=_0x5ac85b>=0x800?0x800:_0x5ac85b,_0x1a6239[_0x184349(0x121)]()[_0x1105c1(0x26c)](_0x184349(0x167))&&(_0x3d9331=_0x93f663>=0x4000?0x4000:_0x93f663,_0x1a889b=_0x5ac85b>=0x1f40?0x1f40:_0x5ac85b),_0x1a6239[_0x184349(0x121)]()[_0x184349(0x13d)](_0x184349(0x1c3))&&(_0x3d9331=_0x93f663>=0x4000?0x4000:_0x93f663,_0x1a889b=_0x5ac85b>=0x1f40?0x1f40:_0x5ac85b)),{'maxToken':_0x3d9331,'maxRes':_0x1a889b};}};function _0x1c31(_0xde43db,_0xd4493e){const _0x4e3804=_0x1ebf();return _0x1c31=function(_0x3fa50d,_0x3ddf68){_0x3fa50d=_0x3fa50d-0x164;let _0x483c07=_0x4e3804[_0x3fa50d];return _0x483c07;},_0x1c31(_0xde43db,_0xd4493e);}function _0x2fe1(){const _0x4ccb4e=['chatLogService','appId','defineProperty','80094aumkPu','当前模型key余额已耗尽、已冻结当前调用Key、尝试重新对话试试吧！','1830815RDfsBx','saveChatLog','delChatPreType','ModelsService','userBalanceService','setData','queryUserBalance','Bearer\x20','statusText','openaiTimeoutMs','ChatGroupService','setHeader','toLowerCase','85IhlHmg','ChatLogService','getAllKeyList','../badwords/badwords.service','end','find','getUploadType','getConfigs','maxResponseTokens','split','6493743WUDifs','716ndMgzY','4548mvqkmA','draw\x20paompt\x20info\x20<==**==>\x20','result','@keyv/redis','../userBalance/userBalance.service','getModelProxyUrl','UserBalanceService','log','UserService','nestjs-config','DrawService','count','debug','Injectable','OpenAiErrorCodeMessage','nineai-chatlog','提供了错误的模型秘钥、已冻结当前调用Key、请重新尝试对话！','length','绘制图片失败，此次绘画被拒绝了！','../chatGroup/chatGroup.service','application/octet-stream;\x20charset=utf-8','openaiModel4MaxTokens32k','getTokenCount','addOneIfOdd','text','nineStore','configEntity','GlobalConfigService','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','REDIS_PASSWORD','model4','getRequestParams','16k','./chatPreType.entity','slice','非法操作！','987057PMwShT','dall-e-3','80034SUEUii','1950kaEvhm','getClientIp','当前模型不是聊天模型、已冻结当前调用Key、请重新尝试对话！','18231422baHdmr','./../upload/upload.service','base64','ChatPreEntity','chat','InjectRepository','../../common/constants/balance.constant','uploadService','delChatBoxType','lockKey','openaiModel4MaxTokens','Logger','../chatLog/chatLog.service','../app/app.entity','绘制图片失败，请稍后试试吧！','close','setChatBoxType','openaiModel3MaxTokens16kRes','abort','setChatPre','9768664LUwmdO','importDynamic','chatSyncFree','size','Billing\x20hard\x20limit\x20has\x20been\x20reached','includes','save','The\x20OpenAI\x20account\x20associated\x20with\x20this\x20API\x20key\x20has\x20been\x20deactivated.','58360yBGqSf','status','GptKeysEntity','maxModelTokens','queryChatBoxFrontend','user','Incorrect\x20API\x20key\x20provided','imageUrl','当前模型调用过于频繁、请重新试试吧！','modelInfo','130239OTvrFP','BadwordsService','uuid','axios','@nestjs/typeorm','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','weight','HttpStatus','dall-e\x20draw\x20params:\x20','gpt-4','DeductionKey','getBaseConfig','shift','chatPreEntity','19398hSjcdz','../models/models.service','proxyUrl','400\x20error','./store','https://api.openai.com','1569792gJCZfA','gptKeysEntity','chatProcess','./../user/user.service','../autoreply/autoreply.service','map','openai-draw\x20error:\x20','floor','ceil','toISOString','key','CHAT_TYPE','../globalConfig/globalConfig.service','systemPreMessage','\x0a\x20Current\x20date:\x20','design:paramtypes','5100198tbpNim','userService','chat-error-detail\x20\x20<----------------------------------------->','error:\x20','FanyiService','conversationId','openaiProxyUrl','b64_json','2vGVVxT','Please\x20check\x20the\x20back-end\x20console','当前模型key已被封禁','BAD_REQUEST','30cveWdq','all','openaiModel3MaxTokens','2251428zxaZNU','filter','__decorate','195nNCFtP','gpt-3','chatBoxTypeEntity','REDIS_HOST','response','374296QrOzdk',',\x20消耗token:\x20','getRandomDrawKey','coverImg','autoreplyService','This\x20is\x20not\x20a\x20chat\x20model\x20and\x20thus\x20not\x20supported','redis://','Too\x20Many\x20Requests','DESC','1263kGJbRf','formatModelToken','userBanance','Repository','deductFromBalance','sendMessageFromOpenAi','usage','REDIS_PORT','function','openaiModel3MaxTokens16k','queryChatPreType',',\x20消耗积分：\x20','UploadService','__metadata','611670DyIiKM','delChatPre','getGroupInfoFromId','globalConfigService','typeId','stringify','REDIS_USER','quality','ChatBoxTypeEntity','提供了错误的模型秘钥',',\x20key\x20===>\x20','statusCode','4421192usWZZk','gpt-4-vision-preview','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','error','post','50559JmkrBk','metadata','NineStore','./gptkeys.entity','billing','.png','data','gpt-4-1106','当前模型key余额已耗尽','1106','typeInfo','mjDraw','saveUseLog','delete','./zhipu','130KFDvLt','configService','./chatBox.entity','message','chatGroupService','prompt','../../common/utils','write','config','parse','queryChatPreList','chatBoxEntity','/v1/images/generations','ConfigService','decorate','badwordsService','缺失必要参数！','openaiModel3MaxTokensRes','queryChatBoxType','childList','keyPool','model','sendMessageFromBaidu','delChatBox','preset','getOwnPropertyDescriptor','checkUserStatus','modelsService','7LOYwLD','../fanyi/fanyi.service','HttpException','chatPreTypeEntity','model3','ChatPreTypeEntity','AutoreplyService','assistant','push','openaiModel4MaxTokensRes'];_0x2fe1=function(){return _0x4ccb4e;};return _0x2fe1();}ChatgptService=__decorate([(0x0,common_1[_0x42605f(0x133)])(),__param(0x0,(0x0,typeorm_2[_0x42605f(0x1aa)])(gptkeys_entity_1[_0x14868a(0x20f)])),__param(0x1,(0x0,typeorm_2[_0x42605f(0x1aa)])(config_entity_1[_0x42605f(0x1c8)])),__param(0x2,(0x0,typeorm_2[_0x14868a(0x1e3)])(chatBoxType_entity_1[_0x42605f(0x172)])),__param(0x3,(0x0,typeorm_2[_0x14868a(0x1e3)])(chatBox_entity_1[_0x42605f(0x148)])),__param(0x4,(0x0,typeorm_2['InjectRepository'])(app_entity_1[_0x42605f(0x14c)])),__param(0x5,(0x0,typeorm_2[_0x42605f(0x1aa)])(chatPreType_entity_1[_0x42605f(0x119)])),__param(0x6,(0x0,typeorm_2[_0x42605f(0x1aa)])(chatPre_entity_1[_0x42605f(0x142)])),__metadata(_0x42605f(0x191),[typeorm_1[_0x42605f(0x1c4)],typeorm_1[_0x42605f(0x1c4)],typeorm_1[_0x42605f(0x1c4)],typeorm_1[_0x42605f(0x1c4)],typeorm_1[_0x42605f(0x1c4)],typeorm_1[_0x42605f(0x1c4)],typeorm_1[_0x42605f(0x1c4)],nestjs_config_1[_0x14868a(0x1bc)],userBalance_service_1[_0x14868a(0x1e1)],chatLog_service_1[_0x14868a(0x1a3)],user_service_1[_0x42605f(0x1ed)],upload_service_1[_0x42605f(0x1d2)],badwords_service_1[_0x42605f(0x135)],autoreply_service_1[_0x42605f(0x10b)],globalConfig_service_1[_0x42605f(0x17c)],fanyi_service_1[_0x42605f(0x1dd)],chatGroup_service_1[_0x42605f(0x15b)],models_service_1[_0x42605f(0x1a4)]])],ChatgptService),exports['ChatgptService']=ChatgptService;